#'
icd9GenerateDecimalFormat <- function(icd9){
icdNcharLong <- 4
icd9V <- icd9[grepl("^V", icd9$Short),]
icd9N <- icd9[grepl("^[0-9]+", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
V4 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V4] <- paste(substr(icd9V$Short[V4], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V4], start= decimalstop, stop = icdNcharLong), sep = "")
N4 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N4] <- paste(substr(icd9N$Short[N4], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N4], start= decimalstop, stop = icdNcharLong), sep = "")
icdNcharLong <- 5
decimalstart <- icdNcharLong - 2
decimalstop<- icdNcharLong - 1
V5 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V5] <- paste(substr(icd9V$Short[V5], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V5], start= decimalstop, stop = icdNcharLong), sep = "")
N5 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N5] <- paste(substr(icd9N$Short[N5], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9E <- icd9[grepl("^E", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
E5 <- nchar(icd9E$Short) == icdNcharLong
icd9E$Decimal[E5] <- paste(substr(icd9E$Short[E5], start = 1 , stop =  decimalstart), ".",
substr(icd9E$Short[E5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9_VN <- full_join(icd9V, icd9N, by = c("Short", "Decimal"))
icd9_combine <- full_join(icd9E, icd9_VN, by = c("Short", "Decimal"))
icd9_combine
}
icd9GenerateDecimalFormat(icd9)
View(ccsDxICD9)
icdNcharLong <- 4
icd9V <- icd9[grepl("^V", icd9$Short),]
icd9
icd9 <- data.frame(Short = ccsDxICD9$ICD,stringsAsFactors = F)
icd9V <- icd9[grepl("^V", icd9$Short),]
icd9N <- icd9[grepl("^[0-9]+", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
#' get ICD-9-CM Codes Decimal Forms
#'
#' Convert codes between short and decimal forms
#' Format ICD-9-CM Principal and Other Diagnosis Codes can be found at url link.
#'
#' @param icd9 ICD-9-CM codes
#' @source \url{https://www.findacode.com/search/search.php}
#' @source \url{https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf}
#'
icd9GenerateDecimalFormat <- function(icd9){
icdNcharLong <- 4
icd9V <- icd9[grepl("^V", icd9$Short),]
icd9N <- icd9[grepl("^[0-9]+", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
V4 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V4] <- paste(substr(icd9V$Short[V4], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V4], start= decimalstop, stop = icdNcharLong), sep = "")
N4 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N4] <- paste(substr(icd9N$Short[N4], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N4], start= decimalstop, stop = icdNcharLong), sep = "")
icdNcharLong <- 5
decimalstart <- icdNcharLong - 2
decimalstop<- icdNcharLong - 1
V5 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V5] <- paste(substr(icd9V$Short[V5], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V5], start= decimalstop, stop = icdNcharLong), sep = "")
N5 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N5] <- paste(substr(icd9N$Short[N5], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9E <- icd9[grepl("^E", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
E5 <- nchar(icd9E$Short) == icdNcharLong
icd9E$Decimal[E5] <- paste(substr(icd9E$Short[E5], start = 1 , stop =  decimalstart), ".",
substr(icd9E$Short[E5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9_VN <- full_join(icd9V, icd9N, by = c("Short", "Decimal"))
icd9_combine <- full_join(icd9E, icd9_VN, by = c("Short", "Decimal"))
icd9_combine
}
icd9GenerateDecimalFormat(icd9)
icd9V <- icd9[grepl("^V", icd9$Short),]
icd9V
icd9N <- icd9[grepl("^[0-9]+", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
V4 <- nchar(icd9V$Short) == icdNcharLong
icd9V
icd9
icd9V <- icd9$Short[grepl("^V", icd9$Short)]
icd9V
#' get ICD-9-CM Codes Decimal Forms
#'
#' Convert codes between short and decimal forms
#' Format ICD-9-CM Principal and Other Diagnosis Codes can be found at url link.
#'
#' @param icd9 ICD-9-CM codes
#' @source \url{https://www.findacode.com/search/search.php}
#' @source \url{https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf}
#'
icd9GenerateDecimalFormat <- function(icd9){
icd9 <- data.frame(Short = icd9,stringsAsFactors = F)
icdNcharLong <- 4
icd9V <- data.frame(Short = icd9[grepl("^V", icd9$Short),],stringsAsFactors = F)
icd9N <- data.frame(Short = icd9[grepl("^[0-9]+", icd9$Short),],stringsAsFactors = F)
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
V4 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V4] <- paste(substr(icd9V$Short[V4], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V4], start= decimalstop, stop = icdNcharLong), sep = "")
N4 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N4] <- paste(substr(icd9N$Short[N4], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N4], start= decimalstop, stop = icdNcharLong), sep = "")
icdNcharLong <- 5
decimalstart <- icdNcharLong - 2
decimalstop<- icdNcharLong - 1
V5 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V5] <- paste(substr(icd9V$Short[V5], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V5], start= decimalstop, stop = icdNcharLong), sep = "")
N5 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N5] <- paste(substr(icd9N$Short[N5], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9E <- icd9[grepl("^E", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
E5 <- nchar(icd9E$Short) == icdNcharLong
icd9E$Decimal[E5] <- paste(substr(icd9E$Short[E5], start = 1 , stop =  decimalstart), ".",
substr(icd9E$Short[E5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9_VN <- full_join(icd9V, icd9N, by = c("Short", "Decimal"))
icd9_combine <- full_join(icd9E, icd9_VN, by = c("Short", "Decimal"))
icd9_combine
}
icd9GenerateDecimalFormat(icd9)
icd9 <- data.frame(Short = icd9,stringsAsFactors = F)
icdNcharLong <- 4
icd9V <- data.frame(Short = icd9[grepl("^V", icd9$Short),],stringsAsFactors = F)
icd9N <- data.frame(Short = icd9[grepl("^[0-9]+", icd9$Short),],stringsAsFactors = F)
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
V4 <- nchar(icd9V$Short) == icdNcharLong
V4
icd9V$Decimal[V4] <- paste(substr(icd9V$Short[V4], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V4], start= decimalstop, stop = icdNcharLong), sep = "")
icd9V
N4 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N4] <- paste(substr(icd9N$Short[N4], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N4], start= decimalstop, stop = icdNcharLong), sep = "")
icdNcharLong <- 5
decimalstart <- icdNcharLong - 2
decimalstop<- icdNcharLong - 1
V5 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V5] <- paste(substr(icd9V$Short[V5], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V5], start= decimalstop, stop = icdNcharLong), sep = "")
N5 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N5] <- paste(substr(icd9N$Short[N5], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9E <- icd9[grepl("^E", icd9$Short),]
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
E5 <- nchar(icd9E$Short) == icdNcharLong
icd9E$Decimal[E5] <- paste(substr(icd9E$Short[E5], start = 1 , stop =  decimalstart), ".",
substr(icd9E$Short[E5], start= decimalstop, stop = icdNcharLong), sep = "")
#' get ICD-9-CM Codes Decimal Forms
#'
#' Convert codes between short and decimal forms
#' Format ICD-9-CM Principal and Other Diagnosis Codes can be found at url link.
#'
#' @param icd9 ICD-9-CM codes
#' @source \url{https://www.findacode.com/search/search.php}
#' @source \url{https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf}
#'
icd9GenerateDecimalFormat <- function(icd9){
icd9 <- data.frame(Short = icd9,stringsAsFactors = F)
icdNcharLong <- 4
icd9V <- data.frame(Short = icd9[grepl("^V", icd9$Short),],stringsAsFactors = F)
icd9N <- data.frame(Short = icd9[grepl("^[0-9]+", icd9$Short),],stringsAsFactors = F)
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
V4 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V4] <- paste(substr(icd9V$Short[V4], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V4], start= decimalstop, stop = icdNcharLong), sep = "")
N4 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N4] <- paste(substr(icd9N$Short[N4], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N4], start= decimalstop, stop = icdNcharLong), sep = "")
icdNcharLong <- 5
decimalstart <- icdNcharLong - 2
decimalstop<- icdNcharLong - 1
V5 <- nchar(icd9V$Short) == icdNcharLong
icd9V$Decimal[V5] <- paste(substr(icd9V$Short[V5], start = 1 , stop =  decimalstart), ".",
substr(icd9V$Short[V5], start= decimalstop, stop = icdNcharLong), sep = "")
N5 <- nchar(icd9N$Short) == icdNcharLong
icd9N$Decimal[N5] <- paste(substr(icd9N$Short[N5], start = 1 , stop =  decimalstart), ".",
substr(icd9N$Short[N5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9E <- data.frame(Short = icd9[grepl("^E", icd9$Short),],stringsAsFactors = F)
decimalstart <- icdNcharLong - 1
decimalstop <- icdNcharLong
E5 <- nchar(icd9E$Short) == icdNcharLong
icd9E$Decimal[E5] <- paste(substr(icd9E$Short[E5], start = 1 , stop =  decimalstart), ".",
substr(icd9E$Short[E5], start= decimalstop, stop = icdNcharLong), sep = "")
icd9_VN <- full_join(icd9V, icd9N, by = c("Short", "Decimal"))
icd9_combine <- full_join(icd9E, icd9_VN, by = c("Short", "Decimal"))
icd9_combine
}
icd9GenerateDecimalFormat(icd9)
icd10 <-data.frame(Short = icd10, stringsAsFactors = FALSE)
icd10_4 <- nchar(icd10$Short) == 4
icd10 <- ccsDxICD10$ICD
icd10 <-data.frame(Short = icd10, stringsAsFactors = FALSE)
icd10_4 <- nchar(icd10$Short) == 4
icd10_4
icd10$Decimal[icd10_4] <- paste(substr(icd10$Short[icd10_4], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_4], start= 4, stop = 4), sep = "")
icd10
icd10_5 <- nchar(icd10$Short) == 5
icd10$Decimal[icd10_5] <- paste(substr(icd10$Short[icd10_5], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_5], start= 4, stop = 5), sep = "")
icd10_6 <- nchar(icd10$Short) == 6
icd10$Decimal[icd10_6] <- paste(substr(icd10$Short[icd10_6], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_6], start= 4, stop = 6), sep = "")
icd10_7 <- nchar(icd10$Short) == 7
icd10$Decimal[icd10_7] <- paste(substr(icd10$Short[icd10_7], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_7], start= 4, stop = 7), sep = "")
#' get ICD-10-CM Codes Decimal Forms
#'
#' Convert codes between short and decimal forms.
#' Format ICD-10-CM Principal and Other Diagnosis Codes can be found at url link.
#'
#' @param icd10 ICD-10-CM codes
#' @source \url{https://www.findacode.com/search/search.php}
#'
icd10GenerateDecimalFormat <- function(icd10){
icd10 <-data.frame(Short = icd10, stringsAsFactors = FALSE)
icd10_4 <- nchar(icd10$Short) == 4
icd10$Decimal[icd10_4] <- paste(substr(icd10$Short[icd10_4], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_4], start= 4, stop = 4), sep = "")
icd10_5 <- nchar(icd10$Short) == 5
icd10$Decimal[icd10_5] <- paste(substr(icd10$Short[icd10_5], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_5], start= 4, stop = 5), sep = "")
icd10_6 <- nchar(icd10$Short) == 6
icd10$Decimal[icd10_6] <- paste(substr(icd10$Short[icd10_6], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_6], start= 4, stop = 6), sep = "")
icd10_7 <- nchar(icd10$Short) == 7
icd10$Decimal[icd10_7] <- paste(substr(icd10$Short[icd10_7], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_7], start= 4, stop = 7), sep = "")
icd10
}
icd10GenerateDecimalFormat(icd10)
#' get ICD-10-CM Codes Decimal Forms
#'
#' Convert codes between short and decimal forms.
#' Format ICD-10-CM Principal and Other Diagnosis Codes can be found at url link.
#'
#' @param icd10 ICD-10-CM codes
#' @source \url{https://www.findacode.com/search/search.php}
#'
icd10GenerateDecimalFormat <- function(icd10){
icd10 <-data.frame(Short = icd10, stringsAsFactors = FALSE)
icd10_4 <- nchar(icd10$Short) == 4
icd10$Decimal[icd10_4] <- paste(substr(icd10$Short[icd10_4], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_4], start= 4, stop = 4), sep = "")
icd10_5 <- nchar(icd10$Short) == 5
icd10$Decimal[icd10_5] <- paste(substr(icd10$Short[icd10_5], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_5], start= 4, stop = 5), sep = "")
icd10_6 <- nchar(icd10$Short) == 6
icd10$Decimal[icd10_6] <- paste(substr(icd10$Short[icd10_6], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_6], start= 4, stop = 6), sep = "")
icd10_7 <- nchar(icd10$Short) == 7
icd10$Decimal[icd10_7] <- paste(substr(icd10$Short[icd10_7], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_7], start= 4, stop = 7), sep = "")
icd10
}
icd10GenerateDecimalFormat(icd10)
icd10_4 <- nchar(icd10$Short) == 4
icd10$Decimal[icd10_4] <- paste(substr(icd10$Short[icd10_4], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_4], start= 4, stop = 4), sep = "")
icd10_5 <- nchar(icd10$Short) == 5
icd10$Decimal[icd10_5] <- paste(substr(icd10$Short[icd10_5], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_5], start= 4, stop = 5), sep = "")
icd10_6 <- nchar(icd10$Short) == 6
icd10$Decimal[icd10_6] <- paste(substr(icd10$Short[icd10_6], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_6], start= 4, stop = 6), sep = "")
icd10_7 <- nchar(icd10$Short) == 7
icd10$Decimal[icd10_7] <- paste(substr(icd10$Short[icd10_7], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_7], start= 4, stop = 7), sep = "")
icd10
#' get ICD-10-CM Codes Decimal Forms
#'
#' Convert codes between short and decimal forms.
#' Format ICD-10-CM Principal and Other Diagnosis Codes can be found at url link.
#'
#' @param icd10 ICD-10-CM codes
#' @source \url{https://www.findacode.com/search/search.php}
#'
icd10GenerateDecimalFormat <- function(icd10){
icd10 <-data.frame(Short = icd10, stringsAsFactors = FALSE)
icd10_4 <- nchar(icd10$Short) == 4
icd10$Decimal[icd10_4] <- paste(substr(icd10$Short[icd10_4], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_4], start= 4, stop = 4), sep = "")
icd10_5 <- nchar(icd10$Short) == 5
icd10$Decimal[icd10_5] <- paste(substr(icd10$Short[icd10_5], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_5], start= 4, stop = 5), sep = "")
icd10_6 <- nchar(icd10$Short) == 6
icd10$Decimal[icd10_6] <- paste(substr(icd10$Short[icd10_6], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_6], start= 4, stop = 6), sep = "")
icd10_7 <- nchar(icd10$Short) == 7
icd10$Decimal[icd10_7] <- paste(substr(icd10$Short[icd10_7], start = 1 , stop =  3), ".",
substr(icd10$Short[icd10_7], start= 4, stop = 7), sep = "")
icd10
}
icd10 <- ccsDxICD10$ICD
icd10GenerateDecimalFormat(icd10)
#' Convert ICD Codes From Decimal To Short Forms
#'
#' Convert codes between short and decimal forms
#'
#' @import dplyr
#'
#' @param icdList ICD codes
#'
convertIcdDecimaltoShort<-function(icdList){
icdDf <- data.frame(ICD = icdList, Number = 1:length(icdList),stringsAsFactors = FALSE)
icd_Short <- data.frame(Short = icdDf$ICD[!grepl("[.]",icdDf$ICD)], Number = icdDf$Number[!grepl("[.]",icdDf$ICD)],stringsAsFactors = FALSE)
icd_Decimal <- data.frame(Decimal = icdDf$ICD[grepl("[.]",icdDf$ICD)], Number = icdDf$Number[grepl("[.]",icdDf$ICD)],stringsAsFactors = FALSE)
icd9_D <- left_join(icd_Decimal, icd9withTwoFormat, by = "Decimal")
icd10_D <- left_join(icd_Decimal, icd10withTwoFormat, by = "Decimal")
combine_D <- rbind(icd9_D[!is.na(icd9_D$Short),], icd10_D[!is.na(icd10_D$Short),])
icd9_S <- left_join(icd_Short, icd9withTwoFormat, by = "Short")
icd10_S <- left_join(icd_Short, icd10withTwoFormat, by = "Short")
combine_S <- rbind(icd9_S[!is.na(icd9_S$Decimal),], icd10_S[!is.na(icd10_S$Decimal),])
combine <- rbind(combine_D,combine_S) %>% arrange(Number)
error <- anti_join(data.frame(Short = icdDf$ICD, Number = icdDf$Number, stringsAsFactors = FALSE),
select(combine, Short, Number),
c("Number")) %>% mutate(Decimal = NA)
combine_with_error <- rbind(error, combine) %>% arrange(Number)
combine_with_error <- combine_with_error$Short
return(list(Short = combine_with_error, Error = error$Short))
}
load("~/emr/data/icd10withTwoFormat.rda")
load("~/emr/data/icd9withTwoFormat.rda")
icd9_Short <- icd9withTwoFormat$Short[1:10]
convertIcdShortToDecimal(icd9_Short)$Decimal
#' Convert ICD Codes From Short To Decimal Forms
#'
#' Convert codes between short and decimal forms
#'
#' @import dplyr
#'
#' @param icdList ICD codes
#'
convertIcdShortToDecimal<-function(icdList){
icdDf <- data.frame(ICD = icdList, Number = 1:length(icdList),stringsAsFactors = FALSE)
icd_Short <- data.frame(Short = icdDf$ICD[!grepl("[.]",icdDf$ICD)], Number = icdDf$Number[!grepl("[.]",icdDf$ICD)],stringsAsFactors = FALSE)
icd_Decimal <- data.frame(Decimal = icdDf$ICD[grepl("[.]",icdDf$ICD)], Number = icdDf$Number[grepl("[.]",icdDf$ICD)],stringsAsFactors = FALSE)
icd9_D <- left_join(icd_Decimal, icd9withTwoFormat, by = "Decimal")
icd10_D <- left_join(icd_Decimal, icd10withTwoFormat, by = "Decimal")
combine_D <- rbind(icd9_D[!is.na(icd9_D$Short),], icd10_D[!is.na(icd10_D$Short),])
icd9_S <- left_join(icd_Short, icd9withTwoFormat, by = "Short")
icd10_S <- left_join(icd_Short, icd10withTwoFormat, by = "Short")
combine_S <- rbind(icd9_S[!is.na(icd9_S$Decimal),], icd10_S[!is.na(icd10_S$Decimal),])
combine <- rbind(combine_D,combine_S) %>% arrange(Number)
error <- anti_join(data.frame(Decimal = icdDf$ICD, Number = icdDf$Number, stringsAsFactors = FALSE),
select(combine, Decimal, Number),
c("Number")) %>% mutate(Short = NA)
combine_with_error <- rbind(error, combine) %>% arrange(Number)
combine_with_error <- combine_with_error$Decimal
return(list(Decimal = combine_with_error, Error = error$Decimal))
}
convertIcdShortToDecimal(icd9_Short)$Decimal
icd10_Short <- icd10withTwoFormat$Short[1:10]
convertIcdShortToDecimal(icd10_Short)$Decimal
icd9_Short <- icd9withTwoFormat$Short[1:10]
icd9_Decimal <- icd9withTwoFormat$Decimal[1:10]
convertIcdDecimaltoShort(icd9_Decimal)$Short
convertIcdDecimaltoShort(icd10_Decimal)$Short
icd10_Decimal
icd10_Decimal <- icd10withTwoFormat$Decimal[1:10]
convertIcdDecimaltoShort(icd10_Decimal)$Short
DxDataFile <- data.frame(ID = c("A", "A", "B", "B"),
ICD = c("40201", "42577", "I350", "K289"),
Date = as.Date(c("2013-03-31", "2013-01-29", "2016-03-10", "2016-03-10")),
stringsAsFactors = FALSE)
groupIcdToCCS (DxDataFile, ID, ICD, Date, "2016-01-01", FALSE)
groupIcdToCCS (DxDataFile, ID, ICD, Date, "2016-01-01", TRUE)
groupIcdToCCSLvl(DxDataFile, ID, ICD, Date, "2016-01-01", 1, FALSE)
groupIcdToCCSLvl(DxDataFile, ID, ICD, Date, "2016-01-01", 3, FALSE)
icd9_ahrq$Comorbidity %>% unique ()
icd10_ahrq$Comorbidity %>% unique
groupIcdToComorbid(DxDataFile, ID, ICD, Date, "2016-01-01", charlson, B, TRUE)
groupIcdToComorbid(DxDataFile, ID, ICD, Date, "2016-01-01", elix, N, TRUE)
groupIcdToComorbid(DxDataFile, ID, ICD, Date, "2016-01-01", ahrq, N, TRUE)
getConditionEra(DxDataFile, ID, ICD, Date, "2016-01-01", 30, ccs, FALSE)
getConditionEra(DxDataFile, ID, ICD, Date, "2016-01-01", 30, ICD, FALSE)
selectCases("^I0", DxDataFile, ID, ICD, Date, "2016-01-01", 2)
icdFile <- data.frame(ICD = c("I95.0", "I952", "I110", "01091"), stringsAsFactors = FALSE)
groupingTable <- data.frame(Group = c("Hypotension","Hypotension","Hypotension", "Hypertension", "Hypertension"),
ICD = c("I95.0","I951","I952","I110","I11.9"),
stringsAsFactors = FALSE)
groupIcdToCustomGrep(icdFile, groupingTable)
o
groupIcdToCustomGrepList <- function(icdFile, grepTable){
icdFile$ICD <- convertIcdDecimaltoShort(icdFile$ICD)$Short
GroupList <- list()
icdList<- list()
for (rule in 1:nrow(icdFile)){
GrepICD <- ifelse(grepl(grepTable$grep_pattern[rule],icdFile$ICD), grepTable$Group[rule], NA)
GroupList[[length(GroupList)+1]] <- GrepICD
icdList[[length(icdList)+1]] <- icdFile$ICD
}
GroupDf <- cbind(data.frame(unlist(GroupList),stringsAsFactors = F),data.frame(unlist(icdList),stringsAsFactors = F))
names(GroupDf) <- c("Group","ICD")
GroupDf <- GroupDf[!is.na(GroupDf$Group),] %>% unique()
GroupDf_with_original <- left_join(icdFile,GroupDf,"ICD")$Group
GroupDf_with_original
}
groupIcdToCustomGrep <- function(icdFile, groupingTable){
icdFile$ICD <- convertIcdDecimaltoShort(icdFile$ICD)$Short
groupingTable$ICD <- convertIcdDecimaltoShort(groupingTable$ICD)$Short
GroupDf <- left_join(icdFile, groupingTable, by = "ICD")$Group
GroupDf
}
groupIcdToCustomGrep(icdFile, groupingTable)
groupIcdToCustomGrepList(icdFile, grepTable)
grepTable <- data.frame(Group = c("Hypotension", "Hypertension"),
grep_pattern = c("^I95|^I952", "^I11"),
stringsAsFactors = FALSE)
groupIcdToCustomGrepList(icdFile, grepTable)
devtools::document()
setwd("~/emr")
devtools::document()
devtools::check()
icdFile
icdFile$ICD <- convertIcdDecimaltoShort(icdFile$ICD)$Short
GroupList <- list()
icdList<- list()
for (rule in 1:nrow(icdFile)){
icdFile$Group<-""
icdFile$Group<-ifelse(grepl(grepTable$grep_pattern[rule],icdFile$ICD), grepTable$Group[rule], icdFile$Group)
GrepICD <- ifelse(grepl(grepTable$grep_pattern[rule],icdFile$ICD), grepTable$Group[rule], NA)
GroupList[[length(GroupList)+1]] <- GrepICD
icdList[[length(icdList)+1]] <- icdFile$ICD
}
icdFile
for (rule in 1:nrow(grepTable)){
icdFile$Group<-""
icdFile$Group<-ifelse(grepl(grepTable$grep_pattern[rule],icdFile$ICD), grepTable$Group[rule], icdFile$Group)
GrepICD <- ifelse(grepl(grepTable$grep_pattern[rule],icdFile$ICD), grepTable$Group[rule], NA)
GroupList[[length(GroupList)+1]] <- GrepICD
icdList[[length(icdList)+1]] <- icdFile$ICD
}
icdFile$Group<-""
icdFile$Group<-""
for (rule in 1:nrow(grepTable)){
icdFile$Group<-ifelse(grepl(grepTable$grep_pattern[rule],icdFile$ICD), grepTable$Group[rule], icdFile$Group)
GrepICD <- ifelse(grepl(grepTable$grep_pattern[rule],icdFile$ICD), grepTable$Group[rule], NA)
GroupList[[length(GroupList)+1]] <- GrepICD
icdList[[length(icdList)+1]] <- icdFile$ICD
}
icdFile
GroupList
GroupDf <- cbind(data.frame(unlist(GroupList),stringsAsFactors = F),data.frame(unlist(icdList),stringsAsFactors = F))
GroupDf
names(GroupDf) <- c("Group","ICD")
GroupDf <- GroupDf[!is.na(GroupDf$Group),] %>% unique()
GroupDf
GroupDf_with_original <- left_join(icdFile,GroupDf,"ICD")$Group
GroupDf_with_original
icdFile
GroupDf
Group
left_join(icdFile,GroupDf,"ICD")$Group
left_join(icdFile,GroupDf,"ICD")
########################################
grepTable <- data.frame(Group = c("Hypotension", "Hypertension"),
grep_pattern = c("^I95|^I952", "^I11"),
stringsAsFactors = FALSE)
setwd("~/emr")
devtools::document()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
setwd("~/emr")
devtools::document()
devtools::document()
devtools::check()
install.packages("pkgdown")
install.packages("pkgdown")
library("pkgdown", lib.loc="~/R/win-library/3.4")
library("rmarkdown", lib.loc="~/R/win-library/3.4")
pkgdown::build_site()
usethis::use_pkgdown()
usethis::use_pkgdown()
usethis::use_pkgdown()
pkgdown::build_site()
devtools::document()
devtools::check()
pkgdown::build_site()
pkgdown::build_site()
devtools::document()
devtools::check()
citation("emr")
pkgdown::build_site()
usethis::use_pkgdown()
usethis::use_pkgdown()
usethis::use_pkgdown()
usethis::use_pkgdown()
usethis::use_pkgdown()
usethis::use_pkgdown()
