allWrongVersionMsg <- allWrongVersionMsg[order(count,decreasing = T),]
message(head(allWrongVersionMsg[,list(wrongFormat= paste0(ICD," (",count,")","")),], 10))
message(("\t"))
}
warning('The ICD mentioned above matches to "NA" due to the format or other issues.', call. = F)
warning('"Wrong ICD format" means the ICD has wrong format', call. = F)
warning('"Wrong ICD version" means the ICD classify to wrong ICD version (cause the "icd10usingDate" or other issues)', call. = F)
combine_with_error <- rbind(allWrongICD, allShortFormat)[order(Number),"ICD"]
return(list(ICD = combine_with_error,
Error = allWrongICDMsg[order(count,decreasing = T),]))
}else{
return(list(ICD = allShortFormat[order(Number),"ICD"]))
}
}
load("~/data/DeliveryCCSDataLong.rda")
load("~/emr/data/ICD10DxwithTwoFormat.rda")
load("~/emr/data/ICD9DxwithTwoFormat.rda")
library(data.table)
library(ggplot2)
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
errorFile <- IcdDxDecimalToShort(DeliveryCCSDataLong[,c(5,2)], ICD, DateServiceStarted, "2015/10/01")$Error
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
if(!is.null(groupICD)){
# GroupedErrorICD <- data.table()
# for(num in seq(0,9,2)){
#   GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD), c(1, 2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
#                            errorICD[grepl(paste0("^",(num+1)),ICD), c(1, 2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
#   GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
#   if(num == 8){
#     GroupedErrorICD <- rbind(GroupedErrorICD,
#                              errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
#   }
# }
# GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
# g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(errorFile, 10)
}
errorICDTop10$ICD <- factor(errorICDTop10$ICD)
errorICDTop10 <- errorICDTop10[,cumcount :=cumsum(count),][,cumcountperc := round(cumcount/max(cumcount)*100,2),][,Number :=1:10,]
errorICDTop10 <- as.data.frame(errorICDTop10)
# g <- ggplot(errorICDTop10, aes(x= reorder(ICD,-count) , y = count))
}
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(errorFile, 10)
}
errorICDTop10$ICD <- factor(errorICDTop10$ICD)
errorICDTop10 <- errorICDTop10[,cumcount :=cumsum(count),][,cumcountperc := round(cumcount/max(cumcount)*100,2),][,Number :=1:10,]
errorICDTop10 <- as.data.frame(errorICDTop10)
errorICDTop10
# errorICDgraph <- g +
#   geom_bar(aes(y= count), fill = "orange2", width = 0.9, stat = "identity") +
#   guides(fill = FALSE) +
#   xlab(Xlabel) + ylab("count") +
#   ggtitle(title) +
#   theme(axis.text.x = element_text(angle = 20))
Max <- max(errorICDTop10$cumcount)
y2 <- c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%")
ggplot(errorICDTop10, aes(x= reorder(ICD,-count), y = count)) +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumcount, color = Number)) +
geom_point(aes(x= Number, y = cumcount, color = Number), pch = 10) +
scale_x_discrete(breaks = errorICDTop10$ICD) +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = 10 + .55, xmax = 10 + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = 10 + .8, y = seq(0, Max, Max/10), label = y2, size = 3.5) +
geom_segment(x = 10 + .55, xend = 10 + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
ggplot(errorICDTop10, aes(x= reorder(ICD,-count), y = count)) +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumcount, color = Number)) +
geom_point(aes(x= Number, y = cumcount, color = Number), pch = 10) +
scale_x_discrete(breaks = errorICDTop10$ICD) +
guides(fill = FALSE, color = FALSE) +
# annotate("rect", xmin = 10 + .55, xmax = 10 + 1,
#          ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = 10 + .8, y = seq(0, Max, Max/10), label = y2, size = 3.5) +
geom_segment(x = 10 + .55, xend = 10 + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
ggplot(errorICDTop10, aes(x= reorder(ICD,-count), y = count)) +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumcount, color = Number)) +
geom_point(aes(x= Number, y = cumcount, color = Number), pch = 10) +
scale_x_discrete(breaks = errorICDTop10$ICD) +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = 10 + .55, xmax = 10 + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = 10 + .8, y = seq(0, Max, Max/10), label = y2, size = 3.5) +
geom_segment(x = 10 + .55, xend = 10 + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICD
View(errorICD)
errorICD1 <- errorICD[,ICDstart := substr(ICD,1,1)]
errorICD1
errorICD1
unique(errorICD1$ICDstart)
!grepl("[0-9]|V|E",errorICD1$ICDstart)
!grep("[0-9]|V|E",errorICD1$ICDstart)
grep("[0-9]|V|E",errorICD1$ICDstart)
!grep("[0-9]|V|E",errorICD1$ICDstart)
errorICD1[grep("[0-9]|V|E",errorICD1$ICDstart)]
errorICD1[!grep("[0-9]|V|E",errorICD1$ICDstart)]
errorICD1 <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",errorICD1$ICDstart),ICDstart := "Others"]
errorICD1
errorICD1
unique(errorICD1$ICDstart)
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD), c(1, 2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD), c(1, 2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD,
errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD), c(1, 2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD), c(1, 2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD,
errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"]
errorICD_group
errorICD_group
unique(errorICD_group$ICDstart)
test <- errorICD_group[,list(cumsumCount = cumsum(count), by = "ICDstart" ]
# GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
# g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(errorFile, 10)
}
errorICDTop10$ICD <- factor(errorICDTop10$ICD)
errorICDTop10 <- errorICDTop10[,cumcount :=cumsum(count),][,cumcountperc := round(cumcount/max(cumcount)*100,2),][,Number :=1:10,]
errorICDTop10 <- as.data.frame(errorICDTop10)
# g <- ggplot(errorICDTop10, aes(x= reorder(ICD,-count) , y = count))
}
# errorICDgraph <- g +
#   geom_bar(aes(y= count), fill = "orange2", width = 0.9, stat = "identity") +
#   guides(fill = FALSE) +
#   xlab(Xlabel) + ylab("count") +
#   ggtitle(title) +
#   theme(axis.text.x = element_text(angle = 20))
Max <- max(errorICDTop10$cumcount)
y2 <- c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%")
errorICDgraph <- ggplot(errorICDTop10, aes(x= reorder(ICD,-count), y = count)) +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumcount, color = Number)) +
geom_point(aes(x= Number, y = cumcount, color = Number), pch = 10) +
scale_x_discrete(breaks = errorICDTop10$ICD) +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = 10 + .55, xmax = 10 + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = 10 + .8, y = seq(0, Max, Max/10), label = y2, size = 3.5) +
geom_segment(x = 10 + .55, xend = 10 + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
return(list(graph = errorICDgraph,
ICD = errorICDTop10))
}
load("~/data/DeliveryCCSDataLong.rda")
load("~/emr/data/ICD10DxwithTwoFormat.rda")
load("~/emr/data/ICD9DxwithTwoFormat.rda")
library(data.table)
library(ggplot2)
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
errorFile <- IcdDxDecimalToShort(DeliveryCCSDataLong[,c(5,2)], ICD, DateServiceStarted, "2015/10/01")$Error
plot.errorICD(errorFile, ICDVersion = 9, WrongICDType = format)
test <- errorICD_group[,list(cumsumCount = cumsum(count)), by = "ICDstart" ]
test <- errorICD_group[,list(cumsumCount = cumsum(count)), by = "ICDstart" ]
test
test <- errorICD_group[,list(cumsumCount = sum(count)), by = "ICDstart" ]
test
test <- errorICD_group[,list(cumsumCount = sum(count),
maxICD = max(count)), by = "ICDstart" ]
test
errorICD_group
errorICD_group[,cumsumCount := sum(count), by = "ICDstart" ]
errorICD_group
test <- errorICD_group[,maxICD = max(count), by = "ICDstart" ]
test <- errorICD_group[,maxICD := max(count), by = "ICDstart"]
test
test
test <- errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,ICD]
test
View(errorFile)
View(errorICD)
View(errorICD)
View(errorFile)
test <- errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,"ICD"]
errorICD_group
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ]
errorICD_group
errorICD_group
test <- errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,"ICD"]
test
test <- merge(errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,"ICD"],errorICD,all.x = T)
test
test <- merge(errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,"ICD"],errorICD,all.x = T)[order(count,decreasing = T)]
test
test <- merge(errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,"ICD"],errorICD,all.x = T)[order(count,decreasing = T),c(1:5)]
test
errorICD_group
errorICD_group
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ]
errorICD_group
errorICD_group
View(errorICD)
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ]
errorICD_group
errorICD_group
t<- errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,"ICD"]
t
t<- errorICD_group[,maxICD := max(count), by = "ICDstart"][count == maxICD,]
t
errorICD_group
errorICD_group
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,]
errorICD_group
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,-"maxICD"]
errorICD_group
ordered(errorICD_group$sumCount,levels = unlist(Df$modality, use.names = F))
ordered(errorICD_group$sumCount,levels = unlist(errorICD_group$sumCount, use.names = F))
errorICD_group$sumCount <- factor(errorICD_group$sumCount)
ordered(errorICD_group$sumCount,levels = unlist(errorICD_group$sumCount, use.names = F))
g <- ggplot(as.data.frame(errorICD_group), aes(x= ICDstart , y = sumCount))
g
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumcount, color = Number)) +
geom_point(aes(x= Number, y = cumcount, color = Number), pch = 10) +
scale_x_discrete(breaks = errorICDTop10$ICD) +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = 10 + .55, xmax = 10 + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = 10 + .8, y = seq(0, Max, Max/10), label = y2, size = 3.5) +
geom_segment(x = 10 + .55, xend = 10 + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,Number :=1:10,-"maxICD"]#[,Number :=1:10,]
errorICD_group
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,Number :=1:10,]#[,Number :=1:10,]
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,-"maxICD"][,Number :=1:10,]
errorICD
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,-"maxICD"][,Number :=1:10,]
errorICD
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,-"maxICD"][,Number :=1:nrow(errorICD_group),]
errorICD_group
errorICD_group
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,-"maxICD"][!duplicated(sumCount),]#[,Number :=1:nrow(errorICD_group),]
errorICD_group
errorICD_group <- errorICD[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart" ][,maxICD := max(count), by = "ICDstart"][count == maxICD,-"maxICD"][!duplicated(sumCount),][,Number :=1:nrow(errorICD_group),]
errorICD_group
errorICD_group
errorICD_group$ICDstart <- factor(errorICD_group$ICDstart)
g <- ggplot(as.data.frame(errorICD_group), aes(x= ICDstart , y = sumCount))
errorICD
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
errorICD1 <- errorICD
errorICD_group <- errorICD1[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart"][count == max(count),]#[!duplicated(sumCount),][,Number :=1:nrow(errorICD_group),]
errorICD_group
errorICD_group <- errorICD1[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart"][count == max(count),by = "ICDstart"]#[!duplicated(sumCount),][,Number :=1:nrow(errorICD_group),]
errorICD1
errorICD1 <- errorICD
errorICD_group <- errorICD1[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart"][count == max(count),by = "ICDstart"]#[!duplicated(sumCount),][,Number :=1:nrow(errorICD_group),]
errorICD1 <- errorICD
errorICD_group <- errorICD1[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart"][,maxICD := max(count), by = "ICDstart"][count == max(count),]
errorICD_group
errorICD1
errorICD
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
errorICD1 <- errorICD
errorICD1
errorICD_group <- errorICD1[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart"][,maxICD := max(count), by = "ICDstart"][count == max(count),][!duplicated(sumCount),][,Number :=1:nrow(errorICD_group),]
errorICD_group
errorICD_group
errorICD
ICDVersion <- 9
WrongICDType <- "format"
groupICDNum <- 1
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
errorICD
errorICD1 <- errorICD
errorICD1
errorICD_group <- errorICD1[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,sumCount := sum(count), by = "ICDstart"][,maxICD := max(count), by = "ICDstart"]#[count == max(count),][!duplicated(sumCount),][,Number :=1:nrow(errorICD_group),]
errorICD_group
errorICD_group
errorICD
errorICD1
pkgdown::build_site()
setwd("~/emr")
devtools::document()
install.packages("Rcpp")
devtools::document()
install.packages("glue")
devtools::document()
devtools::check()
load("~/emr/data/ICD9PrwithTwoFormat.rda")
head(ICD9PrwithTwoFormat$Decimal,10)
load("~/emr/data/prICD10.rda")
head(prICD10$ICD,10)
load("~/emr/data/ICD9DxwithTwoFormat.rda")
load("~/emr/data/ICD10DxwithTwoFormat.rda")
head(ICD9DxwithTwoFormat$Short,10)
ICD9DxwithTwoFormat$Decimal[1:10]
head(ICD10DxwithTwoFormat$Short,10)
head(ICD10DxwithTwoFormat$Decimal,10)
IcdDxShortToDecimal(sampleDxFile,ICD,Date,"2015/10/01")
indexDateTable <- data.frame(ID = c("A","B","C","D"),
indexDate = c("2006-05-03", "2006-05-03",
"2008-03-30", "2006-05-03"),
stringsAsFactors = FALSE)
splitDataByDate(sampleDxFile, ID, ICD, Date,
indexDateFile = indexDateTable,
windowGap = 30)
setwd("~/emr")
pkgdown::build_site()
