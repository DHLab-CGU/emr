load("~/emr/data/icd9_elix.rda")
icd10_ahrq <- as.data.table(icd10_ahrq)
save(icd10_ahrq,file = "icd10_ahrq.rda",compress='xz')
icd10_charlson <- as.data.table(icd10_charlson)
save(icd10_charlson,file = "icd10_charlson.rda",compress='xz')
icd10_elix <- as.data.table(icd10_elix)
save(icd10_elix,file = "icd10_elix.rda",compress='xz')
icd9_ahrq <- as.data.table(icd9_ahrq)
save(icd9_ahrq,file = "icd9_ahrq.rda",compress='xz')
icd9_charlson <- as.data.table(icd9_charlson)
save(icd9_charlson,file = "icd9_charlson.rda",compress='xz')
icd9_elix <- as.data.table(icd9_elix)
save(icd9_elix,file = "icd9_elix.rda",compress='xz')
comorbidMap9 <- `icd9_elix`
comorbidMap9[,.c(ICD,ccs_col)]
comorbidMap9[,.(ICD,ccs_col)]
comorbidMap9[,.(ICD,Comorbidity)]
View(icd9_elix)
icd9_elix$Value <- NULL
icd9_charlson$Value <- NULL
icd9_ahrq$Value <- NULL
icd10_elix$Value <- NULL
icd10_ahrq$Value <- NULL
icd10_charlson$Value <- NULL
save(icd9_elix,file = "icd9_elix.rda",compress='xz')
save(icd9_charlson,file = "icd9_charlson.rda",compress='xz')
save(icd9_ahrq,file = "icd9_ahrq.rda",compress='xz')
save(icd10_elix,file = "icd10_elix.rda",compress='xz')
save(icd10_charlson,file = "icd10_charlson.rda",compress='xz')
save(icd10_ahrq,file = "icd10_ahrq.rda",compress='xz')
IcdToComorbid <- rbind(left_join(data.frame(DxDataFile[DxDataFile$Date < icd10usingDate,]),
select(comorbidMap9,ICD,Comorbidity),by = c("Short"="ICD")),
left_join(data.frame(DxDataFile[DxDataFile$Date  >= icd10usingDate,]),
select(comorbidMap10,ICD,Comorbidity), by = c("Short"="ICD"))) %>% arrange(Number) %>% unique
comorbidMap9 <- `icd9_elix`
comorbidMap10 <- `icd10_elix`
IcdToComorbid <- rbind(left_join(data.frame(DxDataFile[DxDataFile$Date < icd10usingDate,]),
select(comorbidMap9,ICD,Comorbidity),by = c("Short"="ICD")),
left_join(data.frame(DxDataFile[DxDataFile$Date  >= icd10usingDate,]),
select(comorbidMap10,ICD,Comorbidity), by = c("Short"="ICD"))) %>% arrange(Number) %>% unique
IcdToComorbid123 <- rbind(merge(DxDataFile[Date <icd10usingDate],comorbidMap9[,c(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >=icd10usingDate],comorbidMap10[,c(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T))
View(DxDataFile)
names(comorbidMap9)
DxDataFile[Date <icd10usingDate]
comorbidMap9[,c(ICD,Comorbidity)]
IcdToComorbid123 <- rbind(merge(DxDataFile[Date <icd10usingDate],comorbidMap9[,.(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >=icd10usingDate],comorbidMap10[,.(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T))
View(IcdToComorbid)
View(IcdToComorbid123)
IcdToComorbid <- rbind(merge(DxDataFile[Date <icd10usingDate],comorbidMap9[,.(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >=icd10usingDate],comorbidMap10[,.(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T))
IcdToComorbid
IcdToCCSLong <- IcdToComorbid[order(Number)&!is.na(IcdToComorbid[,Comorbidity]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID","Comorbidity")]
IcdToCCSLong
IcdToCCSLong123 <- IcdToComorbid[order(Number)&!is.na(IcdToComorbid[,Comorbidity]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = list(ID,Comorbidity)]
View(IcdToCCSLong)
View(IcdToCCSLong123)
#' @source ICD-9-CM Elixhauser (2012-2015)
#' @source \url{https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references}
#' @source ICD-10-CM Elixhauser (2019)
#' @source \url{https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comorbidity_icd10.jsp}
#' @examples
#'
#' IcdDxToComorbid(testDxFile, ID, ICD, Date, "2015-10-01", charlson)
#' IcdDxToComorbid(testDxFile, ID, ICD, Date, "2015-10-01", elix)
#' IcdDxToComorbid(testDxFile, ID, ICD, Date, "2015-10-01", ahrq)
#'
IcdDxToComorbid <- function(DxDataFile, idColName, icdColName, dateColName, icd10usingDate, comorbidMethod){
DxDataFile <- as.data.table(DxDataFile)
DataCol <- c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))
DxDataFile <- DxDataFile[,DataCol,with = FALSE]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile[,"Date"] <- as.Date(DxDataFile[,Date])
DxDataFile[,Number:=1:nrow(DxDataFile)]
DxDataFile$Short <- IcdDxDecimalToShort(DxDataFile,ICD,Date,icd10usingDate)$ICD
comorbidMethod <- tolower(deparse(substitute(comorbidMethod)))
if (grepl("ahrq", comorbidMethod)){
comorbidMap9 <- `icd9_ahrq`
comorbidMap10 <- `icd10_ahrq`
}else if(grepl("charlson", comorbidMethod)){
comorbidMap9 <- `icd9_charlson`
comorbidMap10 <- `icd10_charlson`
}else if(grepl("elix", comorbidMethod)){
comorbidMap9 <- `icd9_elix`
comorbidMap10 <- `icd10_elix`
}else{
stop("'please enter AHRQ, Charlson or Elix for 'comorbidMethod'", call. = FALSE)
}
IcdToComorbid <- rbind(merge(DxDataFile[Date <icd10usingDate],comorbidMap9[,.(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >=icd10usingDate],comorbidMap10[,.(ICD,Comorbidity)],by.x ="Short",by.y = "ICD",all.x = T))
IcdToComorbidLong <- IcdToComorbid[order(Number)&!is.na(IcdToComorbid[,Comorbidity]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = list(ID,Comorbidity)]
IcdToComorbidLong <- IcdToComorbidLong[,period := (endCaseDate - firstCaseDate),]
return(list(groupedIcd = IcdToComorbid,
groupedData_Long = IcdToComorbidLong))
}
IcdDxToComorbid(testDxFile, ID, ICD, Date, "2015-10-01", charlson)
IcdDxToComorbid(sampleDxFile, ID, ICD, Date, "2015-10-01", charlson)
merge(DxDataFile[Date <icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T)
load("~/emr/data/ccsDxICD9.rda")
load("~/emr/data/ccsDxICD10.rda")
merge(DxDataFile[Date <icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T)
CCSLevel <- 2
CCSLvlCol <- as.character(parse(text = paste("CCS_LVL_", CCSLevel, sep = "")))
merge(DxDataFile[Date <icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T)
DxDataFile
DxDataFile[Date >=icd10usingDate,eval(parse(text = paste(CCSLvlCol))) := NA]
DxDataFile[Date >=icd10usingDate,CCSLvlCol:= NA]
DxDataFile[Date >=icd10usingDate,CCSLvlCol:= NA]
DxDataFile[Date >=icd10usingDate][,CCSLvlCol:= NA]
DxDataFile[Date >=icd10usingDate]
CCSLvlCol <- as.character(parse(text = paste("CCS_LVL_", CCSLevel, sep = "")))
DxDataFile[Date >=icd10usingDate][,"CCSLvlCol123":= NA]
test <- DxDataFile[Date >=icd10usingDate][,"CCSLvlCol123":= NA]
test
test <- DxDataFile[Date >=icd10usingDate][,as.character(parse(text = paste("CCS_LVL_", CCSLevel, sep = ""))):= NA]
test
DxDataFile[Date >= icd10usingDate][,(CCSLvlCol):= NA]
DxDataFile[Date >= icd10usingDate][,(CCSLvlCol):= NA]
DxDataFile[Date >= icd10usingDate][,(CCSLvlCol):= NA]
test <- DxDataFile[Date >= icd10usingDate][,(CCSLvlCol):= NA]
test
paste("CCS_LVL_", CCSLevel, sep = "")
paste0("CCS_LVL_", CCSLevel, sep = "")
paste0("CCS_LVL_", CCSLevel)
paste("CCS_LVL_", CCSLevel)
if(CCSLvlLabel == T){
CCSLvlCol <- paste0("CCS_LVL_", CCSLevel, "_LABEL")
}else{
CCSLvlCol <- paste0("CCS_LVL_", CCSLevel)
}
CCSLvlCol <- paste0("CCS_LVL_", CCSLevel, "_LABEL")
if(CCSLevel <= 2){
IcdToCCSLvl <- rbind(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >= icd10usingDate],ccsDxICD10[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T))
}else{
IcdToCCSLvl <- rbind(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
DxDataFile[Date >= icd10usingDate][, CCSLvlCol:= NA])
}
CCSLevel <- 3
CCSLvlCol <- paste0("CCS_LVL_", CCSLevel, "_LABEL")
if(CCSLevel <= 2){
IcdToCCSLvl <- rbind(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >= icd10usingDate],ccsDxICD10[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T))
}else{
IcdToCCSLvl <- rbind(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
DxDataFile[Date >= icd10usingDate][, CCSLvlCol:= NA])
}
merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T)
#' @export
#' @source ICD-9-CM CCS (2012)
#' @source \url{https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Single_Level_CCS_2015.zip}
#' @source \url{https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Multi_Level_CCS_2015.zip}
#' @source ICD-10-CM CCS (2019)
#' @source \url{https://www.hcup-us.ahrq.gov/toolssoftware/ccs10/ccs_dx_icd10cm_2019_1.zip}
#' @examples
#'
#' IcdDxToCCSLvl(sampleDxFile, ID, ICD, Date, "2015-10-01", 2, TRUE)
#'
DxDataFile <- sampleDxFile
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile[,"Date"] <- as.Date(DxDataFile[,Date])
DxDataFile[,Number:=1:nrow(DxDataFile)]
DxDataFile$Short <- IcdDxDecimalToShort(DxDataFile,ICD,Date,icd10usingDate)$ICD
CCSLvlCol <- paste0("CCS_LVL_", CCSLevel, "_LABEL")
IcdToCCSLvl <- rbind(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >= icd10usingDate],ccsDxICD10[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T))
IcdToCCSLvl <- rbind(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
DxDataFile[Date >= icd10usingDate][, CCSLvlCol:= NA])
merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T)
IcdToCCSLvl <- merge(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
DxDataFile[Date >= icd10usingDate])
IcdToCCSLvl
IcdToCCSLvl <- merge(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
DxDataFile[Date >= icd10usingDate], by = names(DxDataFile),all = T)
IcdToCCSLvl
IcdToCCSLong <- IcdToCCS[order(Number)&!is.na(IcdToCCS[,eval(parse(text = paste(ccs_col)))]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID",ccs_col)]
IcdToCCS <- rbind(merge(DxDataFile[Date <icd10usingDate],ccsDxICD9[,c("ICD",ccs_col), with = F],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >=icd10usingDate],ccsDxICD10[,c("ICD",ccs_col), with = F],by.x ="Short",by.y = "ICD",all.x = T))
ccs_col <- "CCS_CATEGORY_DESCRIPTION"
IcdToCCS <- rbind(merge(DxDataFile[Date <icd10usingDate],ccsDxICD9[,c("ICD",ccs_col), with = F],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >=icd10usingDate],ccsDxICD10[,c("ICD",ccs_col), with = F],by.x ="Short",by.y = "ICD",all.x = T))
IcdToCCSLong <- IcdToCCS[order(Number)&!is.na(IcdToCCS[,eval(parse(text = paste(ccs_col)))]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID",ccs_col)]
IcdToCCSLong <- IcdToCCSLong[,period := (endCaseDate - firstCaseDate),]
IcdToCCSLong123 <- IcdToCCS[order(Number)&!is.na(IcdToCCS[,eval(parse(text = paste(ccs_col)))]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID",ccs_col)][,period := (endCaseDate - firstCaseDate),]
View(IcdToCCSLong)
View(IcdToCCSLong123)
View(IcdToCCSLong)
View(IcdToCCSLong123)
View(IcdToCCSLong)
is.na(IcdToCCSLvl[,eval(parse(text = paste(CCSLvlCol)))])
!is.na(IcdToCCSLvl[,eval(parse(text = paste(CCSLvlCol)))])
CCSLvlCol
IcdToCCSLvlLong <- IcdToCCSLvl[order(Number)&!is.na(IcdToCCSLvl[,eval(parse(text = paste(CCSLvlCol)))]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID",CCSLvlCol)][,period := (endCaseDate - firstCaseDate),]
IcdToCCSLvlLong
DxDataFile <- as.data.table(DxDataFile)
IcdDxToCCSLvl <- function(DxDataFile, idColName, icdColName, dateColName, icd10usingDate, CCSLevel = 2, CCSLvlLabel = TRUE){
DxDataFile <- as.data.table(DxDataFile)
DataCol <- c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))
DxDataFile <- DxDataFile[,DataCol,with = FALSE]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile[,"Date"] <- as.Date(DxDataFile[,Date])
DxDataFile[,Number:=1:nrow(DxDataFile)]
DxDataFile$Short <- IcdDxDecimalToShort(DxDataFile,ICD,Date,icd10usingDate)$ICD
if(CCSLvlLabel == T){
CCSLvlCol <- paste0("CCS_LVL_", CCSLevel, "_LABEL")
}else{
CCSLvlCol <- paste0("CCS_LVL_", CCSLevel)
}
if(CCSLevel <= 2){
IcdToCCSLvl <- rbind(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
merge(DxDataFile[Date >= icd10usingDate],ccsDxICD10[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T))
}else{
IcdToCCSLvl <- merge(merge(DxDataFile[Date < icd10usingDate],ccsDxICD9[,c("ICD", CCSLvlCol), with = F],by.x ="Short",by.y = "ICD",all.x = T),
DxDataFile[Date >= icd10usingDate], by = names(DxDataFile), all = T)
}
IcdToCCSLvlLong <- IcdToCCSLvl[order(Number)&!is.na(IcdToCCSLvl[,eval(parse(text = paste(CCSLvlCol)))]),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID",CCSLvlCol)][,period := (endCaseDate - firstCaseDate),]
return(list(groupedDf = IcdToCCSLvl,
groupedData_Long = IcdToCCSLvlLong))
}
IcdDxToCCSLvl(sampleDxFile, ID, ICD, Date, "2015-10-01", 2, TRUE)
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID",ccs_col)][,period := (endCaseDate - firstCaseDate),][Count >= ICDNumber & InTimeINR ==TRUE,]
grepICD <- "^R57|^R65|^785"
DxDataFile <- sampleDxFile
ICDNumber <- 2
names(DxDataFile) <- c("ID", "MostCommonICD", "Date")
DxDataFile[,"Date"] <- as.Date(DxDataFile[,Date])
DxDataFile[,Number:=1:nrow(DxDataFile)]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = c("ID",ccs_col)][,period := (endCaseDate - firstCaseDate),][Count >= ICDNumber & InTimeINR ==TRUE,]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][Count >= ICDNumber & InTimeINR ==TRUE,]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][count >= ICDNumber & InTimeINR ==TRUE,]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
minimumINRofDays = 30, maximumINRofDays = 365
minimumINRofDays = 30
maximumINRofDays = 365
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
View(DxDataFile)
grepICD <- "^427"
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
minimumINRofDays = 1
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),] %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = period >= minimumINRofDays & period < maximumINRofDays) %>%
filter(Count >= ICDNumber & InTimeINR ==TRUE) %>%
select (-InTimeINR)
Count
ICDNumber <- 1
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),] %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = period >= minimumINRofDays & period < maximumINRofDays) %>%
filter(Count >= ICDNumber & InTimeINR ==TRUE) %>%
select (-InTimeINR)
Count
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID]
DxDataFile
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),]
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),]
test
View(test)
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),]
test
grepICD <- "^427|^785"
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),]
test<-DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),]
test
View(test)
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,]
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays,]
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period < maximumINRofDays,]
maximumINRofDays = 600
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,]
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,]
test <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD)]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD),
.(firstCaseDate = min(Date),
endCaseDate = max(Date),
count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
Count
View(Count)
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)]
CaseICD
CaseICD <-  DxDataFile[order(count,decreasing = T),grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T),]
CaseICD
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE & -InTimeINR,]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,-InTimeINR]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,][-InTimeINR,]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]#[-InTimeINR,]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,][-InTimeINR]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,][,-InTimeINR]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,][,-(InTimeINR)]
Count <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,][count >= ICDNumber & InTimeINR ==TRUE,]#[,-(InTimeINR)]
Count123 <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,.(count >= ICDNumber,InTimeINR ==TRUE)]#[,-(InTimeINR)]
Count123 <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(firstCaseDate = min(Date), endCaseDate = max(Date),count = .N),
by = ID][,period := (endCaseDate - firstCaseDate),][,InTimeINR := period >= minimumINRofDays & period < maximumINRofDays,.(count >= ICDNumber)][InTimeINR ==TRUE]#[,-(InTimeINR)]
View(Count123)
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T),][slice.index(1)]
View(CaseICD)
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T)&max(count),]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T)&max(count),by = list(ID,MostCommonICD)]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T),.count = max(count),by = list(ID,MostCommonICD)]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T),][,max(count),by = list(ID,MostCommonICD)]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T),][,max(count),by = list(ID)]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T),][1,by = list(ID)]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T),][,1,by = list(ID)]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][1,order(count,decreasing = T),]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T)&1,]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)][order(count,decreasing = T)&1,by =ID]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)]
CaseICD <- CaseICD[order(count,decreasing = T)&1,by = ID]
CaseICD <- CaseICD[order(count,decreasing = T),by = ID]
CaseICD <- CaseICD[order(count,decreasing = T),,by = ID]
CaseICD <- CaseICD[,order(count,decreasing = T),by = ID]
CaseICD <-  DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)]
CaseICD <- CaseICD[order(count,decreasing = T),MostCommonICDCount = max(count),by = ID]
CaseICD <- CaseICD[order(count,decreasing = T),MostCommonICDCount := max(count),by = ID]
View(CaseICD)
CaseICD <- CaseICD[order(count,decreasing = T),MostCommonICDCount := max(count),by = ID][1,]
CaseICD <- CaseICD[order(count,decreasing = T),MostCommonICDCount := max(count),by = ID][1,,by = ID]
CaseICD <- CaseICD[order(count,decreasing = T),MostCommonICDCount := max(count),by = ID][1,by = ID]
CaseCount <- merge(Count,CaseICD[,.(ICD,MostCommonICD)],"ID")
CaseCount <- merge(Count,CaseICD[,.(ID,MostCommonICD)],"ID")
CaseCount
CaseICD
Count
CaseICD <- c("B","427.61",1,1)
CaseICD
CaseICD <- DxDataFile[grepl(grepICD, DxDataFile$MostCommonICD), .(count = .N), by = list(ID,MostCommonICD)]
CaseICD <- CaseICD[order(count,decreasing = T),MostCommonICDCount := max(count),by = ID][1,]
CaseICD[2,] <- c("B","427.61",1,)
CaseICD[2] <- c("B","427.61",1,)
CaseICD[2] <- c("B","427.61",1,1)
CaseICD[2,] <- c("B","427.61",1,1)
CaseICD[2] <- c("B","427.61",1,1)
CaseICD[1]
CaseICD[2]
CaseICD[2]<- c("B","427.61",1,1)
CaseICD[2,2]<- c("B","427.61",1,1)
CaseICD[1]<- c("B","427.61",1,1)
CaseICD
CaseICD[1]<- c("B","427.61","1","1")
CaseICD
CaseCount <- merge(Count,CaseICD[,.(ID,MostCommonICD)],"ID")
CaseCount
Count
