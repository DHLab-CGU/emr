else{g <- ggplot(as.data.frame(Data), aes(x= x , y = y))}
errorICDgraph <- g +
geom_bar(fill = "orange2", width=0.9, stat="identity") +
guides(fill=FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
}
if(groupICD == TRUE){
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
}
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(error, 10)
}
graph.fun(errorICDTop10, ICD, count, order = FALSE)
}
GroupedErrorICD
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
graph.fun <- function(Data, xaxis, yaxis,order = T){
Data[,deparse(substitute(xaxis))] <- factor(Data[,deparse(substitute(xaxis))])
if(order == T){g <- ggplot(as.data.frame(Data), aes(x= reorder(xaxis,-yaxis) , y = yaxis))}
else{g <- ggplot(as.data.frame(Data), aes(x= xaxis , y = yaxis))}
errorICDgraph <- g +
geom_bar(fill = "orange2", width=0.9, stat="identity") +
guides(fill=FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
}
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
GroupedErrorICD
Data <- GroupedErrorICD
GroupedErrorICD[,deparse(substitute(ICDstart))] <- factor(Data[,deparse(substitute(ICDstart))])
GroupedErrorICD[,ICDstart] <- factor(Data[,ICDstart])
if(groupICD == TRUE){
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
}
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(error, 10)
}
graph.fun(errorICDTop10, ICD, count, order = FALSE)
}
Data <- GroupedErrorICD
GroupedErrorICD[,ICDstart] <- factor(Data[,ICDstart])
GroupedErrorICD
GroupedErrorICD[,"ICDstart"] <- factor(Data[,"ICDstart"])
GroupedErrorICD
str(GroupedErrorICD)
GroupedErrorICD[,"ICDstart"] <- factor(Data[,"ICDstart"])
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
str(GroupedErrorICD)
GroupedErrorICD$ICDstart
Data
if(groupICD == TRUE){
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
}
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(error, 10)
}
graph.fun(errorICDTop10, ICD, count, order = FALSE)
}
str(Data)
Data$ICDstart
Data[,ICDstart]
Data[,ICDstart] <- factor(Data[,ICDstart])
Data[,list(ICDstart)] <- factor(Data[,list(ICDstart)])
str(Data)
Data[,c("ICDstart")] <- factor(Data[,c("ICDstart")])
Data[,c("ICDstart")]
Data[,ICDstart]
Data[,ICDstart]
factor(Data[,ICDstart])
Data[,ICDstart]
Data[,ICDstart] <- factor(Data[,ICDstart])
Data[,ICDstart] <- as.factor(Data[,ICDstart])
str(Data)
Data[,ICDstart]
Data[,c("ICDstart")]
Data[,"ICDstart"]
graph.fun <- function(Data, xaxis, yaxis,order = T){
Data[,xaxis] <- factor(Data[,xaxis])
if(order == T){g <- ggplot(as.data.frame(Data), aes(x= reorder(xaxis,-yaxis) , y = yaxis))}
else{g <- ggplot(as.data.frame(Data), aes(x= xaxis , y = yaxis))}
errorICDgraph <- g +
geom_bar(fill = "orange2", width=0.9, stat="identity") +
guides(fill=FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
}
if(groupICD == TRUE){
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
}
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(error, 10)
}
graph.fun(errorICDTop10, ICD, count, order = FALSE)
}
GroupedErrorICD
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
Data
Data$ICDstart
Data[,ICDstart]
graph.fun <- function(Data, xaxis, yaxis,order = T){
if(order == T){g <- ggplot(as.data.frame(Data), aes(x= reorder(xaxis,-yaxis) , y = yaxis))}
else{g <- ggplot(as.data.frame(Data), aes(x= xaxis , y = yaxis))}
errorICDgraph <- g +
geom_bar(fill = "orange2", width=0.9, stat="identity") +
guides(fill=FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
}
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
graph.fun(GroupedErrorICD, ICDstart, sum, order = FALSE)
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
g <- ggplot(as.data.frame(Data), aes(x= xaxis , y = yaxis))
errorICDgraph <- g +
geom_bar(fill = "orange2", width=0.9, stat="identity") +
guides(fill=FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
errorICDgraph <- g +
geom_bar(fill = "orange2", width=0.9, stat="identity") +
guides(fill=FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
WrongICDType <- "all"
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- error[IcdVersionInFile == ICDVersion]
title <- paste0("Error ",ICDVersion,": Top 10")
Xlabel <- paste0("Error ",ICDVersion)
}else if(ICDVersion =="9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- error[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
errorICDgraph <- g +
geom_bar(fill = "orange2", width = 0.9, stat = "identity") +
guides(fill = FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
ICDVersion
ICDVersion <- 9
WrongICDType <- "all"
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- error[IcdVersionInFile == ICDVersion]
title <- paste0("Error ",ICDVersion,": Top 10")
Xlabel <- paste0("Error ",ICDVersion)
}else if(ICDVersion =="9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- error[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD),c(1,2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD),c(1,2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD, errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
errorICDgraph <- g +
geom_bar(fill = "orange2", width = 0.9, stat = "identity") +
guides(fill = FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
ICDVersion <- 9
WrongICDType <- "all"
groupICDNum <- 1
errorICD[grepl(paste0("^",groupICDNum),ICD),]
if(exists("groupICDNum")){
errorICD <- errorICD[grepl(paste0("^",groupICDNum),ICD),]
}
errorICDTop10$ICD <- factor(errorICDTop10$ICD)
g <- ggplot(as.data.frame(errorICDTop10), aes(x= reorder(ICD,-count) , y = count))
errorICDTop10 <- head(errorICD, 10)
errorICDTop10$ICD <- factor(errorICDTop10$ICD)
g <- ggplot(as.data.frame(errorICDTop10), aes(x= reorder(ICD,-count) , y = count))
errorICDgraph <- g +
geom_bar(fill = "orange2", width = 0.9, stat = "identity") +
guides(fill = FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDTop10
errorICD
groupErrorICD.fun <- function(Data){
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(Data[grepl(paste0("^",num),ICD), c(1, 2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
Data[grepl(paste0("^",(num+1)),ICD), c(1, 2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD,
Data[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
return(g)
}
#####
test <- plot.errorICD(DeliveryCCSDataLong, ICD, DateServiceStarted, "2015/10/01",
ICDVersion = 9,
WrongICDType = format)
View(errorICDTop10)
error <- test$ICD
View(errorICDTop10)
error <- test$ICD
error
#####
test <- IcdDxDecimalToShort(DeliveryCCSDataLong, ICD, DateServiceStarted, "2015/10/01")$Error
test
View(test)
ICDVersion
WrongICDType
errorFile <- error
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
title
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
errorICD
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
title
is.null(1)
is.null(NULL)
#' @param ICDVersion ICD version
#' @param WrongICDType Wrong ICD type
#' @param groupICD wrong ICD start with: \code{'0'-'9'}, \code{'eng'} or \code{'all'}
#' @source \url{http://sape.inf.usi.ch/quick-reference/ggplot2/colour}
#' @export
#' @examples
#' head(sampleDxFile)
#' error <- IcdDxDecimalToShort(sampleDxFile,ICD,Date, "2015/10/01")$Error
#' plot.errorICD(error, ICDVersion = 9, WrongICDType = all, groupICD = FALSE)
#'
plot.errorICD <- function(errorFile, ICDVersion = all, WrongICDType = all, groupICD = NULL){
ICDVersion <- tolower(deparse(substitute(ICDVersion)))
WrongICDType <- tolower(deparse(substitute(WrongICDType)))
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
if(!is.null(groupICD)){
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(Data[grepl(paste0("^",num),ICD), c(1, 2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
Data[grepl(paste0("^",(num+1)),ICD), c(1, 2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD,
Data[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(errorFile, 10)
}
errorICDTop10$ICD <- factor(errorICDTop10$ICD)
g <- ggplot(as.data.frame(errorICDTop10), aes(x= reorder(ICD,-count) , y = count))
}
errorICDgraph <- g +
geom_bar(fill = "orange2", width = 0.9, stat = "identity") +
guides(fill = FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
return(list(graph = errorICDgraph,
ICD = errorICDTop10))
}
plot.errorICD(test, ICDVersion = 9, WrongICDType = format)
plot.errorICD(test, ICDVersion = 9, WrongICDType = format,groupICD = 1)
#' @param ICDVersion ICD version
#' @param WrongICDType Wrong ICD type
#' @param groupICD wrong ICD start with: \code{'0'-'9'}, \code{'eng'} or \code{'all'}
#' @source \url{http://sape.inf.usi.ch/quick-reference/ggplot2/colour}
#' @export
#' @examples
#' head(sampleDxFile)
#' error <- IcdDxDecimalToShort(sampleDxFile,ICD,Date, "2015/10/01")$Error
#' plot.errorICD(error, ICDVersion = 9, WrongICDType = all, groupICD = FALSE)
#'
plot.errorICD <- function(errorFile, ICDVersion = all, WrongICDType = all, groupICD = NULL){
ICDVersion <- tolower(deparse(substitute(ICDVersion)))
WrongICDType <- tolower(deparse(substitute(WrongICDType)))
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
ICDVersion <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == ICDVersion]
title <- paste0("Error ", ICDVersion, ": Top 10")
Xlabel <- paste0("Error ", ICDVersion)
}else if(ICDVersion == "9" && ICDVersion == "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(WrongICDType == "format" | WrongICDType == "version"){
WrongICDType <- paste0("Wrong ", WrongICDType)
if(exists("errorICD")){
errorICD <- errorICD[WrongType == WrongICDType,]
}else{
errorICD <- errorFile[WrongType == WrongICDType,]
}
title <- paste0(title," (",WrongICDType,")")
}else if (WrongICDType != "format" && WrongICDType != "version" && WrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'WrongICDType'", call. = FALSE)
}
if(!is.null(groupICD)){
GroupedErrorICD <- data.table()
for(num in seq(0,9,2)){
GroupedICDcount <- rbind(errorICD[grepl(paste0("^",num),ICD), c(1, 2)][,ICDstart := num,][,list(sum = sum(count)),by = "ICDstart"],
errorICD[grepl(paste0("^",(num+1)),ICD), c(1, 2)][,ICDstart := (num+1),][,list(sum = sum(count)),by = "ICDstart"])
GroupedErrorICD <- rbind(GroupedErrorICD, GroupedICDcount)
if(num == 8){
GroupedErrorICD <- rbind(GroupedErrorICD,
errorICD[grepl("^[A-Za-z]",ICD),c(1,2)][,ICDstart := "eng",][,list(sum = sum(count)),by = "ICDstart"])
}
}
GroupedErrorICD$ICDstart <- factor(GroupedErrorICD$ICDstart)
g <- ggplot(as.data.frame(GroupedErrorICD), aes(x= ICDstart , y = sum))
}else{
if(exists("errorICD")){
errorICDTop10 <- head(errorICD, 10)
}else{
errorICDTop10 <- head(errorFile, 10)
}
errorICDTop10$ICD <- factor(errorICDTop10$ICD)
g <- ggplot(as.data.frame(errorICDTop10), aes(x= reorder(ICD,-count) , y = count))
}
errorICDgraph <- g +
geom_bar(fill = "orange2", width = 0.9, stat = "identity") +
guides(fill = FALSE) +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
return(list(graph = errorICDgraph,
ICD = errorICDTop10))
}
plot.errorICD(test, ICDVersion = 9, WrongICDType = format,groupICD = 1)
errorICDTop10
plot.errorICD(test, ICDVersion = 9, WrongICDType = format)
plot.errorICD(test, ICDVersion = 9, WrongICDType = format,groupICD = 1)
