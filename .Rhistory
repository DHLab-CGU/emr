}
Start <- Sys.time()
selectCases("^427", DxDataFile, ID, ICD, Date, 2) #(353obs)
End <- Sys.time()
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
CaseCount <- DxDataFile %>%
filter(grepl(greplICD, ICD)) %>%
mutate(Count = n()) %>%
group_by(ID,ICD,Count) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n()) %>%
filter(MostCommonIcdCount >= ICDNumber)
CaseCountInTimeINR
}
Start <- Sys.time()
selectCases("^427", DxDataFile, ID, ICD, Date, 2) #(353obs)
End <- Sys.time()
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
CaseCount <- DxDataFile %>%
filter(grepl(greplICD, ICD)) %>%
mutate(Count = n()) %>%
group_by(ID,ICD,Count) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n()) %>%
filter(MostCommonIcdCount >= ICDNumber)
CaseCount
}
Start <- Sys.time()
selectCases("^427", DxDataFile, ID, ICD, Date, 2) #(353obs)
End <- Sys.time()
End - Start
Start <- Sys.time()
selectCases("^427", test, MemberID,ICD,DateServiceStarted, 2) #0.06236601 secs (353obs)
End <- Sys.time()
End - Start
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
CaseCount <- DxDataFile %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
mutate(Count = n()) %>%
group_by(ID,ICD,Count) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n()) %>%
filter(MostCommonIcdCount >= ICDNumber)
CaseCount
}
selectCases("^427", test, MemberID,ICD,DateServiceStarted, 2) #2.97 secs (684105 obs)
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
CaseCount <- DxDataFile %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD,Count) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n()) %>%
mutate(Count = n()) %>%
filter(MostCommonIcdCount >= ICDNumber)
CaseCount
}
Start <- Sys.time()
selectCases("^427", test, MemberID,ICD,DateServiceStarted, 2) #2.97 secs (684105 obs)
End <- Sys.time()
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
CaseCount <- DxDataFile %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n()) %>%
mutate(Count = n()) %>%
filter(MostCommonIcdCount >= ICDNumber)
CaseCount
}
selectCases("^427", test, MemberID,ICD,DateServiceStarted, 2) #2.97 secs (684105 obs)
View(test)
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
CaseCount <- DxDataFile %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n()) %>%
mutate(Count = n()) %>%
filter(MostCommonIcdCount >= ICDNumber)
CaseCount
}
selectCases("^427", test, MemberID,ICD,DateServiceStarted, 2) #2.97 secs (684105 obs)
DxDataFile %>%
group_by(ID)
DxDataFile %>%
group_by(ID) %>%
filter(grepl(greplICD, ICD))
DxDataFile %>%
group_by(ID) %>%
filter(grepl(greplICD, ICD)) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n())
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID)
#' @param minimumINRofDays Minimum interval of Days, defaults is 30 days (one month)
#' @param maximumINRofDays Maximum interval of Days, defaults is 365 days (one year)
#' @export
#' @examples
#' DxDataFile <- data.frame(ID = c("A", "A", "A", "A"),
#'                          ICD = c("I072","I071", "I072", "I071"),
#'                          Date = as.Date(c("2016-03-31", "2016-01-29", "2016-02-10", "2018-03-10")),
#'                          stringsAsFactors = FALSE)
#' selectCases("^I0", DxDataFile, ID, ICD, Date, 2)
#'
DxDataFile <- test[grepl("00000006634930745125|00000006413184713625|00000004843151830325|00000016563219022925|00000022407396329525",test$MemberID),1:3]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID)
DxDataFile <- test
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID)
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD))
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID)
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n())
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
MostCommonIcdCount = n()) %>%
mutate(Count = n())
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n())
CaseCount <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n()) %>%
filter(MostCommonIcdCount >= ICDNumber)
CaseCount
CaseCount <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n()) %>%
filter(Count >= ICDNumber)
CaseCount
CaseCount <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n())
CaseCount
Count <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n())
# CaseICD <-
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD)
# CaseICD <-
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(Count = n())
# CaseICD <-
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n(),
MostCommonICD = max(ICDCount))
# CaseICD <-
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n(),
MostCommonICD = max())
# CaseICD <-
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n(),
MostCommn=max.col(ICDCount))
# CaseICD <-
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
group_by(ID,ICDCount) %>%
summarise(MostCommn = max(ICDCount))
# CaseICD <-
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n())
#MostCommonIcd
# filter(Count >= ICDNumber)
CaseCount <- left_join(Count,CaseICD,"ID")
CaseICD <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n())
#MostCommonIcd
# filter(Count >= ICDNumber)
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount
CaseICD <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
filter(Count >= ICDNumber)
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount
CaseICD <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
filter(ICDCount >= ICDNumber)
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount
CaseCount <- left_join(CaseICD,Count,"ID")
CaseCount
CaseCount <- rignt_join(Count,CaseICD,"ID")
CaseCount <- right_join(Count,CaseICD,"ID")
CaseCount
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
Count <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n())
CaseICD <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
filter(ICDCount >= ICDNumber)
#MostCommonIcd
CaseCount <- right_join(Count,CaseICD,"ID")
CaseCount
}
Start <- Sys.time()
selectCases("^427", test, MemberID,ICD,DateServiceStarted, 2) #2.97 secs (684105 obs)
End <- Sys.time()
End - Start
CaseICD
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
filter(ICDCount >= ICDNumber) %>% arrange(desc(ICDCount))
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
filter(ICDCount >= ICDNumber) %>% arrange(ID,desc(ICDCount))
CaseICD <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
filter(ICDCount >= ICDNumber) %>% arrange(ID,desc(ICDCount)) %>% slice(1)
CaseICD
DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(ICDCount = n()) %>%
filter(ICDCount >= ICDNumber) %>% arrange(ID,desc(ICDCount))
length(unique(DxDataFile$ID))
length(unique(DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD))%>%pull(ID)))
CaseICD <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(MostCommonICDCount = n()) %>%
arrange(ID,desc(MostCommonICDCount)) %>% slice(1)
CaseICD
Count <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = firstCaseDate >= minimumINRofDays & endCaseDate < maximumINRofDays) %>%
filter(ICDCount >= ICDNumber)
minimumINRofDays = 30
maximumINRofDays = 365
Count <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = firstCaseDate >= minimumINRofDays & endCaseDate < maximumINRofDays) %>%
filter(ICDCount >= ICDNumber)
Count
Count <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = firstCaseDate >= minimumINRofDays & endCaseDate < maximumINRofDays) %>%
filter(Count >= ICDNumber)
Count
Count <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = period >= minimumINRofDays & period < maximumINRofDays) %>%
filter(Count >= ICDNumber)
Count
Count <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = period >= minimumINRofDays & period < maximumINRofDays) %>%
filter(Count >= ICDNumber & InTimeINR ==TRUE)
Count
CaseICD <- DxDataFile %>%
arrange(ID,ICD,Date) %>%
filter(grepl(greplICD, ICD)) %>%
group_by(ID,ICD) %>%
summarise(MostCommonICDCount = n()) %>%
arrange(ID,desc(MostCommonICDCount)) %>% slice(1)
CaseICD
CaseCount <- right_join(Count,CaseICD,"ID")
CaseCount
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount
#' @param minimumINRofDays Minimum interval of Days, defaults is 30 days (one month)
#' @param maximumINRofDays Maximum interval of Days, defaults is 365 days (one year)
#' @export
#' @examples
#' DxDataFile <- data.frame(ID = c("A", "A", "A", "A"),
#'                          ICD = c("I072","I071", "I072", "I071"),
#'                          Date = as.Date(c("2016-03-31", "2016-01-29", "2016-02-10", "2018-03-10")),
#'                          stringsAsFactors = FALSE)
#' selectCases("^I0", DxDataFile, ID, ICD, Date, 2)
#'
DxDataFile <- test
names(DxDataFile) <- c("ID", "MostCommonICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
GrepICD <- DxDataFile %>%
arrange(ID,MostCommonICD,Date) %>%
filter(grepl(greplICD, MostCommonICD))
GrepICD <- DxDataFile %>%
arrange(ID,MostCommonICD,Date) %>%
filter(grepl(greplICD, MostCommonICD))
GrepICD
Count <- GrepICD %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = period >= minimumINRofDays & period < maximumINRofDays) %>%
filter(Count >= ICDNumber & InTimeINR ==TRUE) %>%
select (-InTimeINR)
Count
CaseICD <- GrepICD %>%
group_by(ID,ICD) %>%
summarise(MostCommonICDCount = n()) %>%
arrange(ID,desc(MostCommonICDCount)) %>% slice(1)
CaseICD <- GrepICD %>%
group_by(ID,MostCommonICD) %>%
summarise(MostCommonICDCount = n()) %>%
arrange(ID,desc(MostCommonICDCount)) %>% slice(1)
CaseICD
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount
selectCases <- function(greplICD, DxDataFile, idColName, icdColName, dateColName, ICDNumber, minimumINRofDays = 30, maximumINRofDays = 365){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "MostCommonICD", "Date")
DxDataFile$Date <- as.Date(DxDataFile$Date)
GrepICD <- DxDataFile %>%
arrange(ID,MostCommonICD,Date) %>%
filter(grepl(greplICD, MostCommonICD))
Count <- GrepICD %>%
group_by(ID) %>%
summarise(firstCaseDate = min(Date),
endCaseDate = max(Date),
period = endCaseDate - firstCaseDate,
Count = n(),
InTimeINR = period >= minimumINRofDays & period < maximumINRofDays) %>%
filter(Count >= ICDNumber & InTimeINR ==TRUE) %>%
select (-InTimeINR)
CaseICD <- GrepICD %>%
group_by(ID,MostCommonICD) %>%
summarise(MostCommonICDCount = n()) %>%
arrange(ID,desc(MostCommonICDCount)) %>% slice(1)
CaseCount <- left_join(Count,CaseICD,"ID")
CaseCount
}
Start <- Sys.time()
selectCases("^427", test, MemberID,ICD,DateServiceStarted, 2) #4.7 secs (684105 obs)
End <- Sys.time()
End - Start
setwd("~/emr")
pkgdown::build_site()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
pkgdown::build_site()
detach("package:dplyr", unload=TRUE)
detach("package:data.table", unload=TRUE)
devtools::document()
devtools::check()
