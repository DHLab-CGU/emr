, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
errorFile
errorFile
ICD <- head(errorFile[, c(1:5)],10)
errorFile
ICD
errorFile
errorFile <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
if(ICDVersion == "9" | ICDVersion == "10"){
version <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == version]
title <- paste0("Error ", version, ": Top 10")
Xlabel <- paste0("Error ", version)
}else if(ICDVersion != "9" && ICDVersion != "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(wrongICDType == "format" | wrongICDType == "version"){
wrongType <- paste0("Wrong ", wrongICDType)
if(exists("errorICD")){errorICD <- errorICD[WrongType == wrongType,]}
else{errorICD <- errorFile[WrongType == wrongType,]}
title <- paste0(title," (",wrongType,")")
}else if (wrongICDType != "format" && wrongICDType != "version" && wrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'wrongICDType'", call. = FALSE)
}
if(exists("errorICD")){
errorData <- errorICD
}
errorData
groupICD
if(groupICD){
if(version == "ICD 9"){
errorData_group <- errorFile[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,c("sumGroup","maxICD") := list(sum(count),max(count)), by = "ICDstart"][count == maxICD & order(sumGroup,decreasing = T),][!duplicated(ICDstart),][,c(cumsumCount) := cumsum(sumGroup),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),][,-"maxICD"]
errorData_group[,Number := 1:nrow(errorData_group),]
errorData_group$ICDstart <- factor(errorData_group$ICDstart)
g <- ggplot(as.data.frame(errorData_group), aes(x= reorder(ICDstart,-sumGroup) , y = sumGroup))
x_item <- scale_x_discrete(breaks = errorData_group$ICDstart)
Max <- errorData_group[,max(cumsumCount)]
y2wide <- nrow(errorData_group)
Xlabel <- paste0(Xlabel," (grouped)")
ICD <-  errorData_group[,c(1:5)]
}else{
stop("ICD 10 no group!!")
}
}else{
FileSize <- nrow(errorFile)
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][!duplicated(Number),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
ICD <- head(errorData[, c(1:5)],10)
if(!Others){
errorData <- head(errorData, 10)
}
errorData$ICD <- factor(errorData$ICD)
g <- ggplot(as.data.frame(errorData), aes(x= reorder(ICD,-count) , y = count))
x_item <- scale_x_discrete(breaks = errorData$ICD)
Max <- errorData[,max(cumsumCount)]
y2wide <- nrow(errorData)
# errorICDTop10 <- head(errorData, 10)
# errorICDTop10 <- errorICDTop10[,cumsumCount :=cumsum(count),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
# errorICDTop10 <- errorICDTop10[,Number :=1:nrow(errorICDTop10),]
# errorICDTop10$ICD <- factor(errorICDTop10$ICD)
}
Others <- FALSE
if(groupICD){
if(version == "ICD 9"){
errorData_group <- errorFile[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,c("sumGroup","maxICD") := list(sum(count),max(count)), by = "ICDstart"][count == maxICD & order(sumGroup,decreasing = T),][!duplicated(ICDstart),][,c(cumsumCount) := cumsum(sumGroup),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),][,-"maxICD"]
errorData_group[,Number := 1:nrow(errorData_group),]
errorData_group$ICDstart <- factor(errorData_group$ICDstart)
g <- ggplot(as.data.frame(errorData_group), aes(x= reorder(ICDstart,-sumGroup) , y = sumGroup))
x_item <- scale_x_discrete(breaks = errorData_group$ICDstart)
Max <- errorData_group[,max(cumsumCount)]
y2wide <- nrow(errorData_group)
Xlabel <- paste0(Xlabel," (grouped)")
ICD <-  errorData_group[,c(1:5)]
}else{
stop("ICD 10 no group!!")
}
}else{
FileSize <- nrow(errorFile)
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][!duplicated(Number),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
ICD <- head(errorData[, c(1:5)],10)
if(!Others){
errorData <- head(errorData, 10)
}
errorData$ICD <- factor(errorData$ICD)
g <- ggplot(as.data.frame(errorData), aes(x= reorder(ICD,-count) , y = count))
x_item <- scale_x_discrete(breaks = errorData$ICD)
Max <- errorData[,max(cumsumCount)]
y2wide <- nrow(errorData)
# errorICDTop10 <- head(errorData, 10)
# errorICDTop10 <- errorICDTop10[,cumsumCount :=cumsum(count),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
# errorICDTop10 <- errorICDTop10[,Number :=1:nrow(errorICDTop10),]
# errorICDTop10$ICD <- factor(errorICDTop10$ICD)
}
errorData
errorICDgraph <- g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8) +
geom_segment(x = Max + .55, xend = Max + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
ICDVersion
wrongICDType
#' @param ICDVersion ICD version
#' @param wrongICDType Wrong ICD type
#' @param groupICD wrong ICD start with: \code{'0'-'9'}, \code{'eng'} or \code{'all'}
#' @source \url{http://sape.inf.usi.ch/quick-reference/ggplot2/colour}
#' @export
#' @examples
#' head(sampleDxFile)
#' error <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
#' plot_errorICD(error, ICDVersion = all, wrongICDType = all, groupICD = FALSE)
#'
ICDVersion <- "all"
wrongICDType <- "all"
Others <- FALSE
errorFile <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
version <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == version]
title <- paste0("Error ", version, ": Top 10")
Xlabel <- paste0("Error ", version)
}else if(ICDVersion != "9" && ICDVersion != "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(wrongICDType == "format" | wrongICDType == "version"){
wrongType <- paste0("Wrong ", wrongICDType)
if(exists("errorICD")){errorICD <- errorICD[WrongType == wrongType,]}
else{errorICD <- errorFile[WrongType == wrongType,]}
title <- paste0(title," (",wrongType,")")
}else if (wrongICDType != "format" && wrongICDType != "version" && wrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'wrongICDType'", call. = FALSE)
}
if(exists("errorICD")){
errorData <- errorICD
}
if(groupICD){
if(version == "ICD 9"){
errorData_group <- errorFile[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,c("sumGroup","maxICD") := list(sum(count),max(count)), by = "ICDstart"][count == maxICD & order(sumGroup,decreasing = T),][!duplicated(ICDstart),][,c(cumsumCount) := cumsum(sumGroup),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),][,-"maxICD"]
errorData_group[,Number := 1:nrow(errorData_group),]
errorData_group$ICDstart <- factor(errorData_group$ICDstart)
g <- ggplot(as.data.frame(errorData_group), aes(x= reorder(ICDstart,-sumGroup) , y = sumGroup))
x_item <- scale_x_discrete(breaks = errorData_group$ICDstart)
Max <- errorData_group[,max(cumsumCount)]
y2wide <- nrow(errorData_group)
Xlabel <- paste0(Xlabel," (grouped)")
ICD <-  errorData_group[,c(1:5)]
}else{
stop("ICD 10 no group!!")
}
}else{
FileSize <- nrow(errorFile)
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][!duplicated(Number),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
ICD <- head(errorData[, c(1:5)],10)
if(!Others){
errorData <- head(errorData, 10)
}
errorData$ICD <- factor(errorData$ICD)
g <- ggplot(as.data.frame(errorData), aes(x= reorder(ICD,-count) , y = count))
x_item <- scale_x_discrete(breaks = errorData$ICD)
Max <- errorData[,max(cumsumCount)]
y2wide <- nrow(errorData)
# errorICDTop10 <- head(errorData, 10)
# errorICDTop10 <- errorICDTop10[,cumsumCount :=cumsum(count),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
# errorICDTop10 <- errorICDTop10[,Number :=1:nrow(errorICDTop10),]
# errorICDTop10$ICD <- factor(errorICDTop10$ICD)
}
errorICDgraph <- g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8) +
geom_segment(x = Max + .55, xend = Max + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorFile
errorData
errorData
errorFile
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][!duplicated(Number),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
errorData
errorData
ICD <- head(errorData[, c(1:5)],10)
errorData$ICD <- factor(errorData$ICD)
g <- ggplot(as.data.frame(errorData), aes(x= reorder(ICD,-count) , y = count))
x_item <- scale_x_discrete(breaks = errorData$ICD)
Max <- errorData[,max(cumsumCount)]
y2wide <- nrow(errorData)
errorICDgraph <- g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8) +
geom_segment(x = Max + .55, xend = Max + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorData
errorICD
errorData
errorFile
FileSize <- nrow(errorFile)
FileSize
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][!duplicated(Number),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
errorData
errorData
ICD <- head(errorData[, c(1:5)],10)
ICD
errorData$ICD <- factor(errorData$ICD)
g <- ggplot(as.data.frame(errorData), aes(x= reorder(ICD,-count) , y = count))
g
x_item <- scale_x_discrete(breaks = errorData$ICD)
x_item
cumsumCount
Max
y2wide
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE)
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white")
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8)
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8) +
geom_segment(x = Max + .55, xend = Max + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70")
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8) +
geom_segment(x = Max + .55, xend = Max + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title)
g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8) +
geom_segment(x = Max + .55, xend = Max + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
errorData
errorData
errorFile
errorFile <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
errorFile
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
version <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == version]
title <- paste0("Error ", version, ": Top 10")
Xlabel <- paste0("Error ", version)
}else if(ICDVersion != "9" && ICDVersion != "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(wrongICDType == "format" | wrongICDType == "version"){
wrongType <- paste0("Wrong ", wrongICDType)
if(exists("errorICD")){errorICD <- errorICD[WrongType == wrongType,]}
else{errorICD <- errorFile[WrongType == wrongType,]}
title <- paste0(title," (",wrongType,")")
}else if (wrongICDType != "format" && wrongICDType != "version" && wrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'wrongICDType'", call. = FALSE)
}
if(exists("errorICD")){
errorData <- errorICD
}
errorFile
if(ICDVersion == "9" | ICDVersion == "10"){
version <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == version]
title <- paste0("Error ", version, ": Top 10")
Xlabel <- paste0("Error ", version)
}else if(ICDVersion != "9" && ICDVersion != "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(wrongICDType == "format" | wrongICDType == "version"){
wrongType <- paste0("Wrong ", wrongICDType)
if(exists("errorICD")){errorICD <- errorICD[WrongType == wrongType,]}
else{errorICD <- errorFile[WrongType == wrongType,]}
title <- paste0(title," (",wrongType,")")
}else if (wrongICDType != "format" && wrongICDType != "version" && wrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'wrongICDType'", call. = FALSE)
}
if(exists("errorICD")){
errorData <- errorICD
}
if(groupICD){
if(version == "ICD 9"){
errorData_group <- errorFile[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,c("sumGroup","maxICD") := list(sum(count),max(count)), by = "ICDstart"][count == maxICD & order(sumGroup,decreasing = T),][!duplicated(ICDstart),][,c(cumsumCount) := cumsum(sumGroup),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),][,-"maxICD"]
errorData_group[,Number := 1:nrow(errorData_group),]
errorData_group$ICDstart <- factor(errorData_group$ICDstart)
g <- ggplot(as.data.frame(errorData_group), aes(x= reorder(ICDstart,-sumGroup) , y = sumGroup))
x_item <- scale_x_discrete(breaks = errorData_group$ICDstart)
Max <- errorData_group[,max(cumsumCount)]
y2wide <- nrow(errorData_group)
Xlabel <- paste0(Xlabel," (grouped)")
ICD <-  errorData_group[,c(1:5)]
}else{
stop("ICD 10 no group!!")
}
}else{
FileSize <- nrow(errorFile)
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][!duplicated(Number),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
ICD <- head(errorData[, c(1:5)],10)
if(!Others){
errorData <- head(errorData, 10)
}
errorData$ICD <- factor(errorData$ICD)
g <- ggplot(as.data.frame(errorData), aes(x= reorder(ICD,-count) , y = count))
x_item <- scale_x_discrete(breaks = errorData$ICD)
Max <- errorData[,max(cumsumCount)]
y2wide <- nrow(errorData)
# errorICDTop10 <- head(errorData, 10)
# errorICDTop10 <- errorICDTop10[,cumsumCount :=cumsum(count),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
# errorICDTop10 <- errorICDTop10[,Number :=1:nrow(errorICDTop10),]
# errorICDTop10$ICD <- factor(errorICDTop10$ICD)
}
View(errorData)
View(errorFile)
Others <- TRUE
View(errorFile)
errorFile <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
title <- "Error ICD: Top 10"
Xlabel <- "Error ICD"
if(ICDVersion == "9" | ICDVersion == "10"){
version <- paste0("ICD ", ICDVersion)
errorICD <- errorFile[IcdVersionInFile == version]
title <- paste0("Error ", version, ": Top 10")
Xlabel <- paste0("Error ", version)
}else if(ICDVersion != "9" && ICDVersion != "10" && ICDVersion != "all"){
stop("'please enter `9`,`10`, `all` for 'ICDVersion'", call. = FALSE)
}
if(wrongICDType == "format" | wrongICDType == "version"){
wrongType <- paste0("Wrong ", wrongICDType)
if(exists("errorICD")){errorICD <- errorICD[WrongType == wrongType,]}
else{errorICD <- errorFile[WrongType == wrongType,]}
title <- paste0(title," (",wrongType,")")
}else if (wrongICDType != "format" && wrongICDType != "version" && wrongICDType != "all"){
stop("'please enter `format`,`version`, `all` for 'wrongICDType'", call. = FALSE)
}
if(exists("errorICD")){
errorData <- errorICD
}
if(groupICD){
if(version == "ICD 9"){
errorData_group <- errorFile[,ICDstart := substr(ICD,1,1),][!grep("[0-9]|V|E",ICDstart),ICDstart := "Others"][,c("sumGroup","maxICD") := list(sum(count),max(count)), by = "ICDstart"][count == maxICD & order(sumGroup,decreasing = T),][!duplicated(ICDstart),][,c(cumsumCount) := cumsum(sumGroup),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),][,-"maxICD"]
errorData_group[,Number := 1:nrow(errorData_group),]
errorData_group$ICDstart <- factor(errorData_group$ICDstart)
g <- ggplot(as.data.frame(errorData_group), aes(x= reorder(ICDstart,-sumGroup) , y = sumGroup))
x_item <- scale_x_discrete(breaks = errorData_group$ICDstart)
Max <- errorData_group[,max(cumsumCount)]
y2wide <- nrow(errorData_group)
Xlabel <- paste0(Xlabel," (grouped)")
ICD <-  errorData_group[,c(1:5)]
}else{
stop("ICD 10 no group!!")
}
}else{
FileSize <- nrow(errorFile)
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][!duplicated(Number),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
ICD <- head(errorData[, c(1:5)],10)
if(!Others){
errorData <- head(errorData, 10)
}
errorData$ICD <- factor(errorData$ICD)
g <- ggplot(as.data.frame(errorData), aes(x= reorder(ICD,-count) , y = count))
x_item <- scale_x_discrete(breaks = errorData$ICD)
Max <- errorData[,max(cumsumCount)]
y2wide <- nrow(errorData)
# errorICDTop10 <- head(errorData, 10)
# errorICDTop10 <- errorICDTop10[,cumsumCount :=cumsum(count),][,cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
# errorICDTop10 <- errorICDTop10[,Number :=1:nrow(errorICDTop10),]
# errorICDTop10$ICD <- factor(errorICDTop10$ICD)
}
errorData
errorICDgraph
errorICDgraph <- g +
geom_bar(stat="identity", aes(fill = Number)) +
geom_line(aes(x= Number, y = cumsumCount, color = Number)) +
geom_point(aes(x= Number, y = cumsumCount, color = Number), pch = 10) +
x_item +
guides(fill = FALSE, color = FALSE) +
annotate("rect", xmin = y2wide + .55, xmax = y2wide + 1,
ymin = -.02 * Max, ymax = Max * 1.02, fill = "white") +
annotate("text", x = y2wide + .8, y = seq(0, Max, Max/10),
label = c("  0%", " 10%", " 20%", " 30%", " 40%", " 50%", " 60%", " 70%", " 80%", " 90%", "100%"),
size = 2.8) +
geom_segment(x = Max + .55, xend = Max + .55, y = -.02 * Max, yend = Max * 1.02, color = "gray70") +
xlab(Xlabel) + ylab("count") +
ggtitle(title) +
theme(axis.text.x = element_text(angle = 20))
errorICDgraph
errorData
errorFile
errorFile <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
errorFile
errorData <- errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count", "ICD") :=
list(11, max(cumsumCount), sum(count),"Others"),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
errorData
errorData
errorFile
errorFile <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
errorFile[,c("cumsumCount", "Number") :=
list(cumsum(count), 1:FileSize),][Number > 10,
c("Number", "cumsumCount", "count") :=
list(11, max(cumsumCount), sum(count)),][
, cumsumCountPerc := round(cumsumCount/max(cumsumCount)*100,2),]
errorFile
errorFile
errorFile <- IcdDxDecimalToShort(sampleDxFile, ICD, Date, "2015/10/01")$Error
errorFile
