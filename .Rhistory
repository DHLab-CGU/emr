CaseCount %>% select(InTimeINR=T)
CaseCount %>% select(InTimeINR==T)
CaseCount
CaseCount %>% filter(InTimeINR == T)
CaseCountInTimeINR <- CaseCount[CaseCount$InTimeINR,]
CaseCountInTimeINR
CaseCountInTimeINR <- CaseCount %>% filter(InTimeINR == T) %>%
group_by(ID, ICD) %>%
mutate(CaseNum = cumsum(InTimeINR)) %>%
filter(CaseNum >=ICDNumber) %>%
select(ID,ICD,Date)
ICDNumber <-2
CaseCountInTimeINR <- CaseCount %>% filter(InTimeINR == T) %>%
group_by(ID, ICD) %>%
mutate(CaseNum = cumsum(InTimeINR)) %>%
filter(CaseNum >=ICDNumber) %>%
select(ID,ICD,Date)
CaseCountInTimeINR
#' per patients in the inout factIcd dataset. Return MemberID
#'
#' @import dplyr
#' @param greplString ICD selection rules with grepl expression
#' @param DxDataFile ICD dataset with at least 3 columns: "MemberID", "Date", "ICD"
#' @param ICDNumber a threshold of number of ICD for case selection
#' @export
#' @examples
#' selectCasesToFactIcdList('255|256',sampleIcdData,2)
#'
selectCasesToFactIcdList <- function(greplString, DxDataFile, idColName, icdColName, dateColName, ICDNumber, minimumINRofDays = 30, maximumINRofDays = 365){
DxDataFile <- DxDataFile[, c(deparse(substitute(idColName)), deparse(substitute(icdColName)), deparse(substitute(dateColName)))]
names(DxDataFile) <- c("ID", "ICD", "Date")
CaseCount <- DxDataFile %>% filter(grepl(greplString, ICD)) %>%
arrange(ID, ICD, Date) %>%
group_by(ID,ICD) %>%
mutate(Gap = Date - lag(Date)) %>%
mutate(InTimeINR = Gap >= minimumINRofDays & Gap < maximumINRofDays)
CaseCount$InTimeINR[is.na(CaseCount$InTimeINR)] <- TRUE
CaseCountInTimeINR <- CaseCount %>% filter(InTimeINR == T) %>%
group_by(ID, ICD) %>%
mutate(CaseNum = cumsum(InTimeINR)) %>%
filter(CaseNum >=ICDNumber) %>%
select(ID,ICD,Date)
CaseCountInTimeINR
}
selectCasesToFactIcdList('^I0',DxDataFile,ID,ICD,Date,2,30,365)
selectCasesToFactIcdList('^I0',DxDataFile,ID,ICD,Date,2,30,365)
DxDataFile <- data.frame(ID = c("A", "A", "A", "A"),
ICD = c("I072","I071", "I072", "I071"),
Date = as.Date(c("2016-03-31", "2016-01-29", "2016-02-10", "2016-03-10")),
stringsAsFactors = FALSE)
selectCasesToFactIcdList('^I0',DxDataFile,ID,ICD,Date,2,30,365)
selectCasesToFactIcdList('^I0', DxDataFile, ID, ICD, Date, 2)#, 30, 365)
DxDataFile <- data.frame(ID = c("A", "A", "A", "A", "A"),
ICD = c("I172","I071", "I072", "I171", "I071"),
Date = as.Date(c("2016-03-31", "2016-01-29", "2016-02-10", "2016-03-10", "2018-03-10")),
stringsAsFactors = FALSE)
selectCasesToFactIcdList('^I0', DxDataFile, ID, ICD, Date, 2), 30, 365)
DxDataFile <- data.frame(ID = c("A", "A", "A", "A", "A"),
ICD = c("I072","I071", "I072", "I171", "I071"),
Date = as.Date(c("2016-03-31", "2016-01-29", "2016-02-10", "2016-03-10", "2018-03-10")),
stringsAsFactors = FALSE)
selectCasesToFactIcdList('^I0', DxDataFile, ID, ICD, Date, 2), 30, 365)
DxDataFile <- data.frame(ID = c("A", "A", "A", "A", "A"),
ICD = c("I172","I071", "I072", "I171", "I071"),
Date = as.Date(c("2016-03-31", "2016-01-29", "2016-02-10", "2016-03-10", "2018-03-10")),
stringsAsFactors = FALSE)
selectCasesToFactIcdList('^I0', DxDataFile, ID, ICD, Date, 2, 30, 365)
DxDataFile <- data.frame(ID = c("A", "A", "A", "A", "A"),
ICD = c("I072","I071", "I072", "I171", "I071"),
Date = as.Date(c("2016-03-31", "2016-01-29", "2016-02-10", "2016-03-10", "2018-03-10")),
stringsAsFactors = FALSE)
selectCasesToFactIcdList('^I0', DxDataFile, ID, ICD, Date, 2, 30, 365)
devtools::document()
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
groupingTable <- c("hemorrhage")
groupingICD <- c("^I00|^I01|^I02")
DxDataFile <- data.frame(ID = c("A", "A", "B", "B"),
ICD = c("I079","I61", "I020", "I012"),
Date = as.Date(c("2016-03-31", "2016-01-29", "2016-03-10", "2016-05-10")),
stringsAsFactors = FALSE)
lentgh(groupingTable)
length(groupingTable)
groupingTable <- c("hemorrhage","123")
length(groupingTable)
icdList <- DxDataFile$ICD
GrepTable <- data.frame(matrix(nrow = sum(grepl(groupingICD,icdList)), ncol = 2))
GrepTable
DxDataFile
GrepTable_combine
GrepTable_combine <- data.frame(matrix(0, nrow = length(icdList), ncol = length(groupingTable)+1))
names(GrepTable_combine) <- c("ICD", groupingTable)
GrepTable_combine$ICD <- icdList
GrepTable_combine
#' @export
#' @examples
#' DxDataFile <- data.frame(ID = c("A", "A", "B", "B"),
#'                          ICD = c("I079","I61", "I020", "I012"),
#'                          Date = as.Date(c("2016-03-31", "2016-01-29", "2016-03-10", "2016-05-10")),
#'                          stringsAsFactors = FALSE)
#' groupingTable <- c("hemorrhage")
#' groupingICD <- c("^I00|^I01|^I02")
#' groupIcdToGrep(DxDataFile$ICD, groupingTable, groupingICD)
#'
groupingTable <- c("hemorrhage", "Hypertensive")
groupingICD <- c("^I00|^I01|^I02", "^I10|^I11|^I12|^I13|^I15|^I16")
icdList <- DxDataFile$ICD
DxDataFile <- data.frame(ID = c("A", "A", "B", "B"),
ICD = c("I079","I11", "I020", "I012"),
Date = as.Date(c("2016-03-31", "2016-01-29", "2016-03-10", "2016-05-10")),
stringsAsFactors = FALSE)
icdList <- ICD = c("I079","I11", "I020", "I012")
icdList <- c("I079","I11", "I020", "I012")
GrepTable_combine <- data.frame(matrix(0, nrow = length(icdList), ncol = length(groupingTable)+1))
names(GrepTable_combine) <- c("ICD", groupingTable)
GrepTable_combine$ICD <- icdList
GrepTable_combine
rules <- 1
GrepTable <- data.frame(ICD = icdList[grepl(groupingICD[rules], icdList)],
Group = groupingTable[rules],
Value = 1,
stringsAsFactors = FALSE)
GrepTable
A <- data.frame(ICD = icdList[grepl(groupingICD[rules], icdList)],
Group = groupingTable[rules],
Value = 1,
stringsAsFactors = FALSE)
rules <- 2
B <- data.frame(ICD = icdList[grepl(groupingICD[rules], icdList)],
Group = groupingTable[rules],
Value = 1,
stringsAsFactors = FALSE)
GrepTable_combine <- full_join(A, B, by= c("ICD", "Group", "Value"))
GrepTable_combine
GrepTable_combine <- select(GrepTable_combine, -Value)
GrepTable_combine
GrepTable <- data.frame(matrix(0, nrow = length(icdList), ncol = length(groupingTable)+1))
names(GrepTable) <- c("ICD", groupingTable)
GrepTable$ICD <- icdList
GrepTable
GrepTable_combine
GrepTable_combine
GrepTable_combine <- full_join(A, B, by= c("ICD", "Group", "Value"))
GrepTable_combine
GrepTable_combine_wide <- GrepTable_combine %>%  dcast( ICD ~ Group, value.var = c("Value"))
GrepTable_combine_wide
is.na(GrepTable_combine_wide)
is.na(GrepTable_combine_wide) <- 0
GrepTable_combine_wide
full_join(A, GrepTable, by= c("ICD"))
full_join(GrepTable_combine_wide, GrepTable, by= c("ICD",groupingTable))
full_join(GrepTable_combine_wide, GrepTable, by= c("ICD",groupingTable)) %>% unique()
left_join(GrepTable_combine_wide, GrepTable, by= c("ICD",groupingTable)) %>% unique()
left_join(GrepTable_combine_wide, GrepTable, by= c("ICD",groupingTable))
devtools::document()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
citation("emr")
library("icd", lib.loc="~/R/win-library/3.4")
View(ccsDxICD10)
View(ccsDxICD9)
load("~/test/data/ccsICD9.rda")
load("~/test/data/ccsICD10.rda")
View(ccsICD10)
View(ccsICD9)
icd9Format<-ccsDxICD9$ICD
icd10Format<-ccsDxICD10$ICD
icd9Format<- mutate(Short = ccsDxICD9$ICD) %>% mutate(Decimal= 1)
icd9Format <- data.frame(Short = ccsDxICD9$ICD, Decimal = 1, stringsAsFactors = FALSE)
icd10Format <- data.frame(Short = ccsDxICD10$ICD, Decimal = 1, stringsAsFactors = FALSE)
icd10Format
icd9Format
count("123")
nchr("123")
nchar("123")
nchar("E538")
nchar("E53.8")
nchar("E53.8","char")
nchar(icd9Format$Short) <= 5
nchar(icd9Format$Short) < 5
icd9Format$Short[nchar(icd9Format$Short) < 5]
grepl("^E",icd9Format$Short)
icd9Format$Short[grepl("^E",icd9Format$Short)]
nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]<5)
nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]) <5
icd9Format$Short[nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]) < 5]
icd9Format$Short[grepl("^E",icd9Format$Short)]
nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]) < 5
icd9Format$Short[nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]) < 5]
icd9Format$Short[nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]) == 5]
test <-head(icd9Format$Short,10)
test
test <-head(icd9Format$Short[grepl("^E",icd9Format$Short)],10)
test
test <-head(icd9Format$Short[grepl("^E",icd9Format$Short)],20)
test
test <-head(icd9Format$Short[grepl("^E",icd9Format$Short)],50)
test
test <- icd9Format$Short[grepl("^E",icd9Format$Short)][50:60]
test
nchar(test) <5
test[nchar(test)] < 5
test(nchar(test)) < 5
test[nchar(test) < 5]
icd9Format$Short[grepl("^E",icd9Format$Short)][nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]) == 5]
icd9Format$Short[grepl("^E",icd9Format$Short)][nchar(icd9Format$Short[grepl("^E",icd9Format$Short)]) < 5]
icd_short_to_decimal("E903")
icd_short_to_decimal.icd9("E903")
icd9Format$Short[nchar(icd9Format$Short) < 5 & grepl("^E",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==4 & grepl("^E",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==3 & grepl("^E",icd9Format$Short)]
print("123")
if(any(grepl("^E",icd9Format$Short))){
print("123")
}
if(any(grepl("^E",icd9Format$Short) & icd9Format$Short[nchar(icd9Format$Short) <5)){
if(any(grepl("^E",icd9Format$Short) && icd9Format$Short[nchar(icd9Format$Short) <5)){
if(any(grepl("^E",icd9Format$Short)) && any(icd9Format$Short[nchar(icd9Format$Short) <5)){
if(any(grepl("^E",icd9Format$Short)) & any(icd9Format$Short[nchar(icd9Format$Short) <5)){
any(icd9Format$Short[nchar(icd9Format$Short) < 5
if(any(icd9Format$Short[nchar(icd9Format$Short) < 5 & grepl("^E",icd9Format$Short))){
if(any(icd9Format$Short[nchar(icd9Format$Short) < 5 & grepl("^E",icd9Format$Short)])){
print("123")
}
icd9Format$Short[nchar(icd9Format$Short) < 5 & grepl("^E",icd9Format$Short)]
if(any(grepl("^E", icd9Format$Short))){
print("123")
}
icd9Format$Short[nchar(icd9Format$Short) < 5
if(any(grepl("^E", icd9Format$Short))){
if([nchar(icd9Format$Short) < 5]){
print("123")
}
}
[nchar(icd9Format$Short) < 5]
if([nchar(icd9Format$Short) < 5]){
print("123")
}
nchar(icd9Format$Short) < 5
if(any(grepl("^E", icd9Format$Short))){
if(any(nchar(icd9Format$Short) < 5)){
print("123")
}
}
gsub("[0-9+]","yayaya",test)
gsub("[0-9+]","ya",test)
gsub("[0-9+]","Y",test)
gsub("[0-9+]","[0-9]{2}.[0-9]",test)
gsub("[0-9]+","[0-9]{2}.[0-9]",test)
gsub("[0-9]+","[0-9]{2}\\.[0-9]",test)
gsub("[0-9]+","[0-9]{2}\\.[0-9]+",test)
gsub("[0-9]+","+",test)
gsub("[0-9]{2}","+",test)
test
gsub("[0-9+]","+",test)
gsub("[0-9]{2}$",".",test)
strsplit(test, split = "E{1}[0-9]{2}")
test
gsub("[0-9]{2}$",".",test,fixed =T/)
strsplit(test, split = "E{1}[0-9]{2}", fixed = T)
substr(test, start =1,stop=3)
paste(substr(test, start =1,stop=3),".",substr(test, start =4,stop=5))
paste(substr(test, start =1,stop=3),".",substr(test, start =4,stop=5),sep="")
if(any(grepl("^E", icd9Format$Short))){
if(any(nchar(icd9Format$Short) == 5)){
icd9Format$Short <- paste(substr(icd9Format$Short, start =1,stop=3),
".",
substr(icd9Format$Short, start =4,stop=5),
sep="")
}
}
icd9Format
icd9Format <- data.frame(Short = ccsDxICD9$ICD, Decimal = 1, stringsAsFactors = FALSE)
icd9Format$Short[nchar(icd9Format$Short) <5 & grepl("^E",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)]
#icd9Format$Decimal <-
paste(substr(icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)], start =1,stop=3),".",substr(icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)], start =4,stop=5),sep="")
icd9Format$Decimal <- paste(substr(icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)], start =1,stop=3),".",substr(icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)], start =4,stop=5),sep="")
icd9Format$Decimal[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)] <- paste(substr(icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)], start =1,stop=3),".",substr(icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)], start =4,stop=5),sep="")
icd9Format
icd9Format$Decimal[nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) == 5 & grepl("^V",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) <5 & grepl("^V",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==3 & grepl("^V",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==4 & grepl("^V",icd9Format$Short)]
icd9Format$Decimal[icd9E]
#icd 9 E
icd9E <- nchar(icd9Format$Short) == 5 & grepl("^E",icd9Format$Short)
icd9Format$Decimal[icd9E]
icd_generate_decimal_format <- function( icd9or10Df, icdType,icdTypeLong)){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType,icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType], start = 1 ,stop = icdTypeLong-2),
".",
substr(icd9or10Df$Short[icdType], start = icdTypeLong - 1, stop = icdTypeLong),
sep="")
}
icd_generate_decimal_format <- function( icd9or10Df, icdType,icdTypeLong)){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType,icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType], start = 1 ,stop = icdTypeLong-2),
".",
substr(icd9or10Df$Short[icdType], start = icdTypeLong - 1, stop = icdTypeLong),
sep="")
}
icd_generate_decimal_format <- function( icd9or10Df, icdType,icdTypeLong)){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType,icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType], start = 1 ,stop = icdTypeLong-2),
".",
substr(icd9or10Df$Short[icdType], start = icdTypeLong - 1, stop = icdTypeLong),
sep="")
}
icd9or10Df <-icd9Format
icd_generate_decimal_format <- function( icd9or10Df, icdType,icdTypeLong)){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType,icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType], start = 1 ,stop = icdTypeLong-2),
".",
substr(icd9or10Df$Short[icdType], start = icdTypeLong - 1, stop = icdTypeLong),
sep="")
}
icd_generate_decimal_format <- function( icd9or10Df, icdType,icdTypeLong)){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType], start = 1 ,stop = icdTypeLong-2),
".",
substr(icd9or10Df$Short[icdType], start = icdTypeLong - 1, stop = icdTypeLong),
sep="")
icd9or10Df
}
icd9Format <- data.frame(Short = ccsDxICD9$ICD, Decimal = 1, stringsAsFactors = FALSE)
icd_generate_decimal_format(icd9Format,"^E",5)
icd_generate_decimal_format <- function( icd9or10Df, icdType,icdTypeLong)){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop = icdTypeLong - 2), ".",
substr(icd9or10Df$Short[icdType],
start = icdTypeLong - 1, stop = icdTypeLong), sep = "")
icd9or10Df
}
icd_generate_decimal_format(icd9Format,"^E",5)
icd9or10Df <-icd9Format
icdType <-"^E"
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icdType
icdNcharLong <- 5
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop = icdNcharLong - 2), ".",
substr(icd9or10Df$Short[icdType],
start = icdNcharLong - 1, stop = icdNcharLong), sep = "")
icd9or10Df
icdType
icd9or10Df$Decimal[icdType]
icd_generate_decimal_format <- function( icd9or10Df, icdType,icdNcharLong)){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop = icdNcharLong - 2), ".",
substr(icd9or10Df$Short[icdType],
start = icdNcharLong - 1, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop = icdNcharLong - 2), ".",
substr(icd9or10Df$Short[icdType],
start = icdNcharLong - 1, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
icd_generate_decimal_format(icd9Format, "^E", 5)
icd9Format
icd_generate_decimal_format(icd9Format, "^V", 4) #icd9-V
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  3), ".",
substr(icd9or10Df$Short[icdType],
start = icdNcharLong - 1, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
icd_generate_decimal_format(icd9Format, "^V", 4) #icd9-V
icd_generate_decimal_format(icd9Format, "^E", 5) #icd9-E
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  icdNcharLong - 1), ".",
substr(icd9or10Df$Short[icdType],
start = icdNcharLong - 1, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
icd_generate_decimal_format(icd9Format, "^E", 5) #icd9-E
substr(icd9or10Df$Short[icdType],
stop = icdNcharLong)
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == 5 & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  icdNcharLong - 1), ".",
substr(icd9or10Df$Short[icdType],
start= icdNcharLong, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
icd_generate_decimal_format(icd9Format, "^E", 5) #icd9-E
icd_generate_decimal_format(icd9Format, "^V", 4) #icd9-V
View(icd9Format)
icd9Format <- data.frame(Short = ccsDxICD9$ICD, Decimal = 1L, stringsAsFactors = FALSE)
icd10Format <- data.frame(Short = ccsDxICD10$ICD, Decimal = 1L, stringsAsFactors = FALSE)
icd9Format$Short[nchar(icd9Format$Short) ==4 & grepl("^V",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==5 & grepl("^V",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==5 & grepl("^E",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==4 & grepl("^E",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==3 & grepl("^E",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==3 & grepl("^V",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==4 & grepl("^V",icd9Format$Short)]
icd9Format$Short[nchar(icd9Format$Short) ==5 & grepl("^V",icd9Format$Short)]
icd_generate_decimal_format(icd9Format, "^V", 4) #icd9-V nchar: 3~5, only nchar ==4/5 has decimal format
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == icdType & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  icdNcharLong - 1), ".",
substr(icd9or10Df$Short[icdType],
start= icdNcharLong, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
icd_generate_decimal_format(icd9Format, "^V", 4) #icd9-V nchar: 3~5, only nchar ==4/5 has decimal format
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == icdNcharLong & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  icdNcharLong - 1), ".",
substr(icd9or10Df$Short[icdType],
start= icdNcharLong, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
icd_generate_decimal_format(icd9Format, "^V", 4) #icd9-V nchar: 3~5, only nchar ==4/5 has decimal format
icd_generate_decimal_format(icd9Format, "^V", 5) #icd9-V nchar: 3~5, only nchar ==4/5 has decimal format
# EXX
icd_generate_decimal_format(icd9Format, "^E", 5) #icd9-E nchar: 4~5, only nchar ==5 has decimal format
# VXX.X
icd_generate_decimal_format(icd9Format, "^V", 4) #icd9-V nchar: 3~5, only nchar ==4/5 has decimal format
# vXX.XX
icd_generate_decimal_format(icd9Format, "^V", 5) #icd9-V nchar: 3~5, only nchar ==4/5 has decimal format
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == icdNcharLong & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  3), ".",
substr(icd9or10Df$Short[icdType],
start= icdNcharLong, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
# vXX.XX
icd_generate_decimal_format(icd9Format, "^V", 5) #icd9-V nchar: 3~5, only nchar ==4/5 has decimal format
# EXXX.X
icd_generate_decimal_format(icd9Format, "^E", 5) #icd9-E nchar: 4~5, only nchar ==5 has decimal format
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == icdNcharLong & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  3), ".",
substr(icd9or10Df$Short[icdType],
start= icdNcharLong, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
# EXXX.X
icd_generate_decimal_format(icd9Format, "^E", 5) #icd9-E nchar: 4~5, only nchar ==5 has decimal format
icd_generate_decimal_format <- function( icd9or10Df, icdType, icdNcharLong){
icdType <- nchar(icd9or10Df$Short) == icdNcharLong & grepl(icdType, icd9or10Df$Short)
icd9or10Df$Decimal[icdType] <- paste(substr(icd9or10Df$Short[icdType],
start = 1 , stop =  4), ".",
substr(icd9or10Df$Short[icdType],
start= icdNcharLong, stop = icdNcharLong), sep = "")
icd9or10Df$Decimal[icdType]
}
# EXXX.X
icd_generate_decimal_format(icd9Format, "^E", 5) #icd9-E nchar: 4~5, only nchar ==5 has decimal format
if("^E" %in% "E"){
print("E")
}
if("^E" %in% "E"){
print("E")
}
if("EEE" %in% "E"){
print("E")
if("E" %in% "^E"){
print("E")
}
if("^E"== "^E"){
print("E")
}
if("^E"== "^E"){
print("E")
}
if("^E"== "^E"){
print("E")
}
"^E" == "^E"
if("E" == "E"){
print("E")
}
