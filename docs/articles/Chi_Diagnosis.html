<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with dxpr: Diagnosis (Chinese) • dxpr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started with dxpr: Diagnosis (Chinese)">
<meta property="og:description" content="dxpr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dxpr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DHLab-TSENG/emr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started with dxpr: Diagnosis (Chinese)</h1>
                        <h4 class="author">Hsiang-Ju, Chiu</h4>
            
            <h4 class="date">2020-08-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DHLab-TSENG/emr/blob/master/vignettes/Chi_Diagnosis.Rmd"><code>vignettes/Chi_Diagnosis.Rmd</code></a></small>
      <div class="hidden name"><code>Chi_Diagnosis.Rmd</code></div>

    </div>

    
    
<div class="section level1">
<h1>診斷前處理與整合方法</h1>
<pre><code><a href="https://rdrr.io/r/base/cat.html">cat(utils::packageDescription("dxpr")$Description)</a></code></pre>
<div class="section level3">
<h3>安裝套件</h3>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="co"># Install development version from GitHub</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/reexports.html">install_github</a></span>(<span class="st">"DHLab-TSENG/dxpr"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dxpr</span>)</pre></body></html></div>
</div>
<div id="icd-cm-code-" class="section level3">
<h3 class="hasAnchor">
<a href="#icd-cm-code-" class="anchor"></a>ICD-CM-CODE 格式對照</h3>
<p>本套件使用的診斷編碼依照CMS（Centers for Medicare &amp; Medicaid Services）所提供的診斷編碼做為標準依據，並依照WHO訂定的診斷編碼規則，分別產生 ICD-9-CM and ICD-10-CM 的兩種格式的表格: <code>ICD9DxwithTwoFormat 和 ICD10DxwithTwoFormat</code></p>
<p>供後續診斷編碼格式轉換的功能使用</p>
<p>ICD-9-CM</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Short</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ICD9DxwithTwoFormat</span>$<span class="no">Short</span>)
<span class="co">#&gt; [1] "E0000" "E0001" "E0002" "E0008" "E0009" "E0010"</span>

<span class="co"># Decimal</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ICD9DxwithTwoFormat</span>$<span class="no">Decimal</span>)
<span class="co">#&gt; [1] "E000.0" "E000.1" "E000.2" "E000.8" "E000.9" "E001.0"</span></pre></body></html></div>
<p>ICD-10-CM</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Short</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ICD10DxwithTwoFormat</span>$<span class="no">Short</span>)
<span class="co">#&gt; [1] "A001"  "A009"  "A0100" "A0101" "A0102" "A0103"</span>

<span class="co"># Decimal</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ICD10DxwithTwoFormat</span>$<span class="no">Decimal</span>)
<span class="co">#&gt; [1] "A00.1"  "A00.9"  "A01.00" "A01.01" "A01.02" "A01.03"</span></pre></body></html></div>
</div>
<div class="section level3">
<h3>範例資料</h3>
<p>以下功能介紹皆以<code>sampleDxFile</code>做為範例，共有38位病患，300筆診斷紀錄</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sampleDxFile</span>)
<span class="co">#&gt;     ID  ICD       Date</span>
<span class="co">#&gt; 1:  A2 Z992 2020-05-22</span>
<span class="co">#&gt; 2:  A5 Z992 2020-01-24</span>
<span class="co">#&gt; 3:  A8 Z992 2015-10-27</span>
<span class="co">#&gt; 4: A13 Z992 2020-04-26</span>
<span class="co">#&gt; 5: A13 Z992 2025-02-02</span>
<span class="co">#&gt; 6: A15 Z992 2023-05-12</span></pre></body></html></div>
</div>
<div id="i--code-standardization" class="section level2">
<h2 class="hasAnchor">
<a href="#i--code-standardization" class="anchor"></a>I. Code standardization</h2>
<p><strong>ICD-CM code兩種格式的轉換：Short &lt;-&gt; Decimal</strong></p>
<p>將醫療大數據中的診斷編碼進行編碼一致格式的轉換，以便後續診斷編碼的標準化分群。依據CCS（Clinical Classifications Software）、共病症（Comorbidity）及PheWAS的分組表中ICD診斷碼格式如<strong>表一</strong>。</p>
<p><strong>表一</strong> 標準化分組之診斷編碼格式</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th>ICD format</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Clinical Classifications Software</td>
<td>short format</td>
</tr>
<tr class="even">
<td>Comorbidity</td>
<td>short format</td>
</tr>
<tr class="odd">
<td>PheWAS</td>
<td>decimal format</td>
</tr>
</tbody>
</table>
<p>舉例來說，當使用者欲進行CCS的標準化分組，在分組前必須先將資料的診斷編碼統一轉換為<strong>short</strong>的格式</p>
<p>疾病分組時，為能區別疾病分類編碼版本ICD-9/ICD-10，本套件依據<strong>診斷日期</strong>區分編碼的版本，其時間切割點可依使用者需求設定。<br>
如使用者分析台灣的醫療資料，ICD-10使用日期設定為2016年1月1日；<br>
如使用者分析美國的醫療資料，ICD-10使用日期設定為2015年10月1日。</p>
<p>如範例，區分診斷編碼版本的日期為：2015年10月1日</p>
<p><strong>將 ICD-CM code 的格式統一轉成 Decimal</strong></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># Short to decimal</span>
<span class="no">decimal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxUniform.html">icdDxShortToDecimal</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                               <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                               <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                               <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015/10/01"</span>)
<span class="no">decimal</span>$<span class="no">ICD</span>[<span class="fl">6</span>:<span class="fl">10</span>]
<span class="co">#&gt;       ICD</span>
<span class="co">#&gt; 1:  Z99.2</span>
<span class="co">#&gt; 2:  585.5</span>
<span class="co">#&gt; 3: V45.11</span>
<span class="co">#&gt; 4:  V56.0</span>
<span class="co">#&gt; 5:  585.3</span></pre></body></html></div>
<p><strong>將 ICD-CM code 的格式統一轉成 Short</strong></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Decimal to short</span>
<span class="no">short</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxUniform.html">icdDxDecimalToShort</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                            <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                            <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                            <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015/10/01"</span>)
<span class="no">short</span>$<span class="no">ICD</span>[<span class="fl">6</span>:<span class="fl">10</span>]
<span class="co">#&gt;      ICD</span>
<span class="co">#&gt; 1:  Z992</span>
<span class="co">#&gt; 2:  5855</span>
<span class="co">#&gt; 3: V4511</span>
<span class="co">#&gt; 4:  V560</span>
<span class="co">#&gt; 5:  5853</span></pre></body></html></div>
<p><strong>warning message</strong></p>
<p>醫療數據的診斷編碼有可能誤植導致診斷編碼錯誤，而錯誤的診斷編碼將影響後續臨床疾病分組錯誤或是無法分組的情形。<br>
為方便使用者修改錯誤的診斷編碼，dxpr套件提供warning message提醒使用者錯誤的診斷編碼。</p>
<p>編碼錯誤的種類：<strong>格式錯誤 (wrong format)</strong>及<strong>版本分類錯誤 (wrong version)</strong></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">sample</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxUniform.html">icdDxShortToDecimal</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                              <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                              <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                              <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015/10/01"</span>)</pre></body></html></div>
<ol style="list-style-type: decimal">
<li>
<p>診斷編碼格式錯誤：共 9 種診斷編碼（括號內為該診斷編碼出現次數）</p>
<p>c(“A0.11 (20)”, “E114 (8)”, “Z9.90 (6)”, “F42 (6)”, “001 (5)”, “75.52 (4)”, “755.2 (3)”, “123.45 (3)”, “7552 (2)”)</p>
</li>
<li>
<p>診斷編碼版本錯誤：共 7 種診斷編碼（括號內為診斷編碼出現次數）</p>
<p>c(“V27.0 (18)”, “A01.05 (8)”, “42761 (7)”, “V24.1 (6)”, “A0105 (5)”, “E03.0 (4)”, “650 (4)”)</p>
</li>
</ol>
<p><code>sample$Error</code>會顯示資料中全部的錯誤，顯示錯誤的診斷編碼、出現次數、在檔案中編碼被判斷為何種版本、錯誤的類別及建議該如何修正</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">sample</span>$<span class="no">Error</span>
<span class="co">#&gt;        ICD count IcdVersionInFile     WrongType Suggestion</span>
<span class="co">#&gt;  1:  A0.11    20           ICD 10  Wrong format           </span>
<span class="co">#&gt;  2:  V27.0    18           ICD 10 Wrong version           </span>
<span class="co">#&gt;  3:   E114     8           ICD 10  Wrong format           </span>
<span class="co">#&gt;  4: A01.05     8            ICD 9 Wrong version           </span>
<span class="co">#&gt;  5:  42761     7           ICD 10 Wrong version           </span>
<span class="co">#&gt;  6:  Z9.90     6           ICD 10  Wrong format           </span>
<span class="co">#&gt;  7:    F42     6           ICD 10  Wrong format           </span>
<span class="co">#&gt;  8:  V24.1     6           ICD 10 Wrong version           </span>
<span class="co">#&gt;  9:  A0105     5            ICD 9 Wrong version           </span>
<span class="co">#&gt; 10:    001     5            ICD 9  Wrong format       0019</span>
<span class="co">#&gt; 11:  75.52     4            ICD 9  Wrong format           </span>
<span class="co">#&gt; 12:  E03.0     4            ICD 9 Wrong version           </span>
<span class="co">#&gt; 13:    650     4           ICD 10 Wrong version           </span>
<span class="co">#&gt; 14: 123.45     3           ICD 10  Wrong format           </span>
<span class="co">#&gt; 15:  755.2     3            ICD 9  Wrong format     755.29</span>
<span class="co">#&gt; 16:   7552     2            ICD 9  Wrong format      75529</span></pre></body></html></div>
<p>除了錯誤編碼表格供使用者了解錯誤的種類數量；本套件另提供圖表功能(<code>plot_errorICD</code>)供使用者觀察錯誤編碼的分布情形。</p>
<p><strong>Warning message判斷流程</strong></p>
<p>以下為判斷診斷編碼錯誤流程圖，以診斷編碼轉為 decimal 作為範例</p>
<p><img src="https://raw.githubusercontent.com/DHLab-TSENG/dhlab-tseng.github.io/master/dxpr/warning.jpg" style="display:block; margin:auto; width:100%;"></p>
<ul>
<li>將資料依照格式依診斷日期分為ICD-9及ICD-10兩部分<br>
</li>
<li>Step 1: 將資料分為short及decimal<br>
</li>
<li>Step 2: 第一次格式轉換及確認格式正確性<br>
short的組別: 依照診斷編碼版本分組進行<strong>第一次</strong>格式轉換<br>
&gt; ICD-9: C, E<br>
&gt; ICD-10: A<br>
decimal的組別: 依診斷編碼版本分組進行<strong>第一次</strong>確認格式正確性<br>
&gt; ICD-9: D<br>
&gt; ICD-10: B<br>
</li>
<li>Step 3: 挑出有NA的個案 (A, C, D, E)，進行<strong>第二次</strong>的格式轉換和確認正確性。<br>
&gt; A為ICD-10 code，因此將與<code>ICD9DxwithTwoFormat</code>進行<strong>第二次</strong>的確認及轉換<br>
&gt; C, D, E為ICD-9 code，因此將與<code>ICD10DxwithTwoFormat</code>進行<strong>第二次</strong>的確認及轉換</li>
</ul>
<p>若結果為<code>NA</code>，則表示該診斷編碼格式錯誤；反之則表示該診斷編碼版本錯誤</p>
<p>如圖<br>
A和C 轉換格式的結果不是NA，表示診斷編碼<strong>版本錯誤</strong>（42761應為ICD 9的診斷編碼，A0105應為ICD 10的診斷編碼）<br>
D和E 轉換格式的結果為NA，表示診斷編<strong>格式錯誤</strong> （應為755.2和001.9）</p>
</div>
<div id="ii--data-integration" class="section level2">
<h2 class="hasAnchor">
<a href="#ii--data-integration" class="anchor"></a>II. Data integration</h2>
<p>將分散的診斷編碼基於臨床意義整合成較大群組的疾病分組功能，以供後續分析使用。</p>
<p>目前套件提供四種標準化分組的種類，包括CCS階層式編碼轉換、PheWAS分群編碼、共病症（AHRQ、Charlson、Elixhauser Comorbidity）分組以及自定義診斷分組，以下將分別介紹之</p>
<p>經過四種標準化處理後，可得兩種回傳的結果</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>groupedDT</strong>：如<strong>表二</strong>，將診斷編碼依國際標準轉換為有臨床意義的疾病分組。groupedDT將顯示完整的分組結果，如範例為300筆資料，groupedDT就會顯示300筆</p>
<p>用途：計算疾病世代 （condition era）及選取合適的case組（selectCase）</p>
</li>
</ol>
<p><strong>表二</strong> 標準化分組後回傳的資料型態</p>
<table class="table">
<thead><tr class="header">
<th>Short/Decimal</th>
<th>ID</th>
<th>ICD</th>
<th>Date</th>
<th>GroupType</th>
</tr></thead>
<tbody><tr class="odd">
<td>ICD short/Decimal格式</td>
<td>病患編號</td>
<td>使用者輸入的診斷編碼</td>
<td>診斷日期</td>
<td>標準化分組組別</td>
</tr></tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>
<p><strong>summarised_groupedDT</strong>：如<strong>表三</strong>，將病患被歸類在同一個組別的多筆資料會統整成一筆資料。</p>
<p>用途：將其資料轉為適合進行統計分析之資料型態的寬表。</p>
</li>
</ol>
<p><strong>表三</strong> 標準化分組後回傳的長表資料型態</p>
<table class="table">
<thead><tr class="header">
<th>ID</th>
<th>GroupType</th>
<th>FirstCaseDate</th>
<th>EndCaseDate</th>
<th>Count</th>
<th>Period</th>
</tr></thead>
<tbody><tr class="odd">
<td>病患編號</td>
<td>標準化分組</td>
<td>第一筆資料時間</td>
<td>最後一筆資料時間</td>
<td>個數</td>
<td>第一筆資料與最後一筆資料相隔週期</td>
</tr></tbody>
</table>
<p>取診斷資料中最早診斷的時間為first case date，診斷資料中最後記錄的時間為end case date，並計算其週期（period）內相差的天數，以及週期內共有幾筆診斷紀錄（count）。</p>
<p>其中CCS單階層、多階層、PheWAS及Comorbidity的分組另可選擇為“分類”或“分類敘述” （<code>isDescription</code> = <code>TRUE</code> or <code>FALSE</code>）</p>
<p>舉例來說CCS = 1，其組別敘述為“Tuberculosis”；使用者可自行選擇呈現方式</p>
<p>###一、CCS 臨床分類軟體 美國Healthcare Cost and Utilization Project (HCUP)發展出一套診斷與處置的臨床分組標準CCS。基於此機制，將分散的診斷碼依照其臨床意義進行單層式或階層式的標準化診斷整合分類，其階層式診斷分類可依使用需求調整分類標準。</p>
<ul>
<li>單一階層：較通用的分類<br>
</li>
<li>多階層：將診斷碼分為較精確的分組</li>
</ul>
<p><strong>1) CCS單一階層分類</strong></p>
<p><code>icdDxToCCS</code> 可取得診斷編碼相對應的 CCS 分類 (CCS category) 及分類之敘述<br>
ICD-9-CM 和 ICD-10-CM 的 CCS 單一階層一致：共260種</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## ICD to CCS category's description </span>
<span class="no">CCS_description</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxCCS.html">icdDxToCCS</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                              <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                              <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                              <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                              <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                              <span class="kw">isDescription</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">CCS_description</span>$<span class="no">groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;    Short  ID  ICD       Date CCS_CATEGORY_DESCRIPTION</span>
<span class="co">#&gt; 1:  Z992  A2 Z992 2020-05-22   Chronic kidney disease</span>
<span class="co">#&gt; 2:  Z992  A5 Z992 2020-01-24   Chronic kidney disease</span>
<span class="co">#&gt; 3:  Z992  A8 Z992 2015-10-27   Chronic kidney disease</span>
<span class="co">#&gt; 4:  Z992 A13 Z992 2020-04-26   Chronic kidney disease</span>
<span class="co">#&gt; 5:  Z992 A13 Z992 2025-02-02   Chronic kidney disease</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">CCS_description</span>$<span class="no">summarised_groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID CCS_CATEGORY_DESCRIPTION firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0   Chronic kidney disease    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1   Chronic kidney disease    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10   Chronic kidney disease    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11   Chronic kidney disease    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A12   Chronic kidney disease    2006-05-14  2015-06-29     5 3333 days</span>

<span class="co">## ICD to CCS category</span>
<span class="no">CCS_category</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxCCS.html">icdDxToCCS</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                          <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                          <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                          <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                          <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                          <span class="kw">isDescription</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><strong>2) CCS多階層分類</strong></p>
<p><code>icdDxToCCSLvl</code> 可取得診斷編碼相對應的 CCS 多階層分類 (Multiple ccs level) 及分類之敘述</p>
<ul>
<li>ICD-9-CM 共 4 個階層 (Level 1~4)<br>
</li>
<li>ICD-10-CM 共 2 個階層 (Level 1~2)</li>
</ul>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co">## ICD to CCS multiple level 2 description</span>
<span class="no">CCSlvl_description</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxCCS.html">icdDxToCCSLvl</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                                    <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                    <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                                    <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                    <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                                    <span class="kw">CCSLevel</span> <span class="kw">=</span> <span class="fl">2</span>,
                                    <span class="kw">isDescription</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">CCSlvl_description</span>$<span class="no">groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;    Short  ID  ICD       Date                CCS_LVL_2_LABEL</span>
<span class="co">#&gt; 1:  Z992  A2 Z992 2020-05-22 Diseases of the urinary system</span>
<span class="co">#&gt; 2:  Z992  A5 Z992 2020-01-24 Diseases of the urinary system</span>
<span class="co">#&gt; 3:  Z992  A8 Z992 2015-10-27 Diseases of the urinary system</span>
<span class="co">#&gt; 4:  Z992 A13 Z992 2020-04-26 Diseases of the urinary system</span>
<span class="co">#&gt; 5:  Z992 A13 Z992 2025-02-02 Diseases of the urinary system</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">CCSlvl_description</span>$<span class="no">summarised_groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID                CCS_LVL_2_LABEL firstCaseDate endCaseDate count</span>
<span class="co">#&gt; 1:  A0 Diseases of the urinary system    2009-07-25  2013-12-20     5</span>
<span class="co">#&gt; 2:  A1 Diseases of the urinary system    2006-11-29  2014-09-24     5</span>
<span class="co">#&gt; 3: A10 Diseases of the urinary system    2007-11-04  2012-07-30     5</span>
<span class="co">#&gt; 4: A11 Diseases of the urinary system    2008-03-09  2011-09-03     5</span>
<span class="co">#&gt; 5: A12 Diseases of the urinary system    2006-05-14  2015-06-29     5</span>
<span class="co">#&gt;       period</span>
<span class="co">#&gt; 1: 1609 days</span>
<span class="co">#&gt; 2: 2856 days</span>
<span class="co">#&gt; 3: 1730 days</span>
<span class="co">#&gt; 4: 1273 days</span>
<span class="co">#&gt; 5: 3333 days</span>

<span class="co">## ICD to CCS multiple level 3 category</span>
<span class="no">CCSLvl_category</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxCCS.html">icdDxToCCSLvl</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                                    <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                    <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                                    <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                    <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                                    <span class="kw">CCSLevel</span> <span class="kw">=</span> <span class="fl">3</span>,
                                    <span class="kw">isDescription</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>###二、PheWAS 由 Vanderbilt University Medical Center 開發的 PheWAS 工具，將分散的診斷碼依照其臨床意義進行標準化分組，共1,866種的PheWAS分類，ICD-9-CM和PheWAS為多對多的配對關係。</p>
<p>最新版本為 version 2 (phecode_icd9_2)，目前只有 ICD-9-CM 供標準化分組</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co">## ICD to PheWAS</span>
<span class="no">PheWAS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxPheWAS.html">icdDxToPheWAS</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                         <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                         <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                         <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                         <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                         <span class="kw">isDescription</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">PheWAS</span>$<span class="no">groupedDT</span>[<span class="fl">7</span>:<span class="fl">11</span>]
<span class="co">#&gt;    Decimal ID   ICD       Date PheCode</span>
<span class="co">#&gt; 1:   585.5 A0  5855 2013-12-20  585.32</span>
<span class="co">#&gt; 2:  V45.11 A0 V4511 2012-04-05  585.31</span>
<span class="co">#&gt; 3:   V56.0 A0  V560 2010-03-28  585.31</span>
<span class="co">#&gt; 4:   585.3 A0  5853 2010-10-29  585.33</span>
<span class="co">#&gt; 5:   585.6 A0  5856 2009-07-25  585.32</span>

<span class="no">PheWAS</span>$<span class="no">summarised_groupedDT</span>[<span class="fl">7</span>:<span class="fl">11</span>]
<span class="co">#&gt;    ID PheCode firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1: A0  585.31    2010-03-28  2012-04-05     2  739 days</span>
<span class="co">#&gt; 2: A0  585.33    2010-10-29  2010-10-29     1    0 days</span>
<span class="co">#&gt; 3: A1  585.32    2006-11-29  2013-04-28     3 2342 days</span>
<span class="co">#&gt; 4: A1  585.33    2014-09-24  2014-09-24     1    0 days</span>
<span class="co">#&gt; 5: A1  585.31    2008-06-25  2008-06-25     1    0 days</span></pre></body></html></div>
<p>###三、自定義診斷碼分組</p>
<p>因應臨床研究需求，本套件採多樣的分組方式以維持診斷醫療大數據分析的彈性，提供進階使用者自行定義診斷分組類別及類別項目，使用者可選擇精確比對或是模糊比對的方式訂定篩選的分組類別及類別項目進行診斷碼的分群。</p>
<p>範例如下，使用者欲定義符合慢性腎臟疾病（Chronic kidney disease）的疾病編碼，相關診斷編碼如下：</p>
<ul>
<li>ICD-9：5851, 5852,…, 5859<br>
</li>
<li>ICD-10：N181, N182,…, N189</li>
</ul>
<p>自定義診斷分組提供兩種分組方法供使用者選擇，將符合條件的診斷編碼分組為心律異常的組別。</p>
<p><strong>1) icdDxToCustom</strong>：<strong>精確比對</strong></p>
<p>使用者須定義精確分組的表格 (groupingTable)，輸入詳細的診斷編碼 (N181, 5853, 5854…)， 進行分組的資料須要完全符合，才會歸類為Cardiac dysrhythmias，另外不符合條件的組別則顯示<code>NA</code>。</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># CustomGroupingTable </span>
<span class="no">groupingTable</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"Chronic kidney disease"</span>,<span class="fl">6</span>),
                            <span class="kw">ICD</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"N181"</span>,<span class="st">"5853"</span>,<span class="st">"5854"</span>,<span class="st">"5855"</span>,<span class="st">"5856"</span>,<span class="st">"5859"</span>),
                            <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">CustomGroup</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxCustom.html">icdDxToCustom</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                             <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                             <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                             <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                             <span class="kw">customGroupingTable</span> <span class="kw">=</span> <span class="no">groupingTable</span>)

<span class="no">CustomGroup</span>$<span class="no">groupedDT</span>[<span class="fl">10</span>:<span class="fl">14</span>]
<span class="co">#&gt;     ICD ID       Date                  Group</span>
<span class="co">#&gt; 1: 5853 A0 2010-10-29 Chronic kidney disease</span>
<span class="co">#&gt; 2: 5856 A0 2009-07-25 Chronic kidney disease</span>
<span class="co">#&gt; 3: 5856 A1 2006-11-29 Chronic kidney disease</span>
<span class="co">#&gt; 4: 5855 A1 2012-06-19 Chronic kidney disease</span>
<span class="co">#&gt; 5: 5855 A1 2013-04-28 Chronic kidney disease</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">CustomGroup</span>$<span class="no">summarised_groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID                  Group firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0 Chronic kidney disease    2009-07-25  2013-12-20     3 1609 days</span>
<span class="co">#&gt; 2:  A1 Chronic kidney disease    2006-11-29  2014-09-24     4 2856 days</span>
<span class="co">#&gt; 3: A10 Chronic kidney disease    2007-11-04  2007-11-04     1    0 days</span>
<span class="co">#&gt; 4: A11 Chronic kidney disease    2008-03-09  2010-02-21     2  714 days</span>
<span class="co">#&gt; 5: A12 Chronic kidney disease    2006-05-14  2011-02-25     3 1748 days</span></pre></body></html></div>
<p><strong>2) icdDxToCustomGrep</strong>：<strong>模糊比對</strong></p>
<p>使用者須定義模糊分組的表格 (grepTable)，以字串比對之正規表示式 (585* , N18*…)，當資料開頭為585* (ICD-9-CM) 或是N18* (ICD-10-CM) 即符合使用者定義之組別條件Cardiac dysrhythmias，另外不符合條件的組別則顯示<code>NA</code>。</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># CustomGroupingTable</span>
<span class="no">grepTable</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Group</span> <span class="kw">=</span> <span class="st">"Chronic kidney disease"</span>,
                        <span class="kw">grepIcd</span> <span class="kw">=</span> <span class="st">"^585|^N18"</span>,
                        <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">CustomGrepGroup</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxCustom.html">icdDxToCustomGrep</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                                     <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                     <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                                     <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                     <span class="kw">customGroupingTable</span> <span class="kw">=</span> <span class="no">grepTable</span>)

<span class="no">CustomGrepGroup</span>$<span class="no">groupedDT</span>[<span class="fl">10</span>:<span class="fl">14</span>]
<span class="co">#&gt;    ID  ICD       Date                  Group</span>
<span class="co">#&gt; 1: A0 5853 2010-10-29 Chronic kidney disease</span>
<span class="co">#&gt; 2: A0 5856 2009-07-25 Chronic kidney disease</span>
<span class="co">#&gt; 3: A1 5856 2006-11-29 Chronic kidney disease</span>
<span class="co">#&gt; 4: A1 5855 2012-06-19 Chronic kidney disease</span>
<span class="co">#&gt; 5: A1 5855 2013-04-28 Chronic kidney disease</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">CustomGrepGroup</span>$<span class="no">summarised_groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID                  Group firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0 Chronic kidney disease    2009-07-25  2013-12-20     3 1609 days</span>
<span class="co">#&gt; 2:  A1 Chronic kidney disease    2006-11-29  2014-09-24     4 2856 days</span>
<span class="co">#&gt; 3: A10 Chronic kidney disease    2007-11-04  2007-11-04     1    0 days</span>
<span class="co">#&gt; 4: A11 Chronic kidney disease    2008-03-09  2010-02-21     2  714 days</span>
<span class="co">#&gt; 5: A12 Chronic kidney disease    2006-05-14  2011-02-25     3 1748 days</span></pre></body></html></div>
<p>###四、共病症 共病症(Comorbidities)為病患於主診斷之外，其他已存在且會對主診斷疾病產生影響的疾病症狀，共病症分群基於診斷編碼進行標準化分組， 根據不同測量方法對共病症的定義分別介紹之：AHRQ、Charlson及Elixhauser</p>
<p><strong>1) Elixhauser</strong></p>
<p>Elixhauser Comorbidity為Dr. Elixhauser與其團隊在1998年提出基於標準ICD診斷碼的共病症分類分組標準，Elixhauser database共病症測量指標為HCUP 發展的共病症資料庫之一</p>
<p>ICD-9-CM 及 ICD-10-CM 的 Elixhauser 共病症種類一致，共 29 種</p>
<p>欲將診斷編碼依照 Elixhauser 共病症分類，在 function <code>icdDxToComorbid</code> 的<code>comorbidMethod</code> 輸入 <code>elix</code></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">ELIX</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxComorbid.html">icdDxToComorbid</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                        <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                        <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                        <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                        <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                        <span class="kw">comorbidMethod</span> <span class="kw">=</span> <span class="no">elix</span>)

<span class="no">ELIX</span>$<span class="no">groupedDT</span>[<span class="fl">160</span>:<span class="fl">164</span>]
<span class="co">#&gt;     Short ID    ICD       Date Comorbidity</span>
<span class="co">#&gt; 1: M06821 D1 M06821 2016-12-06        ARTH</span>
<span class="co">#&gt; 2:  K7291 D1  K7291 2024-04-04       LIVER</span>
<span class="co">#&gt; 3: O99353 D2 O99353 2023-10-23       NEURO</span>
<span class="co">#&gt; 4: F13230 D2 F13230 2022-09-15        DRUG</span>
<span class="co">#&gt; 5:  C8397 D2  C8397 2019-10-13       LYMPH</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ELIX</span>$<span class="no">summarised_groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID Comorbidity firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0    RENLFAIL    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1    RENLFAIL    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10    RENLFAIL    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11    RENLFAIL    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A12    RENLFAIL    2006-05-14  2015-06-29     5 3333 days</span></pre></body></html></div>
<p><strong>2) AHRQ</strong></p>
<p>於2017年基於Elixhauser Comorbidity 更進一步設計AHRQ Elixhauser Comorbidity Index，此index為單一的風險評估分數，可用於再入院與死亡的風險評估。</p>
<p>ICD-9-CM及 ICD-10-CM的AHRQ 共病症種類一致，共30種</p>
<p>欲將診斷編碼依照 AHRQ 共病症分類，在 function <code>icdDxToComorbid</code> 的 <code>comorbidMethod</code> 輸入 <code>AHRQ</code></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">AHRQ</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxComorbid.html">icdDxToComorbid</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                        <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                        <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                        <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                        <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                        <span class="kw">comorbidMethod</span> <span class="kw">=</span> <span class="no">AHRQ</span>)

<span class="no">AHRQ</span>$<span class="no">groupedDT</span>[<span class="fl">160</span>:<span class="fl">164</span>]
<span class="co">#&gt;     Short ID    ICD       Date Comorbidity</span>
<span class="co">#&gt; 1: M06821 D1 M06821 2016-12-06   Rheumatic</span>
<span class="co">#&gt; 2:  K7291 D1  K7291 2024-04-04       Liver</span>
<span class="co">#&gt; 3: O99353 D2 O99353 2023-10-23  NeuroOther</span>
<span class="co">#&gt; 4: F13230 D2 F13230 2022-09-15       Drugs</span>
<span class="co">#&gt; 5:  C8397 D2  C8397 2019-10-13    Lymphoma</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">AHRQ</span>$<span class="no">summarised_groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID Comorbidity firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0       Renal    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1       Renal    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10       Renal    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11       Renal    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A12       Renal    2006-05-14  2015-06-29     5 3333 days</span></pre></body></html></div>
<p><strong>3) Charlson</strong></p>
<p>Charlson database共病症測量指標的是基於Quan的Charlson Comorbidity Index版本，依診斷編碼其相關的共病症做分類</p>
<p>ICD-9-CM 及 ICD-10-CM 的 Charlson 共病症種類一致，共17種</p>
<p>欲將診斷編碼依照 Charlson 共病症分類，在 function <code>icdDxToComorbid</code> 的<code>comorbidMethod</code> 輸入 <code>Charlson</code></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">Charlson</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxComorbid.html">icdDxToComorbid</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                        <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                        <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                        <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                        <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                        <span class="kw">comorbidMethod</span> <span class="kw">=</span> <span class="no">charlson</span>)

<span class="no">Charlson</span>$<span class="no">groupedDT</span>[<span class="fl">160</span>:<span class="fl">164</span>]
<span class="co">#&gt;     Short ID    ICD       Date Comorbidity</span>
<span class="co">#&gt; 1: M06821 D1 M06821 2016-12-06       Rheum</span>
<span class="co">#&gt; 2:  K7291 D1  K7291 2024-04-04        MSLD</span>
<span class="co">#&gt; 3: O99353 D2 O99353 2023-10-23        &lt;NA&gt;</span>
<span class="co">#&gt; 4: F13230 D2 F13230 2022-09-15        &lt;NA&gt;</span>
<span class="co">#&gt; 5:  C8397 D2  C8397 2019-10-13      CANCER</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">Charlson</span>$<span class="no">summarised_groupedDT</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID Comorbidity firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0          RD    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1          RD    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10          RD    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11          RD    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A11      DIAB_C    2015-12-16  2015-12-16     1    0 days</span></pre></body></html></div>
<p>###五、篩選符合條件的個案 將醫療大數據診斷資訊進行標準化處理與整合後，將依據使用者所設立的條件篩選符合條件的個案。篩選個案的功能和疾病世代的概念類似，適用於一般疾病（限制搜尋範圍）或慢性病（沒有限制搜尋範圍）的計算。</p>
<p>為選取符合特定條件之診斷資料，目前有三種條件進行篩選：</p>
<ol style="list-style-type: decimal">
<li>
<p>設立篩選條件</p>
<p><code>groupDataType</code>：設定篩選的分組依據，可用CCS、PheWAS、comorbidity、自定義組別或診斷編碼</p>
<p><code>caseCondition</code>：設定篩選的方式為精確比對或模糊比對</p>
</li>
<li><p>設定搜尋範圍</p></li>
</ol>
<p>　　　<code>PeriodRange</code>：限制每筆診斷資料之間的間隔範圍，預設為間隔30天至365天時間內的資料 　　</p>
<ol start="3" style="list-style-type: decimal">
<li>ICD次數</li>
</ol>
<p>　　　<code>caseCount</code>：符合篩選方式的最小出現次數，預設至少出現兩次</p>
<p>最後回傳符合條件的個案資料如<strong>表四</strong>。</p>
<p><strong>表四</strong> 選取特定個案診斷紀錄後回傳的資料型態</p>
<table class="table">
<thead><tr class="header">
<th>ID</th>
<th>Count</th>
<th>FirstCaseDate</th>
<th>EndCaseDate</th>
<th>Period</th>
<th>MostCommonICD</th>
<th>MostCommonICDCount</th>
</tr></thead>
<tbody><tr class="odd">
<td>病患編碼</td>
<td>個數</td>
<td>第一筆資料時間</td>
<td>最後一筆資料時間</td>
<td>第一筆資料與最後一筆資料相隔週期</td>
<td>出現最多次數的診斷編碼</td>
<td>最常出現診斷編碼的次數</td>
</tr></tbody>
</table>
<p>符合條件的個案將整合為一筆資料，內容為符合條件的資料總數（count），第一筆診斷資料（first case date）及最後一筆資料時間（end case date）及資料時間相隔週期（period），出現最多次的ICD及次數（most common ICD 和 most common ICD count）。</p>
<p>符合篩選條件會在欄位<code>selectedCase</code>顯示“Selected”，使用者也可自行定義組別名稱 (在<code>selectCaseType</code>設定)<br>
以第一筆做說明，個案A0符合篩選條件的診斷資料共5筆，第一筆診斷日期為“2008-07-08”，最後一筆診斷紀錄為“2014-02-24”。其中V420出現次數最高，共三筆。整個診斷紀錄週期為2057天</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">Case</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/selectCases.html">selectCases</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                    <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                    <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                    <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                    <span class="kw">groupDataType</span> <span class="kw">=</span> <span class="no">ccslvl2</span>,
                    <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015/10/01"</span>,
                    <span class="kw">caseCondition</span> <span class="kw">=</span> <span class="st">"Diseases of the urinary system"</span>,
                    <span class="kw">caseCount</span> <span class="kw">=</span> <span class="fl">1</span>,
                    <span class="kw">caseName</span> <span class="kw">=</span> <span class="st">"Selected"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">Case</span>)
<span class="co">#&gt;     ID selectedCase count firstCaseDate endCaseDate    period</span>
<span class="co">#&gt; 1:  A3     Selected     5    2008-07-08  2014-02-24 2057 days</span>
<span class="co">#&gt; 2:  A1     Selected     5    2006-11-29  2014-09-24 2856 days</span>
<span class="co">#&gt; 3: A10     Selected     5    2007-11-04  2012-07-30 1730 days</span>
<span class="co">#&gt; 4: A12     Selected     5    2006-05-14  2015-06-29 3333 days</span>
<span class="co">#&gt; 5: A13     Selected     5    2006-04-29  2025-02-02 6854 days</span>
<span class="co">#&gt; 6: A15     Selected     5    2007-05-25  2023-05-12 5831 days</span>
<span class="co">#&gt;    MostCommonICD MostCommonICDCount</span>
<span class="co">#&gt; 1:          V420                  3</span>
<span class="co">#&gt; 2:          5855                  2</span>
<span class="co">#&gt; 3:         V5631                  2</span>
<span class="co">#&gt; 4:          5859                  2</span>
<span class="co">#&gt; 5:          5855                  2</span>
<span class="co">#&gt; 6:         V5631                  2</span></pre></body></html></div>
<p>###六、就診紀錄第一筆資料及最後一筆資料 取得病患的就診紀錄第一筆資料及最後一筆資料，可用來做為個案的指標日期供<code>splitDataByDate</code>使用</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">admissionDate</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/eligiblePeriod.html">getEligiblePeriod</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                                   <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                   <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">admissionDate</span>)
<span class="co">#&gt;     ID firstRecordDate endRecordDate</span>
<span class="co">#&gt; 1:  D6      2005-10-09    2025-01-05</span>
<span class="co">#&gt; 2: A12      2006-01-12    2022-06-12</span>
<span class="co">#&gt; 3:  D1      2006-02-12    2024-04-04</span>
<span class="co">#&gt; 4: A13      2006-04-29    2025-02-02</span>
<span class="co">#&gt; 5:  A9      2006-06-30    2023-12-10</span>
<span class="co">#&gt; 6:  D2      2006-09-01    2025-08-11</span></pre></body></html></div>
<p>###七、以事件（index date）區分事件前後的醫療紀錄 醫學研究常需要觀察特定事件發生前後的改變，因此需要一個指標時間（index date）來記錄事件的發生。TimeTag欄位可顯示此紀錄為事件前或是事件後（before and after），使用者可依此選擇事件發生前／後的資料</p>
<p>指標日期 (<code>indexDateTable</code>) 依指標日期根據個案個別定義。<br>
另外本套見也提供週期（window）計算功能，使用者可自行定義週期長度 (<code>windowGap</code>)，預設週期長度為30天。</p>
<p>舉例來說，個案A0之指標日期為2009/07/25。</p>
<p>個案A0的第一筆診斷資料時間為2009-07-25視為指標日期之後發生的紀錄，TimeTag為A (after)。兩筆資料間隔天數為0天，故為第1個週期；個案A0的第二筆診斷資料時間為2010-03-28視為指標日期後的紀錄，因此TimeTag為A。資料間隔天數為246天，故為第9個週期。</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">indexDateTable</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">ID</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A0"</span>,<span class="st">"B0"</span>,<span class="st">"C0"</span>,<span class="st">"D0"</span>),
                             <span class="kw">indexDate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2009-07-25"</span>, <span class="st">"2015-12-26"</span>,
                                           <span class="st">"2015-12-05"</span>, <span class="st">"2017-01-29"</span>),
                             <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">Data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dataSplit.html">splitDataByDate</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                        <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                        <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                        <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                        <span class="kw">indexDateFile</span> <span class="kw">=</span> <span class="no">indexDateTable</span>,
                        <span class="kw">gap</span> <span class="kw">=</span> <span class="fl">30</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">Data</span>, <span class="fl">5</span>)
<span class="co">#&gt;    ID   ICD       Date  indexDate timeTag window</span>
<span class="co">#&gt; 1: A0  5856 2009-07-25 2009-07-25       A      1</span>
<span class="co">#&gt; 2: A0  V560 2010-03-28 2009-07-25       A      9</span>
<span class="co">#&gt; 3: A0  5853 2010-10-29 2009-07-25       A     16</span>
<span class="co">#&gt; 4: A0 V4511 2012-04-05 2009-07-25       A     33</span>
<span class="co">#&gt; 5: A0  5855 2013-12-20 2009-07-25       A     54</span></pre></body></html></div>
<div id="--" class="section level3">
<h3 class="hasAnchor">
<a href="#--" class="anchor"></a>八. 疾病世代</h3>
<p>在診斷紀錄整合機制方面，Dr. Ryan提出疾病世代（Condition era）概念整合處理連續性的醫療行為， 將分散的醫療紀錄整合為單一病程發展紀錄，以利後續醫療大數據分析使用。</p>
<p>疾病世代的概念是針對疾病定義持續期（gap）長度，若診斷與診斷間間隔小於gap，則兩個診斷視為同一個疾病世代。<br>
疾病世代的診斷分類可選擇診斷編碼或四種標準化分組，計算病患之疾病世代，其持續期長度預設值為30天（<code>gapDate</code>）。</p>
<p>以範例的第一個結果做說明：個案A0被分組到CCS “158”共有5筆資料，第一筆診斷日期為“2009-07-25”和最後一筆診斷紀錄為“2013-12-20”，整個週期相差天數為1609天，共五個era (意指五筆診斷紀錄彼此相差天數都大於gap長度)。</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">Era</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/era.html">getConditionEra</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                       <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                       <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                       <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                       <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                       <span class="kw">gapDate</span> <span class="kw">=</span> <span class="fl">30</span>,
                       <span class="kw">groupDataType</span> <span class="kw">=</span> <span class="no">ccs</span>,
                       <span class="kw">isDescription</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">Era</span>)
<span class="co">#&gt;    ID CCS_CATEGORY era firstCaseDate endCaseDate count period</span>
<span class="co">#&gt; 1: A0          158   1    2009-07-25  2009-07-25     1 0 days</span>
<span class="co">#&gt; 2: A0          158   2    2010-03-28  2010-03-28     1 0 days</span>
<span class="co">#&gt; 3: A0          158   3    2010-10-29  2010-10-29     1 0 days</span>
<span class="co">#&gt; 4: A0          158   4    2012-04-05  2012-04-05     1 0 days</span>
<span class="co">#&gt; 5: A0          158   5    2013-12-20  2013-12-20     1 0 days</span>
<span class="co">#&gt; 6: A1          158   1    2006-11-29  2006-11-29     1 0 days</span></pre></body></html></div>
</div>
</div>
<div id="iii--eda-preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#iii--eda-preparation" class="anchor"></a>III. EDA preparation</h2>
<p>診斷碼整合分組後，為能進行後續的探索性資料分析，提供資料型態轉換的功能，以便進行統計分析之資料型態的寬表。</p>
<p>寬表提供兩種表示方式如<strong>表五、表六</strong>，以二分法（binary）或是數量（numeric）的方式呈現。當病患沒有相關的疾病診斷，二分法的表示法為false，反之，不論有幾筆疾病診斷紀錄，二分法的表示法為true；數量表示法則計算該病患在相關疾病的分組上有幾筆疾病診斷資料。（<code>numericOrBinary</code> = <code>N</code>或<code>B</code>）</p>
<p>以下範例以共病症 Elixhauser為範例進行兩種表示法回傳的資料型態</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co">#binary</span>

<span class="no">ELIX</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxComorbid.html">icdDxToComorbid</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                        <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                        <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                        <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                        <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                        <span class="kw">comorbidMethod</span> <span class="kw">=</span> <span class="no">elix</span>)

<span class="no">groupedData_Wide</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">ELIX</span>$<span class="no">groupedDT</span>,
                                          <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                          <span class="kw">categoryColName</span> <span class="kw">=</span> <span class="no">Comorbidity</span>,
                                          <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                          <span class="kw">reDup</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                          <span class="kw">numericOrBinary</span> <span class="kw">=</span> <span class="no">B</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">groupedData_Wide</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID  ARTH CHRNLUNG  DMCX  DRUG HRENWORF HTNPREG LIVER LYMPH NEURO OBESE</span>
<span class="co">#&gt; 1:  A0 FALSE    FALSE FALSE FALSE    FALSE   FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt; 2:  A1 FALSE    FALSE FALSE FALSE    FALSE   FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt; 3: A10 FALSE    FALSE FALSE FALSE    FALSE   FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt; 4: A11 FALSE    FALSE FALSE FALSE    FALSE   FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt; 5: A12 FALSE    FALSE FALSE FALSE    FALSE   FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt;     PARA PERIVASC PSYCH RENLFAIL TUMOR ULCER VALVE WGHTLOSS</span>
<span class="co">#&gt; 1: FALSE    FALSE FALSE     TRUE FALSE FALSE FALSE    FALSE</span>
<span class="co">#&gt; 2: FALSE    FALSE FALSE     TRUE FALSE FALSE FALSE    FALSE</span>
<span class="co">#&gt; 3: FALSE    FALSE FALSE     TRUE FALSE FALSE FALSE    FALSE</span>
<span class="co">#&gt; 4: FALSE    FALSE FALSE     TRUE FALSE FALSE FALSE    FALSE</span>
<span class="co">#&gt; 5: FALSE    FALSE FALSE     TRUE FALSE FALSE FALSE    FALSE</span></pre></body></html></div>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co"># numeric</span>

<span class="no">groupedData_Wide</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">ELIX</span>$<span class="no">groupedDT</span>,
                                          <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                          <span class="kw">categoryColName</span> <span class="kw">=</span> <span class="no">Comorbidity</span>,
                                          <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                          <span class="kw">reDup</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                          <span class="kw">numericOrBinary</span> <span class="kw">=</span> <span class="no">N</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">groupedData_Wide</span>, <span class="fl">5</span>)
<span class="co">#&gt;     ID ARTH CHRNLUNG DMCX DRUG HRENWORF HTNPREG LIVER LYMPH NEURO OBESE</span>
<span class="co">#&gt; 1:  A0    0        0    0    0        0       0     0     0     0     0</span>
<span class="co">#&gt; 2:  A1    0        0    0    0        0       0     0     0     0     0</span>
<span class="co">#&gt; 3: A10    0        0    0    0        0       0     0     0     0     0</span>
<span class="co">#&gt; 4: A11    0        0    0    0        0       0     0     0     0     0</span>
<span class="co">#&gt; 5: A12    0        0    0    0        0       0     0     0     0     0</span>
<span class="co">#&gt;    PARA PERIVASC PSYCH RENLFAIL TUMOR ULCER VALVE WGHTLOSS</span>
<span class="co">#&gt; 1:    0        0     0        5     0     0     0        0</span>
<span class="co">#&gt; 2:    0        0     0        5     0     0     0        0</span>
<span class="co">#&gt; 3:    0        0     0        5     0     0     0        0</span>
<span class="co">#&gt; 4:    0        0     0        5     0     0     0        0</span>
<span class="co">#&gt; 5:    0        0     0        5     0     0     0        0</span></pre></body></html></div>
</div>
<div id="iv--visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#iv--visualization" class="anchor"></a>IV. Visualization</h2>
<p>第四部份視覺化：套件將前述功能之結果整合，以圖表形式呈現</p>
<div id="pareto-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#pareto-plot" class="anchor"></a>Pareto plot：錯誤編碼之柏拉圖圖表</h3>
<p>進行第一階段－診斷編碼格式統一（Code standardization）時，將資料中的錯誤編碼訊息列表其數量轉換成圖表。<br>
以柏拉圖圖表(Pareto plot)的方式呈現，使用者可得知錯誤編碼的種類及出現比例，並依照錯誤數量依序排名。</p>
<p>如範例，欲觀察前十名的錯誤編碼種類及分布比例。<br>
範例使用步驟如下：</p>
<ul>
<li>
<code>errorFile</code>：診斷編碼進行統一格式轉換時產生的錯誤編碼<br>
</li>
<li>顯示診斷編碼的版本：顯示全部的編碼版本（<code>ICDVersion</code> = <code>9, 10 or all</code>）<br>
</li>
<li>顯示錯誤診斷編碼的種類：顯示全部的錯誤編碼種類（<code>wrongICDType</code> = <code>version,  format or all</code>）<br>
</li>
<li>預設為顯示前十名的錯誤編碼（<code>TopN</code> = <code>10</code>）</li>
<li>第10名以後的錯誤編碼設為＂others＂（<code>Others</code> = <code>TRUE</code>）</li>
</ul>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">error</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxUniform.html">icdDxDecimalToShort</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                            <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                            <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                            <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015/10/01"</span>)

<span class="no">Plot_error1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plotError.html">plotICDError</a></span>(<span class="kw">errorFile</span> <span class="kw">=</span> <span class="no">error</span>$<span class="no">Error</span>,
                            <span class="kw">icdVersion</span> <span class="kw">=</span> <span class="no">all</span>,
                            <span class="kw">wrongICDType</span> <span class="kw">=</span> <span class="no">all</span>,
                            <span class="kw">others</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="https://raw.githubusercontent.com/DHLab-TSENG/dxpr/master/docs/reference/plotError-2.png" style="display:block; margin:auto; width:70%;"> 上圖顯示前10名錯誤的診斷編碼，其餘名次的錯誤編碼則分類至“Others”<br>
第一名的錯誤<strong>A0.11</strong>共有20筆，佔全部錯誤18.35% (20/109)</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">Plot_error1</span>$<span class="no">ICD</span>
<span class="co">#&gt;        ICD count CumCountPerc IcdVersionInFile     WrongType Suggestion</span>
<span class="co">#&gt;  1:  A0.11    20       18.35%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  2:  V27.0    18       34.86%           ICD 10 Wrong version           </span>
<span class="co">#&gt;  3:   E114     8        42.2%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  4: A01.05     8       49.54%            ICD 9 Wrong version           </span>
<span class="co">#&gt;  5:  42761     7       55.96%           ICD 10 Wrong version           </span>
<span class="co">#&gt;  6:  Z9.90     6       61.47%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  7:    F42     6       66.97%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  8:  V24.1     6       72.48%           ICD 10 Wrong version           </span>
<span class="co">#&gt;  9:  A0105     5       77.06%            ICD 9 Wrong version           </span>
<span class="co">#&gt; 10:    001     5       81.65%            ICD 9  Wrong format       0019</span>
<span class="co">#&gt; 11: others    20         100%            ICD 9  Wrong format</span></pre></body></html></div>
<p>另外使用者可選擇將<strong>ICD-9</strong>依照章節<strong>分組</strong> (<code>groupICD = TRUE</code>)</p>
<p>ICD-9共19章節疾病分類：<br>
　001-139：傳染病或寄生蟲相關疾病<br>
　140-239：腫瘤相關疾病<br>
　…等。</p>
<p><code>plot_errorICD</code>依照編碼開頭分類，大致分為12組：0, 1, 2,…, 9, V and E</p>
<p>如範例，欲觀察前三名ICD9的錯誤編碼種類及分布比例。<br>
範例使用步驟如下：</p>
<ul>
<li>
<code>errorFile</code>：診斷編碼進行統一格式轉換時產生的錯誤編碼<br>
</li>
<li>顯示ICD9的錯誤編碼</li>
<li>顯示全部的錯誤編碼種類</li>
<li>依章節分組，只有ICD9有此功能</li>
<li>顯示前三名的錯誤編碼</li>
<li>第3名以後的錯誤編碼設為＂others＂</li>
</ul>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">Plot_error2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plotError.html">plotICDError</a></span>(<span class="kw">errorFile</span> <span class="kw">=</span> <span class="no">error</span>$<span class="no">Error</span>,
                             <span class="kw">icdVersion</span> <span class="kw">=</span> <span class="fl">9</span>,
                             <span class="kw">wrongICDType</span> <span class="kw">=</span> <span class="no">all</span>,
                             <span class="kw">groupICD</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                             <span class="kw">others</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                             <span class="kw">topN</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="https://raw.githubusercontent.com/DHLab-TSENG/dxpr/master/docs/reference/plotError-1.png" style="display:block; margin:auto; width:70%;"> 由下表格得知第一名的錯誤編碼為<strong>A01.05</strong>佔組別A共61.54%，總共有13筆錯誤，佔全部的錯誤的比例為41.94%</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">Plot_error2</span>$<span class="no">ICD</span>
<span class="co">#&gt;    ICDGroup groupCount CumCountPerc MostICDInGroup ICDPercInGroup     WrongType</span>
<span class="co">#&gt; 1:        A         13       41.94%         A01.05         61.54% Wrong version</span>
<span class="co">#&gt; 2:        7          9       70.97%          75.52         44.44%  Wrong format</span>
<span class="co">#&gt; 3:        0          5        87.1%            001           100%  Wrong format</span>
<span class="co">#&gt; 4:   Others          4         100%          E03.0           100% Wrong version</span></pre></body></html></div>
</div>
<div id="histogram-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#histogram-plot" class="anchor"></a>histogram plot：標準化分組之長條圖表</h3>
<p>進行第二和第三階段－轉換為探索性長表資料（EDA preparation），將長表資料圖形化，以便觀察診斷資料在各分群（如 comorbidity）的分布情形及數量。</p>
<p>使用者可選擇顯示前幾名的分組資料（Top N），且每個分群至少有一定比例的病患（limitPercentage）， 舉例來說，假設使用者的資料共1000個病患，每種組別至少要有10個病患（1%）。</p>
<p>預設顯示前十名，限制比例為1%（0.01）。</p>
<p>範例使用步驟如下：</p>
<ul>
<li>將資料以共病症Elixhauser做標準化分組並轉成寬表</li>
<li>設定作圖標準：顯示前幾名組別、限制比例</li>
</ul>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">ELIX</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxComorbid.html">icdDxToComorbid</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                        <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                        <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                        <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                        <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                        <span class="kw">comorbidMethod</span> <span class="kw">=</span> <span class="no">elix</span>)

<span class="no">groupedDataWide</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">ELIX</span>$<span class="no">groupedDT</span>,
                                          <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                          <span class="kw">categoryColName</span> <span class="kw">=</span> <span class="no">Comorbidity</span>,
                                          <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                          <span class="kw">reDup</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                          <span class="kw">numericOrBinary</span> <span class="kw">=</span> <span class="no">B</span>)

<span class="no">plot1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plotDiagCat.html">plotDiagCat</a></span>(<span class="kw">groupedDataWide</span> <span class="kw">=</span> <span class="no">groupedDataWide</span>,
                     <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                     <span class="kw">topN</span> <span class="kw">=</span> <span class="fl">10</span>,
                     <span class="kw">limitFreq</span> <span class="kw">=</span> <span class="fl">0.01</span>)</pre></body></html></div>
<p><img src="https://raw.githubusercontent.com/DHLab-TSENG/dxpr/master/docs/reference/PlotGroupedData-1.png" style="display:block; margin:auto; width:70%;"> 下表格為有符合條件設定的共病症前十名，每組分別有多少人，且該共病症在資料中的比例<br>
本範例共有38個病患，以第一組為例，共有24人被分為 RENLFAIL 共病症，比例為63.16% (24/38)</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">plot1</span>$<span class="no">sigCate</span>
<span class="co">#&gt;     DiagnosticCategory  N Percentage</span>
<span class="co">#&gt;  1:           RENLFAIL 24     63.16%</span>
<span class="co">#&gt;  2:              TUMOR  6     15.79%</span>
<span class="co">#&gt;  3:               ARTH  5     13.16%</span>
<span class="co">#&gt;  4:              LYMPH  4     10.53%</span>
<span class="co">#&gt;  5:              PSYCH  4     10.53%</span>
<span class="co">#&gt;  6:               DRUG  3      7.89%</span>
<span class="co">#&gt;  7:              NEURO  3      7.89%</span>
<span class="co">#&gt;  8:               PARA  2      5.26%</span>
<span class="co">#&gt;  9:           PERIVASC  2      5.26%</span>
<span class="co">#&gt; 10:              VALVE  2      5.26%</span></pre></body></html></div>
<p>若資料有進行病患分組case/control，於每個類別（如comorbidity）將進行兩組（case and control）的卡方獨立性檢定，圖表將顯示<strong>達統計上顯著差異</strong>的分組類別。<br>
若樣本數過小以致不適用卡方檢定時，則採用費雪爾精確檢定（Fisher’s Exact Test）</p>
<p>範例使用步驟如下：</p>
<ul>
<li>定義case/control組，採CCS多階層的標準化分組，在CCS level 2被分組為“Diseases of the urinary system” 視為case組，詳細設定條件請看<code>selectCases</code>範例<br>
</li>
<li>將資料以共病症Elixhauser做標準化分組並轉成寬表<br>
</li>
<li>設定作圖標準：顯示前幾名組別、限制比例、p value</li>
</ul>
<p>顯著差異p value預設門檻為0.05，預設顯示前十名的類別，且每群種類的病患在兩組的比率至少有一組達1%<br>
舉例來說，假設case和control組各500人，在某特定組別至少有一組的人數有5個病患 (1%)。</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">selectedCaseFile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/selectCases.html">selectCases</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                                <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                                <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015/10/01"</span>,
                                <span class="kw">groupDataType</span> <span class="kw">=</span> <span class="no">ccslvl2</span>,
                                <span class="kw">caseCondition</span> <span class="kw">=</span> <span class="st">"Diseases of the urinary system"</span>,
                                <span class="kw">caseCount</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="no">ELIX</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dxComorbid.html">icdDxToComorbid</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">sampleDxFile</span>,
                        <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                        <span class="kw">icdColName</span> <span class="kw">=</span> <span class="no">ICD</span>,
                        <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                        <span class="kw">icd10usingDate</span> <span class="kw">=</span> <span class="st">"2015-10-01"</span>,
                        <span class="kw">comorbidMethod</span> <span class="kw">=</span> <span class="no">elix</span>)

<span class="no">groupedData_Wide</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(<span class="kw">dxDataFile</span> <span class="kw">=</span> <span class="no">ELIX</span>$<span class="no">groupedDT</span>,
                                          <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                                          <span class="kw">categoryColName</span> <span class="kw">=</span> <span class="no">Comorbidity</span>,
                                          <span class="kw">dateColName</span> <span class="kw">=</span> <span class="no">Date</span>,
                                          <span class="kw">reDup</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                          <span class="kw">selectedCaseFile</span> <span class="kw">=</span> <span class="no">selectedCaseFile</span>)

<span class="no">plot2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plotDiagCat.html">plotDiagCat</a></span>(<span class="kw">groupedDataWide</span> <span class="kw">=</span> <span class="no">groupedData_Wide</span>,
                     <span class="kw">idColName</span> <span class="kw">=</span> <span class="no">ID</span>,
                     <span class="kw">topN</span> <span class="kw">=</span> <span class="fl">10</span>,
                     <span class="kw">limitFreq</span> <span class="kw">=</span> <span class="fl">0.01</span>,
                     <span class="kw">pvalue</span> <span class="kw">=</span> <span class="fl">0.05</span>)</pre></body></html></div>
<p><img src="https://raw.githubusercontent.com/DHLab-TSENG/dxpr/master/docs/reference/PlotGroupedData-2.png" style="display:block; margin:auto; width:70%;"> 下表格為在selected/nonSelected兩組間達顯著差異的共病症組別RENLFAIL<br>
在selected組佔了100% (24/24)，在nonSelected組佔了0% (0/14)</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">plot2</span>$<span class="no">sigCate</span>
<span class="co">#&gt;     DiagnosticCategory  N Percentage</span>
<span class="co">#&gt;  1:       selectedCase 38       100%</span>
<span class="co">#&gt;  2:           RENLFAIL 24     63.16%</span>
<span class="co">#&gt;  3:              TUMOR  6     15.79%</span>
<span class="co">#&gt;  4:               ARTH  5     13.16%</span>
<span class="co">#&gt;  5:              LYMPH  4     10.53%</span>
<span class="co">#&gt;  6:              PSYCH  4     10.53%</span>
<span class="co">#&gt;  7:               DRUG  3      7.89%</span>
<span class="co">#&gt;  8:              NEURO  3      7.89%</span>
<span class="co">#&gt;  9:           PERIVASC  2      5.26%</span>
<span class="co">#&gt; 10:              VALVE  2      5.26%</span></pre></body></html></div>
</div>
</div>
<div id="reference" class="section level2">
<h2 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h2>
<div id="i--code-standardization-1" class="section level3">
<h3 class="hasAnchor">
<a href="#i--code-standardization-1" class="anchor"></a>I. Code standardization</h3>
<p>ICD-9-CM code (2014): <a href="https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/codes.html" class="uri">https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/codes.html</a></p>
<p>ICD-10-CM code (2019): <a href="https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html" class="uri">https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html</a></p>
<p><a href="https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html" class="uri">https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html</a></p>
<p><a href="https://www.findacode.com/search/search.php" class="uri">https://www.findacode.com/search/search.php</a></p>
<p><a href="https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf" class="uri">https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf</a></p>
</div>
<div id="ii--data-integration-1" class="section level3">
<h3 class="hasAnchor">
<a href="#ii--data-integration-1" class="anchor"></a>II. Data integration</h3>
<p>本套件使用之CCS版本依照HCUP提供之最新版本進行年度的更新，目前ICD-9-CM與ICD-10-CM的CCS定義版本分別為2015年及2019年版。<br>
PheWAS依照PheWAS Resources網站 進行更新，目前版本為第二版（2015年）。<br>
Elixhauser共病症依照HCUP提供之版本進行更新，目前ICD-9-CM與ICD-10的Elixhauser共病症定義版本分別為2015年及2019年版。</p>
<p><strong>CCS (Clinical Classifications Software)</strong></p>
<p>ICD-9-CM (2015): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Single_Level_CCS_2015.zip" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Single_Level_CCS_2015.zip</a></p>
<p><a href="https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Multi_Level_CCS_2015.zip" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Multi_Level_CCS_2015.zip</a></p>
<p>ICD-10-CM (2019): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/ccs10/ccs_dx_icd10cm_2019_1.zip" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/ccs10/ccs_dx_icd10cm_2019_1.zip</a></p>
<p><strong>PheWAS</strong></p>
<p>ICD-9-Phecode (version 1.2, 2015): <a href="https://phewascatalog.org/phecodes" class="uri">https://phewascatalog.org/phecodes</a></p>
<p><strong>Comorbidities</strong></p>
<p>ICD-9-AHRQ (2012-2015): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references</a></p>
<p>ICD-10-AHRQ (2019): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt</a></p>
<p>ICD-9-Charlson: <a href="http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD9_E_Charlson.sas.txt" class="uri">http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD9_E_Charlson.sas.txt</a></p>
<p>ICD-10-Charlson: <a href="http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD10_Charlson.sas.txt" class="uri">http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD10_Charlson.sas.txt</a></p>
<p>ICD-9-Elixhauser (2012-2015): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references</a></p>
<p>ICD-10-Elixhauser (2019): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Hsiang-Ju Chiu, Yi-Ju Tseng.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
