<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with emr: Diagnosis • emr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started with emr: Diagnosis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">emr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Chi_Diagnosis.html">Get started with emr: Diagnosis (Chinese)</a>
    </li>
    <li>
      <a href="../articles/Chi_Procedure.html">Get started with emr: Procedure (Chinese)</a>
    </li>
    <li>
      <a href="../articles/Eng_Diagnosis.html">Get started with emr: Diagnosis</a>
    </li>
    <li>
      <a href="../articles/Eng_Procedure.html">Get started with emr: Procedure</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Get started with emr: Diagnosis</h1>
                        <h4 class="author">Hsiang-Ju, Chiu</h4>
            
            <h4 class="date">2019-08-28</h4>
      
      
      <div class="hidden name"><code>Eng_Diagnosis.Rmd</code></div>

    </div>

    
    
<div id="description" class="section level1">
<h1 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h1>
<pre><code><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat(utils::packageDescription("emr")$Description)</a></code></pre>
<div id="development-version" class="section level3">
<h3 class="hasAnchor">
<a href="#development-version" class="anchor"></a>Development version</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="co"># Install development version from GitHub</span>
devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"DHLab-CGU/emr"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(emr)</code></pre></div>
</div>
<div id="icd-cm-code-with-two-format" class="section level3">
<h3 class="hasAnchor">
<a href="#icd-cm-code-with-two-format" class="anchor"></a>ICD-CM code with two format</h3>
<p>There are two formats of ICD-9 and ICD-10 codes, decimal (with a decimal place separating the code) and short format.</p>
<p>ICD-9-CM</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Short</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ICD9DxwithTwoFormat<span class="op">$</span>Short)
<span class="co">#&gt; [1] "E0000" "E0001" "E0002" "E0008" "E0009" "E0010"</span>

<span class="co"># Decimal</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ICD9DxwithTwoFormat<span class="op">$</span>Decimal)
<span class="co">#&gt; [1] "E000.0" "E000.1" "E000.2" "E000.8" "E000.9" "E001.0"</span></code></pre></div>
<p>ICD-10-CM</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Short</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ICD10DxwithTwoFormat<span class="op">$</span>Short)
<span class="co">#&gt; [1] "A001"  "A009"  "A0100" "A0101" "A0102" "A0103"</span>

<span class="co"># Decimal</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ICD10DxwithTwoFormat<span class="op">$</span>Decimal)
<span class="co">#&gt; [1] "A00.1"  "A00.9"  "A01.00" "A01.01" "A01.02" "A01.03"</span></code></pre></div>
</div>
<div id="sample-file" class="section level3">
<h3 class="hasAnchor">
<a href="#sample-file" class="anchor"></a>Sample file</h3>
<p>An example of the data shows as below:<br>
This data is a simulated medical data set of 38 patients with 300 records.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(sampleDxFile)
<span class="co">#&gt;     ID  ICD       Date</span>
<span class="co">#&gt; 1:  A2 Z992 2020-05-22</span>
<span class="co">#&gt; 2:  A5 Z992 2020-01-24</span>
<span class="co">#&gt; 3:  A8 Z992 2015-10-27</span>
<span class="co">#&gt; 4: A13 Z992 2020-04-26</span>
<span class="co">#&gt; 5: A13 Z992 2025-02-02</span>
<span class="co">#&gt; 6: A15 Z992 2023-05-12</span></code></pre></div>
</div>
<div id="i-code-standardization" class="section level2">
<h2 class="hasAnchor">
<a href="#i-code-standardization" class="anchor"></a>I.Code standardization</h2>
<p><strong>ICD diagnostic code format transformation：Short &lt;-&gt; Decimal</strong></p>
<p>Standardize the ICD-9 and ICD-10 diagnostic codes into a uniform format before code classification.</p>
<p>Since the formats of ICD code used in the grouping tables could be different, the transformational type is according to the grouping method chosen by users.</p>
<p><strong>Table 1</strong> Format of code classification methods</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th>ICD format</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Clinical Classifications Software</td>
<td>short format</td>
</tr>
<tr class="even">
<td>Comorbidity</td>
<td>short format</td>
</tr>
<tr class="odd">
<td>PheWAS</td>
<td>decimal format</td>
</tr>
</tbody>
</table>
<p>To distinguish the version of ICD diagnostic code (ICD9/ICD10) in code standardization.<br>
User can set the using date of ICD10.</p>
<p>Reimbursement claims with a date required to use of ICD-10 codes (<code>icd10usingdate</code>)<br>
In America: October 1, 2015<br>
In Taiwan: January 1, 2016</p>
<p><strong>A. Uniform decimal format</strong></p>
<p>The standardization function converts the ICD diagnostic codes to a uniform decimal format and is used for grouping diagnostic code to PheWAS classification (<code>IcdDxToPheWAS</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Short to decimal</span>
decimal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxUniform.html">IcdDxShortToDecimal</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                               <span class="dt">icdColName =</span> ICD, 
                               <span class="dt">dateColName =</span> Date,
                               <span class="dt">icd10usingDate =</span> <span class="st">"2015/10/01"</span>)
decimal<span class="op">$</span>ICD[<span class="dv">6</span><span class="op">:</span><span class="dv">10</span>]
<span class="co">#&gt;       ICD</span>
<span class="co">#&gt; 1:  Z99.2</span>
<span class="co">#&gt; 2:  585.5</span>
<span class="co">#&gt; 3: V45.11</span>
<span class="co">#&gt; 4:  V56.0</span>
<span class="co">#&gt; 5:  585.3</span></code></pre></div>
<p><strong>B. Uniform short format</strong></p>
<p><code>IcdDxDecimalToShort</code> function converts the diagnostic codes to the short format, and used for grouping to the others classification (<code>IcdDxToCCS</code>, <code>IcdDxToCCSLvl</code>, and <code>IcdDxToComorbid</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Decimal to short</span>
short &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxUniform.html">IcdDxDecimalToShort</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                            <span class="dt">icdColName =</span> ICD,         
                            <span class="dt">dateColName =</span> Date,
                            <span class="dt">icd10usingDate =</span> <span class="st">"2015/10/01"</span>)
short<span class="op">$</span>ICD[<span class="dv">6</span><span class="op">:</span><span class="dv">10</span>]
<span class="co">#&gt;      ICD</span>
<span class="co">#&gt; 1:  Z992</span>
<span class="co">#&gt; 2:  5855</span>
<span class="co">#&gt; 3: V4511</span>
<span class="co">#&gt; 4:  V560</span>
<span class="co">#&gt; 5:  5853</span></code></pre></div>
<p><strong>Warning message</strong></p>
<p>Through code standardization functions generate data of diagnosis codes with potential error, to help a researcher identify the potential coding mistake that may affect clinical data analysis.</p>
<p>Error type：<strong>wrong format</strong> and <strong>wrong version</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxUniform.html">IcdDxShortToDecimal</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                              <span class="dt">icdColName =</span> ICD, 
                              <span class="dt">dateColName =</span> Date,
                              <span class="dt">icd10usingDate =</span> <span class="st">"2015/10/01"</span>)</code></pre></div>
<ol style="list-style-type: decimal">
<li>
<p>Wrong ICD format: total 9 ICD codes (the number of occurrences is in brackets)</p>
<p>c(“A0.11 (20)”, “E114 (8)”, “Z9.90 (6)”, “F42 (6)”, “001 (5)”, “75.52 (4)”, “755.2 (3)”, “123.45 (3)”, “7552 (2)”)</p>
</li>
<li>
<p>Wrong ICD version: total 7 ICD codes (the number of occurrences is in brackets)</p>
<p>c(“V27.0 (18)”, “A01.05 (8)”, “42761 (7)”, “V24.1 (6)”, “A0105 (5)”, “E03.0 (4)”, “650 (4)”)</p>
</li>
</ol>
<p><code>sample$Error</code> shows individual error ICD codes in descending order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample<span class="op">$</span>Error
<span class="co">#&gt;        ICD count IcdVersionInFile     WrongType Suggestion</span>
<span class="co">#&gt;  1:  A0.11    20           ICD 10  Wrong format           </span>
<span class="co">#&gt;  2:  V27.0    18           ICD 10 Wrong version           </span>
<span class="co">#&gt;  3:   E114     8           ICD 10  Wrong format           </span>
<span class="co">#&gt;  4: A01.05     8            ICD 9 Wrong version           </span>
<span class="co">#&gt;  5:  42761     7           ICD 10 Wrong version           </span>
<span class="co">#&gt;  6:  Z9.90     6           ICD 10  Wrong format           </span>
<span class="co">#&gt;  7:    F42     6           ICD 10  Wrong format           </span>
<span class="co">#&gt;  8:  V24.1     6           ICD 10 Wrong version           </span>
<span class="co">#&gt;  9:  A0105     5            ICD 9 Wrong version           </span>
<span class="co">#&gt; 10:    001     5            ICD 9  Wrong format       0019</span>
<span class="co">#&gt; 11:  75.52     4            ICD 9  Wrong format           </span>
<span class="co">#&gt; 12:  E03.0     4            ICD 9 Wrong version           </span>
<span class="co">#&gt; 13:    650     4           ICD 10 Wrong version           </span>
<span class="co">#&gt; 14: 123.45     3           ICD 10  Wrong format           </span>
<span class="co">#&gt; 15:  755.2     3            ICD 9  Wrong format     755.29</span>
<span class="co">#&gt; 16:   7552     2            ICD 9  Wrong format      75529</span></code></pre></div>
<p>The emr package also provides an overview of error ICD data by Pareto chart (<code>plot_errorICD</code>).</p>
<p><strong>Workflow of warning message</strong></p>
<p>The example of warning messages are shown as below by <code>IcdDxShortToDecimal</code>.</p>
<p><img src="https://raw.githubusercontent.com/DHLab-CGU/dhlab-cgu.github.io/master/emr/warning.jpg" style="display:block; margin:auto; width:100%;"></p>
<ul>
<li>Separate ICD-9 and ICD-10 by <code>icd10usingdate</code>
</li>
<li>Step 1: Separate short and decimal</li>
<li>Step 2: The first time convert and confirm<br>
Group short: <strong>first</strong> transformat into decimal format<br>
&gt; ICD-9: C, E<br>
&gt; ICD-10: A<br>
Group decimal: <strong>first</strong> transformat with correct decimal format<br>
&gt; ICD-9: D<br>
&gt; ICD-10: B<br>
</li>
<li>Step 3: The second time convert and confirm with patients who has NA (A, C, D, E)<br>
&gt; A has ICD-10 code, the second time convert and confirm with <code>ICD9DxwithTwoFormat</code><br>
&gt; C, D, E have ICD-9 code, the second time convert and confirm with <code>ICD10DxwithTwoFormat</code>
</li>
</ul>
<p>Result:<br>
Both A,C are <strong>wrong version</strong> (<em>42761</em> is ICD 9 diagnostic code and <em>A0105</em> is ICD 10 diagnostic code)<br>
Both D,E are <strong>wrong format</strong> (They should be <em>755.2</em> and <em>001.9</em>)</p>
</div>
<div id="ii--data-integration" class="section level2">
<h2 class="hasAnchor">
<a href="#ii--data-integration" class="anchor"></a>II. Data integration</h2>
<p>These functions collapse ICD codes into a smaller number of clinically meaningful categories that are more useful for presenting descriptive statistics than are individual ICD diagnostic codes.</p>
<p>The emr package supports four strategies to group EHR diagnosis codes, including CCS, PheWAS, comorbidities, and customized defined grouping methods.</p>
<p>There are two types of output of code classification.</p>
<ol style="list-style-type: decimal">
<li>Usage: Select cases and calculate condition era</li>
</ol>
<p><strong>Table 2</strong> groupedDT</p>
<table class="table">
<thead><tr class="header">
<th>Short/Decimal</th>
<th>ID</th>
<th>ICD</th>
<th>Date</th>
<th>GroupType</th>
</tr></thead>
<tbody><tr class="odd">
<td>ICD short/Decimal</td>
<td>patient ID</td>
<td>ICD</td>
<td>Admission date</td>
<td>group of code classification</td>
</tr></tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Usage: Convert the long format of grouped data into a wide format which is fit to others analytical and plotting packages.</li>
</ol>
<p><strong>Table 3</strong> summarised_groupedDT</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="17%">
<col width="19%">
<col width="19%">
<col width="17%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th>ID</th>
<th>GroupType</th>
<th>FirstCaseDate</th>
<th>EndCaseDate</th>
<th>Count</th>
<th>Period</th>
</tr></thead>
<tbody><tr class="odd">
<td>patient ICD</td>
<td>group of code classification</td>
<td>first admission date</td>
<td>last admission date</td>
<td>counts of period</td>
<td>record period</td>
</tr></tbody>
</table>
<p>User can choose the type of classification is “category” or “description” (<code>isDescription</code> = <code>TRUE</code> or <code>FALSE</code>)</p>
<p>For example, the ccs description is “Tuberculosis” when the category is “1”.</p>
<div id="a--clinical-classifications-software-ccs" class="section level3">
<h3 class="hasAnchor">
<a href="#a--clinical-classifications-software-ccs" class="anchor"></a>A. Clinical Classifications Software (CCS)</h3>
<p>The CCS classification for ICD-9 and ICD-10 codes is a diagnostic categorization scheme that can employ in many types of projects analyzing data on diagnoses.</p>
<p><strong>1) single-level</strong>: <code>IcdDxToCCS</code></p>
<p>ICD-9-CM and ICD-10-CM code contains same 260 CCS categories.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ICD to CCS category's description 
CCS_description &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxCCS.html">IcdDxToCCS</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                              <span class="dt">idColName =</span> ID,
                              <span class="dt">icdColName =</span> ICD,        
                              <span class="dt">dateColName =</span> Date,
                              <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                              <span class="dt">isDescription =</span> <span class="ot">TRUE</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(CCS_description<span class="op">$</span>groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;    Short  ID  ICD       Date CCS_CATEGORY_DESCRIPTION</span>
<span class="co">#&gt; 1:  Z992  A2 Z992 2020-05-22   Chronic kidney disease</span>
<span class="co">#&gt; 2:  Z992  A5 Z992 2020-01-24   Chronic kidney disease</span>
<span class="co">#&gt; 3:  Z992  A8 Z992 2015-10-27   Chronic kidney disease</span>
<span class="co">#&gt; 4:  Z992 A13 Z992 2020-04-26   Chronic kidney disease</span>
<span class="co">#&gt; 5:  Z992 A13 Z992 2025-02-02   Chronic kidney disease</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(CCS_description<span class="op">$</span>summarised_groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;     ID CCS_CATEGORY_DESCRIPTION firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0   Chronic kidney disease    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1   Chronic kidney disease    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10   Chronic kidney disease    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11   Chronic kidney disease    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A12   Chronic kidney disease    2006-05-14  2015-06-29     5 3333 days</span>

## ICD to CCS category
CCS_category &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxCCS.html">IcdDxToCCS</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile, 
                          <span class="dt">idColName =</span> ID,         
                          <span class="dt">icdColName =</span> ICD,       
                          <span class="dt">dateColName =</span> Date, 
                          <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                          <span class="dt">isDescription =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><strong>2) multi-level</strong>: <code>IcdDxToCCSLvl</code></p>
<p>ICD-9-CM has four levels, and ICD-10-CM has two levels</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ICD to CCS multiple level 2 description
CCSlvl_description &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxCCS.html">IcdDxToCCSLvl</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                                    <span class="dt">idColName =</span> ID,  
                                    <span class="dt">icdColName =</span> ICD,   
                                    <span class="dt">dateColName =</span> Date,
                                    <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                                    <span class="dt">CCSLevel =</span> <span class="dv">2</span>,
                                    <span class="dt">isDescription =</span> <span class="ot">TRUE</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(CCSlvl_description<span class="op">$</span>groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;    Short  ID  ICD       Date                CCS_LVL_2_LABEL</span>
<span class="co">#&gt; 1:  Z992  A2 Z992 2020-05-22 Diseases of the urinary system</span>
<span class="co">#&gt; 2:  Z992  A5 Z992 2020-01-24 Diseases of the urinary system</span>
<span class="co">#&gt; 3:  Z992  A8 Z992 2015-10-27 Diseases of the urinary system</span>
<span class="co">#&gt; 4:  Z992 A13 Z992 2020-04-26 Diseases of the urinary system</span>
<span class="co">#&gt; 5:  Z992 A13 Z992 2025-02-02 Diseases of the urinary system</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(CCSlvl_description<span class="op">$</span>summarised_groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;     ID                CCS_LVL_2_LABEL firstCaseDate endCaseDate count</span>
<span class="co">#&gt; 1:  A0 Diseases of the urinary system    2009-07-25  2013-12-20     5</span>
<span class="co">#&gt; 2:  A1 Diseases of the urinary system    2006-11-29  2014-09-24     5</span>
<span class="co">#&gt; 3: A10 Diseases of the urinary system    2007-11-04  2012-07-30     5</span>
<span class="co">#&gt; 4: A11 Diseases of the urinary system    2008-03-09  2011-09-03     5</span>
<span class="co">#&gt; 5: A12 Diseases of the urinary system    2006-05-14  2015-06-29     5</span>
<span class="co">#&gt;       period</span>
<span class="co">#&gt; 1: 1609 days</span>
<span class="co">#&gt; 2: 2856 days</span>
<span class="co">#&gt; 3: 1730 days</span>
<span class="co">#&gt; 4: 1273 days</span>
<span class="co">#&gt; 5: 3333 days</span>

## ICD to CCS multiple level 3 category
CCSLvl_category &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxCCS.html">IcdDxToCCSLvl</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                                    <span class="dt">idColName =</span> ID,  
                                    <span class="dt">icdColName =</span> ICD,   
                                    <span class="dt">dateColName =</span> Date,
                                    <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                                    <span class="dt">CCSLevel =</span> <span class="dv">3</span>,
                                    <span class="dt">isDescription =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="b--phewas" class="section level3">
<h3 class="hasAnchor">
<a href="#b--phewas" class="anchor"></a>B. PheWAS</h3>
<p>The emr package applied PheWAS, performing using a hierarchical grouping of ICD9 diagnostic codes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ICD to PheWAS
PheWAS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxPheWAS.html">IcdDxToPheWAS</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                         <span class="dt">idColName =</span> ID,           
                         <span class="dt">icdColName =</span> ICD,     
                         <span class="dt">dateColName =</span> Date,
                         <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                         <span class="dt">isDescription =</span> <span class="ot">FALSE</span>)

PheWAS<span class="op">$</span>groupedDT[<span class="dv">7</span><span class="op">:</span><span class="dv">11</span>]
<span class="co">#&gt;    Decimal ID   ICD       Date PheCode</span>
<span class="co">#&gt; 1:   585.5 A0  5855 2013-12-20  585.32</span>
<span class="co">#&gt; 2:  V45.11 A0 V4511 2012-04-05  585.31</span>
<span class="co">#&gt; 3:   V56.0 A0  V560 2010-03-28  585.31</span>
<span class="co">#&gt; 4:   585.3 A0  5853 2010-10-29  585.33</span>
<span class="co">#&gt; 5:   585.6 A0  5856 2009-07-25  585.32</span>

PheWAS<span class="op">$</span>summarised_groupedDT[<span class="dv">7</span><span class="op">:</span><span class="dv">11</span>]
<span class="co">#&gt;    ID PheCode firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1: A2  585.32    2011-09-20  2015-01-06     3 1204 days</span>
<span class="co">#&gt; 2: A2  585.31    2015-08-12  2015-08-12     1    0 days</span>
<span class="co">#&gt; 3: A3  585.34    2014-02-24  2014-02-24     1    0 days</span>
<span class="co">#&gt; 4: A3  585.32    2010-11-12  2010-11-12     1    0 days</span>
<span class="co">#&gt; 5: A3     587    2008-07-08  2013-01-31     3 1668 days</span></code></pre></div>
</div>
<div id="c--customize-group-method" class="section level3">
<h3 class="hasAnchor">
<a href="#c--customize-group-method" class="anchor"></a>C. Customize group method</h3>
<p>The emr package provided customized grouping functions, which researches can define the grouping categories and therefore have more flexible for grouping ICD diagnostic codes.</p>
<p>For example, researcher can convert an existing dataset into a grouped <strong>chronic kidney disease</strong> dataset in patients, and declare a customized grouping table for chronic kidney disease.<br>
There are two functions for customized defined grouping method, the customized category grouping is based on precise and fuzzy grouping method, respectively.</p>
<p><strong>1) Precise method</strong>: IcdDxToCustom</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># CustomGroupingTable </span>
groupingTable &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">Group =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"Chronic kidney disease"</span>,<span class="dv">6</span>),
                            <span class="dt">ICD =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"N181"</span>,<span class="st">"5853"</span>,<span class="st">"5854"</span>,<span class="st">"5855"</span>,<span class="st">"5856"</span>,<span class="st">"5859"</span>),
                            <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

CustomGroup &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxCustom.html">IcdDxToCustom</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,  
                             <span class="dt">idColName =</span> ID,         
                             <span class="dt">icdColName =</span> ICD,  
                             <span class="dt">dateColName =</span> Date,
                             <span class="dt">CustomGroupingTable =</span> groupingTable)

CustomGroup<span class="op">$</span>groupedDT[<span class="dv">10</span><span class="op">:</span><span class="dv">14</span>]
<span class="co">#&gt;     ICD ID       Date                  Group</span>
<span class="co">#&gt; 1: 5853 A0 2010-10-29 Chronic kidney disease</span>
<span class="co">#&gt; 2: 5856 A0 2009-07-25 Chronic kidney disease</span>
<span class="co">#&gt; 3: 5856 A1 2006-11-29 Chronic kidney disease</span>
<span class="co">#&gt; 4: 5855 A1 2012-06-19 Chronic kidney disease</span>
<span class="co">#&gt; 5: 5855 A1 2013-04-28 Chronic kidney disease</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(CustomGroup<span class="op">$</span>summarised_groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;     ID                  Group firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0 Chronic kidney disease    2009-07-25  2013-12-20     3 1609 days</span>
<span class="co">#&gt; 2:  A1 Chronic kidney disease    2006-11-29  2014-09-24     4 2856 days</span>
<span class="co">#&gt; 3: A10 Chronic kidney disease    2007-11-04  2007-11-04     1    0 days</span>
<span class="co">#&gt; 4: A11 Chronic kidney disease    2008-03-09  2010-02-21     2  714 days</span>
<span class="co">#&gt; 5: A12 Chronic kidney disease    2006-05-14  2011-02-25     3 1748 days</span></code></pre></div>
<p><strong>2) Fuzzy method</strong>: IcdDxToCustomGrep</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># CustomGroupingTable</span>
grepTable &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">Group =</span> <span class="st">"Chronic kidney disease"</span>,
                        <span class="dt">grepIcd =</span> <span class="st">"^585|^N18"</span>,
                        <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

CustomGrepGroup &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxCustom.html">IcdDxToCustomGrep</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile, 
                                    <span class="dt">idColName =</span> ID,            
                                    <span class="dt">icdColName =</span> ICD,   
                                    <span class="dt">dateColName =</span> Date,
                                    <span class="dt">CustomGroupingTable =</span> grepTable)

CustomGrepGroup<span class="op">$</span>groupedDT[<span class="dv">10</span><span class="op">:</span><span class="dv">14</span>]
<span class="co">#&gt;    ID  ICD       Date                  Group</span>
<span class="co">#&gt; 1: A0 5853 2010-10-29 Chronic kidney disease</span>
<span class="co">#&gt; 2: A0 5856 2009-07-25 Chronic kidney disease</span>
<span class="co">#&gt; 3: A1 5856 2006-11-29 Chronic kidney disease</span>
<span class="co">#&gt; 4: A1 5855 2012-06-19 Chronic kidney disease</span>
<span class="co">#&gt; 5: A1 5855 2013-04-28 Chronic kidney disease</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(CustomGrepGroup<span class="op">$</span>summarised_groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;     ID                  Group firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0 Chronic kidney disease    2009-07-25  2013-12-20     3 1609 days</span>
<span class="co">#&gt; 2:  A1 Chronic kidney disease    2006-11-29  2014-09-24     4 2856 days</span>
<span class="co">#&gt; 3: A10 Chronic kidney disease    2007-11-04  2007-11-04     1    0 days</span>
<span class="co">#&gt; 4: A11 Chronic kidney disease    2008-03-09  2010-02-21     2  714 days</span>
<span class="co">#&gt; 5: A12 Chronic kidney disease    2006-05-14  2011-02-25     3 1748 days</span></code></pre></div>
</div>
<div id="d--comorbidities" class="section level3">
<h3 class="hasAnchor">
<a href="#d--comorbidities" class="anchor"></a>D. Comorbidities</h3>
<p>The emr package provides three grouping methods of comorbidity as below:</p>
<p><strong>1) AHRQ</strong> AHRQ comorbidity measure dataset is based on Elixhauser Comorbidity Index</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AHRQ &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxComorbid.html">IcdDxToComorbid</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                        <span class="dt">idColName =</span> ID,           
                        <span class="dt">icdColName =</span> ICD,       
                        <span class="dt">dateColName =</span> Date,
                        <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                        <span class="dt">comorbidMethod =</span> AHRQ)

AHRQ<span class="op">$</span>groupedDT[<span class="dv">160</span><span class="op">:</span><span class="dv">164</span>]
<span class="co">#&gt;     Short ID    ICD       Date Comorbidity</span>
<span class="co">#&gt; 1: M06821 D1 M06821 2016-12-06   Rheumatic</span>
<span class="co">#&gt; 2:  K7291 D1  K7291 2024-04-04       Liver</span>
<span class="co">#&gt; 3: O99353 D2 O99353 2023-10-23  NeuroOther</span>
<span class="co">#&gt; 4: F13230 D2 F13230 2022-09-15       Drugs</span>
<span class="co">#&gt; 5:  C8397 D2  C8397 2019-10-13    Lymphoma</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(AHRQ<span class="op">$</span>summarised_groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;     ID Comorbidity firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0       Renal    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1       Renal    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10       Renal    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11       Renal    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A12       Renal    2006-05-14  2015-06-29     5 3333 days</span></code></pre></div>
<p><strong>2) Charlson</strong> Charlson comorbidity measure dataset is based on Quan’s translations of the Charlson Comorbidity Index</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Charlson &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxComorbid.html">IcdDxToComorbid</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                        <span class="dt">idColName =</span> ID,           
                        <span class="dt">icdColName =</span> ICD,       
                        <span class="dt">dateColName =</span> Date,
                        <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                        <span class="dt">comorbidMethod =</span> charlson)

Charlson<span class="op">$</span>groupedDT[<span class="dv">160</span><span class="op">:</span><span class="dv">164</span>]
<span class="co">#&gt;     Short ID    ICD       Date Comorbidity</span>
<span class="co">#&gt; 1: M06821 D1 M06821 2016-12-06       Rheum</span>
<span class="co">#&gt; 2:  K7291 D1  K7291 2024-04-04        MSLD</span>
<span class="co">#&gt; 3: O99353 D2 O99353 2023-10-23        &lt;NA&gt;</span>
<span class="co">#&gt; 4: F13230 D2 F13230 2022-09-15        &lt;NA&gt;</span>
<span class="co">#&gt; 5:  C8397 D2  C8397 2019-10-13      CANCER</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(Charlson<span class="op">$</span>summarised_groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;     ID Comorbidity firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0          RD    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1          RD    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10          RD    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11          RD    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A11      DIAB_C    2015-12-16  2015-12-16     1    0 days</span></code></pre></div>
<p><strong>3) Elixhauser</strong> Elixhauser comorbidity measure data.</p>
<p>The Elixhauser Comorbidity Software is one in a family of databases and software tools developed as part of the Healthcare Cost and Utilization Project (HCUP).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ELIX &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxComorbid.html">IcdDxToComorbid</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                        <span class="dt">idColName =</span> ID,           
                        <span class="dt">icdColName =</span> ICD,       
                        <span class="dt">dateColName =</span> Date,
                        <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                        <span class="dt">comorbidMethod =</span> elix)

ELIX<span class="op">$</span>groupedDT[<span class="dv">160</span><span class="op">:</span><span class="dv">164</span>]
<span class="co">#&gt;     Short ID    ICD       Date Comorbidity</span>
<span class="co">#&gt; 1: M06821 D1 M06821 2016-12-06        ARTH</span>
<span class="co">#&gt; 2:  K7291 D1  K7291 2024-04-04       LIVER</span>
<span class="co">#&gt; 3: O99353 D2 O99353 2023-10-23       NEURO</span>
<span class="co">#&gt; 4: F13230 D2 F13230 2022-09-15        DRUG</span>
<span class="co">#&gt; 5:  C8397 D2  C8397 2019-10-13       LYMPH</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ELIX<span class="op">$</span>summarised_groupedDT, <span class="dv">5</span>)
<span class="co">#&gt;     ID Comorbidity firstCaseDate endCaseDate count    period</span>
<span class="co">#&gt; 1:  A0    RENLFAIL    2009-07-25  2013-12-20     5 1609 days</span>
<span class="co">#&gt; 2:  A1    RENLFAIL    2006-11-29  2014-09-24     5 2856 days</span>
<span class="co">#&gt; 3: A10    RENLFAIL    2007-11-04  2012-07-30     5 1730 days</span>
<span class="co">#&gt; 4: A11    RENLFAIL    2008-03-09  2011-09-03     5 1273 days</span>
<span class="co">#&gt; 5: A12    RENLFAIL    2006-05-14  2015-06-29     5 3333 days</span></code></pre></div>
</div>
<div id="e--cases-selection" class="section level3">
<h3 class="hasAnchor">
<a href="#e--cases-selection" class="anchor"></a>E. Cases selection</h3>
<p>The query function <code>selectCases</code> can select the cases matching defined conditions. User can select cases by diagnostic categories, such as CCS category, ICD codes, etc.</p>
<p>searching criteria for example,</p>
<ol style="list-style-type: decimal">
<li>
<p>Querying conditions</p>
<p><code>groupDataType</code>: Choose the method of code classification: ICD, CCS, PheWAS, comorbidity or customized group method</p>
<p><code>caseCondition</code>: Certain diseases of standard groups by the <code>groupDataType</code> given above</p>
</li>
<li><p>Searching range</p></li>
</ol>
<p>　　　<code>PeriodRange</code>: Determine the interval days of interest for performing the case selection. By default, it set from 30 to 365 days.</p>
<ol start="3" style="list-style-type: decimal">
<li>Minimum number of diagnoses</li>
</ol>
<p>　　　<code>caseCount</code>: A threshold of number of ICD for case selection</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Case &lt;-<span class="st"> </span><span class="kw"><a href="../reference/selectCase.html">selectCases</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                    <span class="dt">idColName =</span> ID,           
                    <span class="dt">icdColName =</span> ICD,       
                    <span class="dt">dateColName =</span> Date,
                    <span class="dt">groupDataType =</span> ccslvl2,
                    <span class="dt">icd10usingDate =</span> <span class="st">"2015/10/01"</span>,
                    <span class="dt">caseCondition =</span> <span class="st">"Diseases of the urinary system"</span>,
                    <span class="dt">caseCount =</span> <span class="dv">1</span>,
                    <span class="dt">CaseName =</span> <span class="st">"Selected"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(Case)                   
<span class="co">#&gt;     ID selectedCase count firstCaseDate endCaseDate    period</span>
<span class="co">#&gt; 1:  A0     Selected     5    2009-07-25  2013-12-20 1609 days</span>
<span class="co">#&gt; 2:  A1     Selected     5    2006-11-29  2014-09-24 2856 days</span>
<span class="co">#&gt; 3: A10     Selected     5    2007-11-04  2012-07-30 1730 days</span>
<span class="co">#&gt; 4: A11     Selected     5    2008-03-09  2011-09-03 1273 days</span>
<span class="co">#&gt; 5: A12     Selected     5    2006-05-14  2015-06-29 3333 days</span>
<span class="co">#&gt; 6: A13     Selected     5    2006-04-29  2025-02-02 6854 days</span>
<span class="co">#&gt;    MostCommonICD MostCommonICDCount</span>
<span class="co">#&gt; 1:          5856                  1</span>
<span class="co">#&gt; 2:          5856                  1</span>
<span class="co">#&gt; 3:          5859                  1</span>
<span class="co">#&gt; 4:          5855                  1</span>
<span class="co">#&gt; 5:          5853                  1</span>
<span class="co">#&gt; 6:          5855                  1</span></code></pre></div>
</div>
<div id="f--patient-record-period" class="section level3">
<h3 class="hasAnchor">
<a href="#f--patient-record-period" class="anchor"></a>F. Patient record period</h3>
<p>The function used for querying the earliest and latest admission date for each patient.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">admissionDate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/recordPeriod.html">patientRecordDate</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                                   <span class="dt">idColName =</span> ID,
                                   <span class="dt">icdColName =</span> ICD,
                                   <span class="dt">dateColName =</span> Date)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(admissionDate)                                  
<span class="co">#&gt;     ID firstRecordDate endRecordDate</span>
<span class="co">#&gt; 1:  D6      2005-10-09    2025-01-05</span>
<span class="co">#&gt; 2: A12      2006-01-12    2022-06-12</span>
<span class="co">#&gt; 3:  D1      2006-02-12    2024-04-04</span>
<span class="co">#&gt; 4: A13      2006-04-29    2025-02-02</span>
<span class="co">#&gt; 5:  A9      2006-06-30    2023-12-10</span>
<span class="co">#&gt; 6:  D2      2006-09-01    2025-08-11</span></code></pre></div>
</div>
<div id="g--data-split" class="section level3">
<h3 class="hasAnchor">
<a href="#g--data-split" class="anchor"></a>G. Data split</h3>
<p>Extract data by a specific clinical event (e.g., first diagnosis dates of chronic diseases).<br>
Users can define a table of clinical index dates of each patient. The date can generate by selectCases function or first/last admission date by patientRecordDate function.</p>
<p>Split data by the clinical event date and shows the data recorded before or after the clinical event and the window counts, which is the gap between the record date and index date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">indexDateTable &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">ID =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"A0"</span>,<span class="st">"B0"</span>,<span class="st">"C0"</span>,<span class="st">"D0"</span>),
                             <span class="dt">indexDate =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"2009-07-25"</span>, <span class="st">"2015-12-26"</span>,
                                           <span class="st">"2015-12-05"</span>, <span class="st">"2017-01-29"</span>),
                             <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
Data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DataSplit.html">splitDataByDate</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                        <span class="dt">idColName =</span> ID,
                        <span class="dt">icdColName =</span> ICD,
                        <span class="dt">dateColName =</span> Date,
                        <span class="dt">indexDateFile =</span> indexDateTable,
                        <span class="dt">Gap =</span> <span class="dv">30</span>) 
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(Data, <span class="dv">5</span>)
<span class="co">#&gt;    ID   ICD       Date  indexDate timeTag window</span>
<span class="co">#&gt; 1: A0  5856 2009-07-25 2009-07-25       A      1</span>
<span class="co">#&gt; 2: A0  V560 2010-03-28 2009-07-25       A      9</span>
<span class="co">#&gt; 3: A0  5853 2010-10-29 2009-07-25       A     16</span>
<span class="co">#&gt; 4: A0 V4511 2012-04-05 2009-07-25       A     33</span>
<span class="co">#&gt; 5: A0  5855 2013-12-20 2009-07-25       A     54</span></code></pre></div>
</div>
<div id="h--condition-era" class="section level3">
<h3 class="hasAnchor">
<a href="#h--condition-era" class="anchor"></a>H. Condition Era</h3>
<p>Calculate condition era by grouped categories of each patient.<br>
Conditions era is used to integrate distributed data of clinical records into a single progression record when the interval of admission data is smaller than the length of condition gap, and these admission data are considered same condition era.<br>
The first case date is the start date of the first condition of the group category for each patient. The end case date is the end date of the last condition of the group category for each patient.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Era &lt;-<span class="st"> </span><span class="kw"><a href="../reference/era.html">getConditionEra</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                       <span class="dt">idColName =</span> ID,
                       <span class="dt">icdColName =</span> ICD,
                       <span class="dt">dateColName =</span> Date,
                       <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>, 
                       <span class="dt">gapDate =</span> <span class="dv">30</span>,
                       <span class="dt">groupDataType =</span> ccs,
                       <span class="dt">isDescription =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(Era)                       
<span class="co">#&gt;    ID CCS_CATEGORY era firstCaseDate endCaseDate count   period</span>
<span class="co">#&gt; 1: A0          158   1    2009-07-25  2009-07-25     1   0 days</span>
<span class="co">#&gt; 2: A0          158   2    2010-03-28  2010-03-28     1 246 days</span>
<span class="co">#&gt; 3: A0          158   3    2010-10-29  2010-10-29     1 215 days</span>
<span class="co">#&gt; 4: A0          158   4    2012-04-05  2012-04-05     1 524 days</span>
<span class="co">#&gt; 5: A0          158   5    2013-12-20  2013-12-20     1 624 days</span>
<span class="co">#&gt; 6: A1          158   1    2006-11-29  2006-11-29     1   0 days</span></code></pre></div>
</div>
</div>
<div id="iii--eda-preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#iii--eda-preparation" class="anchor"></a>III. EDA preparation</h2>
<p>After data integration, emr package provides function to convert long format of grouped data into wide format which is fit to others analytical and plotting packages.</p>
<p>There are two type of output: numeric and binary (<code>numericOrBinary</code> = <code>B</code> or <code>N</code> )</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#binary</span>
groupedData_Wide &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile, 
                                          <span class="dt">idColName =</span> ID,    
                                          <span class="dt">icdColName =</span> ICD,   
                                          <span class="dt">dateColName =</span> Date,
                                          <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                                          <span class="dt">isDescription =</span> <span class="ot">FALSE</span>,
                                          <span class="dt">groupDataType =</span> Charlson,
                                          <span class="dt">numericOrBinary =</span> B)
                                          
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(groupedData_Wide, <span class="dv">5</span>)
<span class="co">#&gt;    ID CANCER  CEVD  COPD DIAB_C  MSLD  PARA   PUD   PVD   RD Rheum</span>
<span class="co">#&gt; 1  A0  FALSE FALSE FALSE  FALSE FALSE FALSE FALSE FALSE TRUE FALSE</span>
<span class="co">#&gt; 2  A1  FALSE FALSE FALSE  FALSE FALSE FALSE FALSE FALSE TRUE FALSE</span>
<span class="co">#&gt; 3 A10  FALSE FALSE FALSE  FALSE FALSE FALSE FALSE FALSE TRUE FALSE</span>
<span class="co">#&gt; 4 A11  FALSE FALSE FALSE   TRUE FALSE FALSE FALSE FALSE TRUE FALSE</span>
<span class="co">#&gt; 5 A12  FALSE FALSE FALSE  FALSE FALSE FALSE FALSE FALSE TRUE FALSE</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># numeric</span>
groupedData_Wide &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile, 
                                          <span class="dt">idColName =</span> ID,    
                                          <span class="dt">icdColName =</span> ICD,   
                                          <span class="dt">dateColName =</span> Date,
                                          <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                                          <span class="dt">isDescription =</span> <span class="ot">FALSE</span>,
                                          <span class="dt">groupDataType =</span> Charlson,
                                          <span class="dt">numericOrBinary =</span> N)

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(groupedData_Wide, <span class="dv">5</span>)
<span class="co">#&gt;     ID CANCER CEVD COPD DIAB_C MSLD PARA PUD PVD RD Rheum</span>
<span class="co">#&gt; 1:  A0      0    0    0      0    0    0   0   0  5     0</span>
<span class="co">#&gt; 2:  A1      0    0    0      0    0    0   0   0  5     0</span>
<span class="co">#&gt; 3: A10      0    0    0      0    0    0   0   0  5     0</span>
<span class="co">#&gt; 4: A11      0    0    0      1    0    0   0   0  5     0</span>
<span class="co">#&gt; 5: A12      0    0    0      0    0    0   0   0  5     0</span></code></pre></div>
</div>
<div id="iv--visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#iv--visualization" class="anchor"></a>IV. Visualization</h2>
<p>Overview of grouped clinical data.</p>
<div id="pareto-chart-of-error-icd-list" class="section level3">
<h3 class="hasAnchor">
<a href="#pareto-chart-of-error-icd-list" class="anchor"></a>1. Pareto chart of error ICD list</h3>
<p>Through first phase function, code standardization, which generates a data of diagnosis codes with potential error.<br>
The Pareto chart includes bar plot and line chart to visualize individual possible error ICD codes represented in descending order and cumulative total.</p>
<p>For instance, user choose top 10 of common error ICD, then the output shows a Pareto chart with top 10 error codes and a list of the detail of error ICD codes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">error &lt;-<span class="st"> </span><span class="kw"><a href="../reference/DxUniform.html">IcdDxDecimalToShort</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                            <span class="dt">icdColName =</span> ICD,
                            <span class="dt">dateColName =</span> Date,
                            <span class="dt">icd10usingDate =</span> <span class="st">"2015/10/01"</span>)

Plot_error1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotError.html">plot_errorICD</a></span>(<span class="dt">errorFile =</span> error<span class="op">$</span>Error,
                            <span class="dt">ICDVersion =</span> all,
                            <span class="dt">wrongICDType =</span> all,
                            <span class="dt">Others =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="https://raw.githubusercontent.com/DHLab-CGU/emr/master/docs/reference/plotError-2.png" style="display:block; margin:auto; width:70%;"> Plot of top 10 common error ICD codes and a list of the detail of error ICD codes<br>
The Top 1 common error ICD is <em>A0.11</em> which has 20 admission records and error type is “wrong format”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Plot_error1<span class="op">$</span>ICD
<span class="co">#&gt;        ICD count CumCountPerc IcdVersionInFile     WrongType Suggestion</span>
<span class="co">#&gt;  1:  A0.11    20       18.35%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  2:  V27.0    18       34.86%           ICD 10 Wrong version           </span>
<span class="co">#&gt;  3:   E114     8        42.2%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  4: A01.05     8       49.54%            ICD 9 Wrong version           </span>
<span class="co">#&gt;  5:  42761     7       55.96%           ICD 10 Wrong version           </span>
<span class="co">#&gt;  6:  Z9.90     6       61.47%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  7:    F42     6       66.97%           ICD 10  Wrong format           </span>
<span class="co">#&gt;  8:  V24.1     6       72.48%           ICD 10 Wrong version           </span>
<span class="co">#&gt;  9:  A0105     5       77.06%            ICD 9 Wrong version           </span>
<span class="co">#&gt; 10:    001     5       81.65%            ICD 9  Wrong format       0019</span>
<span class="co">#&gt; 11: Others    20         100%            ICD 9  Wrong format</span></code></pre></div>
<p>Also, user can divide <strong>ICD-9</strong> by the prefix of the ICD code: 0, 1, 2,…, 9, V and E (<code>groupICD = TRUE</code>)</p>
<p>ICD-9-CM divided into 19 chapters:<br>
　001-139: Infectious And Parasitic Diseases<br>
　140-239: Neoplasms<br>
　….</p>
<p>For instance, user choose top 3 of common error <em>ICD-9</em>, then the output shows a Pareto chart with top 3 error codes and a list of the detail of error ICD codes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Plot_error2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotError.html">plot_errorICD</a></span>(<span class="dt">errorFile =</span> error<span class="op">$</span>Error,
                             <span class="dt">ICDVersion =</span> <span class="dv">9</span>,
                             <span class="dt">wrongICDType =</span> all,
                             <span class="dt">groupICD =</span> <span class="ot">TRUE</span>,
                             <span class="dt">Others =</span> <span class="ot">TRUE</span>,
                             <span class="dt">TopN =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="https://raw.githubusercontent.com/DHLab-CGU/emr/master/docs/reference/plotError-1.png" style="display:block; margin:auto; width:70%;"> Plot of top 3 common error ICD-9 codes and a list of the detail of error ICD codes<br>
The Top 1 common error ICD is <em>A01.05</em> which has 13 admission records and error type is “wrong version”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Plot_error2<span class="op">$</span>ICD
<span class="co">#&gt;    ICDGroup groupCount CumCountPerc MostICDInGroup ICDPercInGroup     WrongType</span>
<span class="co">#&gt; 1:        A         13       41.94%         A01.05         61.54% Wrong version</span>
<span class="co">#&gt; 2:        7          9       70.97%          75.52         44.44%  Wrong format</span>
<span class="co">#&gt; 3:        0          5        87.1%            001           100%  Wrong format</span>
<span class="co">#&gt; 4:   Others          4         100%          E03.0           100% Wrong version</span></code></pre></div>
</div>
<div id="histogram-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#histogram-plot" class="anchor"></a>histogram plot</h3>
<p>This function provides an overview of grouping category of the diagnostic code and summarize the percentage of result in histogram plot. User can observe the number of diagnostic categories in their dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">groupedDataWide &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(sampleDxFile,
                                         <span class="dt">idColName =</span> ID,
                                         <span class="dt">icdColName =</span> ICD,
                                         <span class="dt">dateColName =</span> Date,
                                         <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                                         <span class="dt">isDescription =</span> <span class="ot">FALSE</span>,
                                         <span class="dt">groupDataType =</span> elix)

plot1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PlotGroupedData.html">plot_groupedData</a></span>(<span class="dt">groupedDataWide =</span> groupedDataWide,
                          <span class="dt">TopN =</span> <span class="dv">10</span>,
                          <span class="dt">limitFreq =</span> <span class="fl">0.01</span>)</code></pre></div>
<p><img src="https://raw.githubusercontent.com/DHLab-CGU/emr/master/docs/reference/PlotGroupedData-1.png" style="display:block; margin:auto; width:70%;"> The first group, for instance, is grouped into “RENLFAIL” of ELIX comorbidity index.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot1<span class="op">$</span>sigCate
<span class="co">#&gt;     DiagnosticCategory  N Percentage</span>
<span class="co">#&gt;  1:           RENLFAIL 24     63.16%</span>
<span class="co">#&gt;  2:              TUMOR  6     15.79%</span>
<span class="co">#&gt;  3:               ARTH  5     13.16%</span>
<span class="co">#&gt;  4:              LYMPH  4     10.53%</span>
<span class="co">#&gt;  5:              PSYCH  4     10.53%</span>
<span class="co">#&gt;  6:               DRUG  3      7.89%</span>
<span class="co">#&gt;  7:              NEURO  3      7.89%</span>
<span class="co">#&gt;  8:               PARA  2      5.26%</span>
<span class="co">#&gt;  9:           PERIVASC  2      5.26%</span>
<span class="co">#&gt; 10:              VALVE  2      5.26%</span></code></pre></div>
<p>This function also verifies by Chi-square test and Fisher’s exact test statistical significantly different diagnostic categories between case and control. The default level of significance considered at 5% (p = 0.05).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">selectedCaseFile &lt;-<span class="st"> </span><span class="kw"><a href="../reference/selectCase.html">selectCases</a></span>(<span class="dt">DxDataFile =</span> sampleDxFile,
                                <span class="dt">idColName =</span> ID,
                                <span class="dt">icdColName =</span> ICD,
                                <span class="dt">dateColName =</span> Date,
                                <span class="dt">icd10usingDate =</span> <span class="st">"2015/10/01"</span>,
                                <span class="dt">groupDataType =</span> ccslvl2,
                                <span class="dt">caseCondition =</span> <span class="st">"Diseases of the urinary system"</span>,
                                <span class="dt">caseCount =</span> <span class="dv">1</span>)
                                
groupedDataWide &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dataWide.html">groupedDataLongToWide</a></span>(sampleDxFile, ID, ICD, Date,
                                         <span class="dt">icd10usingDate =</span> <span class="st">"2015-10-01"</span>,
                                         <span class="dt">groupDataType =</span> elix,
                                         <span class="dt">selectedCaseFile =</span> selectedCaseFile)

plot2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PlotGroupedData.html">plot_groupedData</a></span>(<span class="dt">groupedDataWide =</span> groupedDataWide,
                          <span class="dt">TopN =</span> <span class="dv">10</span>,
                          <span class="dt">limitFreq =</span> <span class="fl">0.01</span>,
                          <span class="dt">pvalue =</span> <span class="fl">0.05</span>)</code></pre></div>
<p><img src="https://raw.githubusercontent.com/DHLab-CGU/emr/master/docs/reference/PlotGroupedData-1.png" style="display:block; margin:auto; width:70%;"> There are stastitcal significant different in “RENLFAIL” of ELIX comorbidity index between case and control.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot2<span class="op">$</span>sigCate
<span class="co">#&gt;    DiagnosticCategory        Group  N Percentage</span>
<span class="co">#&gt; 1:      Renal failure non-Selected  0         0%</span>
<span class="co">#&gt; 2:      Renal failure     Selected 24       100%</span></code></pre></div>
</div>
</div>
<div id="reference" class="section level2">
<h2 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h2>
<div id="i--icd-function-of-conversion" class="section level3">
<h3 class="hasAnchor">
<a href="#i--icd-function-of-conversion" class="anchor"></a>I. ICD function of conversion</h3>
<p>ICD-9-CM code (2014): <a href="https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/codes.html" class="uri">https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/codes.html</a></p>
<p>ICD-10-CM code (2019): <a href="https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html" class="uri">https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html</a></p>
<p><a href="https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html" class="uri">https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-CM.html</a></p>
<p><a href="https://www.findacode.com/search/search.php" class="uri">https://www.findacode.com/search/search.php</a></p>
<p><a href="https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf" class="uri">https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf</a></p>
</div>
<div id="ii--data-integration-1" class="section level3">
<h3 class="hasAnchor">
<a href="#ii--data-integration-1" class="anchor"></a>II. Data integration</h3>
<p><strong>CCS (Clinical Classifications Software)</strong></p>
<p>ICD-9-CM (2015): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Single_Level_CCS_2015.zip" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Single_Level_CCS_2015.zip</a></p>
<p><a href="https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Multi_Level_CCS_2015.zip" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Multi_Level_CCS_2015.zip</a></p>
<p>ICD-10-CM (2019): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/ccs10/ccs_dx_icd10cm_2019_1.zip" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/ccs10/ccs_dx_icd10cm_2019_1.zip</a></p>
<p><strong>PheWAS</strong></p>
<p>ICD-9-Phecode (version 1.2, 2015): <a href="https://phewascatalog.org/phecodes" class="uri">https://phewascatalog.org/phecodes</a></p>
<p><strong>Comorbidities</strong></p>
<p>ICD-9-AHRQ (2012-2015): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references</a></p>
<p>ICD-10-AHRQ (2019): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt</a></p>
<p>ICD-9-Charlson: <a href="http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD9_E_Charlson.sas.txt" class="uri">http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD9_E_Charlson.sas.txt</a></p>
<p>ICD-10-Charlson: <a href="http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD10_Charlson.sas.txt" class="uri">http://mchp-appserv.cpe.umanitoba.ca/Upload/SAS/ICD10_Charlson.sas.txt</a></p>
<p>ICD-9-Elixhauser (2012-2015): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp#references</a></p>
<p>ICD-10-Elixhauser (2019): <a href="https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt" class="uri">https://www.hcup-us.ahrq.gov/toolssoftware/comorbidityicd10/comformat_icd10cm_2019_1.txt</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#description">Description</a><ul class="nav nav-pills nav-stacked">
<li><a href="#i-code-standardization">I.Code standardization</a></li>
      <li><a href="#ii--data-integration">II. Data integration</a></li>
      <li><a href="#iii--eda-preparation">III. EDA preparation</a></li>
      <li><a href="#iv--visualization">IV. Visualization</a></li>
      <li><a href="#reference">Reference</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hsiang-Ju Chiu, Yi-Ju Tseng.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
