---
title: "Get Started: Procedure"
author: "Hsiang-Ju, Chiu"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Chinese Version_Procedure}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# 檢查與處置前處理與整合方法

```
cat(utils::packageDescription("emr")$Description)
```
### 安裝套件
```r
# Install development version from GitHub
devtools::install_github("DHLab-CGU/emr")
library(emr)
```
### ICD-PCS-CODE 格式對照
產生 ICD-9-PCS 的兩種格式的表格: Decimal 和 Short 

供後續 ICD 格式轉換的功能使用 (`IcdPrDecimaltoShort 和 IcdPrShortToDecimal`) 

ICD-9-PCS
```
icd9_Short <- head(ICD9PrwithTwoFormat$Short,10)
# c("0001", "0002", "0003", "0009", "0010", "0011", "0012", "0013", "0014", "0015")
icd9_Decimal <- head(ICD9PrwithTwoFormat$Decimal, 10)
# c("00.01", "00.02", "00.03", "00.09", "00.10", "00.11", "00.12", "00.13", "00.14", "00.15")
```
ICD-10-PCS只有short的格式
```
icd10 <- head(prICD10$ICD,10)
# c("0016071", "0016072", "0016073", "0016074", "0016075", "0016076", "0016077", "0016078", "001607B", "00160J0")
```

## I. Code standarization
ICD-9-PCS 兩種格式的轉換: Short <-> Decimal

進行後續分組功能之前, 根據使用者使用的 ICD 格式進行格式的統一化, 分別兩種功能可以將 ICD 統一轉換為 Short 或 Decimal 的格式

將 ICD-PCS code 的格式統一轉成 Decimal
```
# ICD-9
ICD9_Decimal <- IcdPrShortToDecimal(icd9_Short)
ICD9$Decimal
# c("00.01", "00.02", "00.03", "00.09", "00.10", "00.11", "00.12", "00.13", "00.14", "00.15")

# ICD-10
ICD10_Decimal <- IcdPrShortToDecimal(icd10)
ICD10$Decimal
# c("0016071", "0016072", "0016073", "0016074", "0016075", "0016076", "0016077", "0016078", "001607B", "00160J0")
```
將 ICD-PCS code 的格式統一轉成 Short
```
# ICD-9
ICD9_Short <- IcdPrDecimalToShort(icd9_Decimal)
ICD9_Short$Short
# c("0001", "0002", "0003", "0009", "0010", "0011", "0012", "0013", "0014", "0015")

# ICD-10
ICD10_Short <- IcdPrDecimalToShort(icd10)
ICD10_Short$Short
# c("0016071", "0016072", "0016073", "0016074", "0016075", "0016076", "0016077", "0016078", "001607B", "00160J0")
```

## II. Data integration
將 ICD-9 及 ICD-10 code 依照不同的分類標準分類: 分散的 ICD-9-PCS 及 ICD-10-PCS 的診斷碼依照其臨床上意義相似的歸併整合為較大的群組, 標準化的分類以便於後續的整合統計分析使用

目前分類標準: CCS及 Procedure Class, 以下將分別介紹之 

###一、臨床分類軟體 
係以美國醫療照護政策研究品質局（AHRQ）為提供健康政策研究而所發展之「臨床分類軟體」(Clinical Classifications Software, CCS)。 CCS 分為單一階層及多階層的分群, 其階層是診斷分類可依使用需求調整分類標準

單一階層: 較通用的分類

多階層: 將診斷碼分為較精確的分組

目前 ICD-9-PCS 的 CCS 版本為 2015 , ICD-10-PCS 的 CCS 版本為 2019

####1) 單一階層分類
`IcdPrToCCS` 可取得 ICD-9-PCS 及 ICD-10-PCS 相對應的 CCS 分類(CCS Category)及分類之敘述

ICD-9-PCS 和 ICD-10-PCS 的ccs單一階層一致: 共231種
```
## ICD to CCS category
IcdPrToCCS (PrDataFile, ID, ICD, Date, "2016-01-01", FALSE)
#  "1"   "180" "1"   "1"

## ICD to CCS description
IcdPrToCCS (PrDataFile, ID, ICD, Date, "2016-01-01", TRUE)
# "Incision and excision of CNS"             "Other CT scan"                
# "Incision and excision of CNS"             "Incision and excision of CNS"
```
####2) 多階層分類
`IcdPrToCCSLvl` 可取得 ICD-9-PCS 及 ICD-10-PCS 相對應的 CCS 多階層分類 (Multiple ccs level)及分類之敘述

ICD-9-PCS 共 3個階層 (Level 1~3)

ICD-10-PCS 共 2個階層 (Level 1~2)
```
## ICD to CCS multiple level 1
IcdPrToCCSLvl(PrDataFile, ID, ICD, Date, "2016-01-01", 2, FALSE)
# "1.1"  "16.2" "1.1"  "1.1"

## ICD to CCS multiple level 2
IcdPrToCCSLvl(PrDataFile, ID, ICD, Date, "2016-01-01", 2, TRUE)
#  "Incision  excision of CNS"               "Computerized axial tomography (CT) scan"
#  "Incision  excision of CNS"               "Incision  excision of CNS"    
```
### 二、Procedure Class 
由美國醫療照護政策研究品質局（AHRQ）提供的HCUP Classes, 將檢查與處置碼基於其特性分組, 共ICD-PCS code分為下列四個組別:
 
1.Minor Diagnostic: 非手術室執行之診斷類處置

2.Minor Therapeutic: 非手術室執行之治療類處置

3.Major Diagnostic: 需在手術室執行之診斷類處置

4.Major Therapeutic: 需在手術室執行之治療類處置
```
IcdPrToProcedureClass(PrDataFile, ID, ICD, Date, "2016-01-01", TRUE)
# "2" "1" "4" "4"
```

## III. Reference

### I. Code standarization

ICD-9-PCS code (2014): https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/codes.html

ICD-10-PCS code (2019):https://www.cms.gov/Medicare/Coding/ICD10/2019-ICD-10-PCS.html

https://www.findacode.com/search/search.php

https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/HospitalQualityInits/Downloads/HospitalAppendix_F.pdf

### II. Data integration

**臨床分類軟體 (Clinical Classifications Software, CCS)**

ICD-9-PCS CCS (2015): https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Single_Level_CCS_2015.zip

https://www.hcup-us.ahrq.gov/toolssoftware/ccs/Multi_Level_CCS_2015.zip

ICD-10-PCS CCS (2019): https://www.hcup-us.ahrq.gov/toolssoftware/procedureicd10/procedure_icd10.jsp

**Procedure Class**

ICD-9-Procedure Class (2015): https://www.hcup-us.ahrq.gov/toolssoftware/procedure/pc2015.csv

ICD-10-Procedure Class (2019): https://www.hcup-us.ahrq.gov/toolssoftware/procedureicd10/procedure_icd10.jsp
